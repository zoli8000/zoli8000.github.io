(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function r(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(s){if(s.ep)return;s.ep=!0;const i=r(s);fetch(s.href,i)}})();var Ks=Object.defineProperty,Zs=(t,e,r)=>e in t?Ks(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,l=(t,e,r)=>(Zs(t,typeof e!="symbol"?e+"":e,r),r);class rr{constructor(e,r,a,s){l(this,"mem_8000"),l(this,"mem_a000"),l(this,"mem_d000"),l(this,"mem_e000"),this.mem_8000=e,this.mem_a000=r,this.mem_d000=a,this.mem_e000=s}setMemMode(e,r,a,s){this.mem_8000=e,this.mem_a000=r,this.mem_d000=a,this.mem_e000=s}}const I={FULL_RAM:new rr(0,0,0,0),RAM_IO:new rr(0,0,1,0),RAM_RAM_RAM_RAM:[0,0,0,0],RAM_CART_CHR_ROM:[0,3,2,2],CART_CART_CHR_ROM:[3,3,2,2],RAM_RAM_IO_RAM:[0,0,1,0],RAM_CART_IO_ROM:[0,3,1,2],CART_CART_IO_ROM:[3,3,1,2],RAM_RAM_CHR_RAM:[0,0,2,0],RAM_RAM_CHR_ROM:[0,0,2,2],CART_ROM_CHR_ROM:[3,2,2,2],RAM_RAM_IO_ROM:[0,0,1,2],CART_ROM_IO_ROM:[3,2,1,2],CART_NONE_IO_CART:[3,2,1,3],RAM_ROM_CHR_ROM:[0,2,2,2],RAM_ROM_IO_ROM:[0,2,1,2]},Hs=[I.RAM_RAM_RAM_RAM,I.RAM_RAM_RAM_RAM,I.RAM_CART_CHR_ROM,I.CART_CART_CHR_ROM,I.RAM_RAM_RAM_RAM,I.RAM_RAM_IO_RAM,I.RAM_CART_IO_ROM,I.CART_CART_IO_ROM,I.RAM_RAM_RAM_RAM,I.RAM_RAM_CHR_RAM,I.RAM_RAM_CHR_ROM,I.CART_ROM_CHR_ROM,I.RAM_RAM_RAM_RAM,I.RAM_RAM_IO_RAM,I.RAM_RAM_IO_ROM,I.CART_ROM_IO_ROM,I.CART_NONE_IO_CART,I.CART_NONE_IO_CART,I.CART_NONE_IO_CART,I.CART_NONE_IO_CART,I.CART_NONE_IO_CART,I.CART_NONE_IO_CART,I.CART_NONE_IO_CART,I.CART_NONE_IO_CART,I.RAM_RAM_RAM_RAM,I.RAM_RAM_CHR_RAM,I.RAM_RAM_CHR_ROM,I.RAM_ROM_CHR_ROM,I.RAM_RAM_RAM_RAM,I.RAM_RAM_IO_RAM,I.RAM_RAM_IO_ROM,I.RAM_ROM_IO_ROM];class Mt{constructor(e){l(this,"array"),this.array=[...e]}read(e){return this.array[e]}readMany(e,r){const a=[];for(let s=e;s<r;s++)a.push(this.read(s));return a}write(e,r){this.array[e]=r}load(e,r,a=0){for(let s=0;s<e.length;s++)this.array[r+a+s]=e[s]}}let tt=class extends Mt{write(e,r){throw new Error("Read only!")}};class Xs extends Mt{}class $s extends Mt{read(e){return this.array[e-55296]}write(e,r){this.array[e-55296]=r}}class Hr extends tt{read(e){return this.array[e-53248]}load(e,r){tt.prototype.load.bind(this)(e,r,-53248)}}class Xr extends tt{read(e){return this.array[e-57344]}load(e,r){tt.prototype.load.bind(this)(e,r,-57344)}}class $r extends tt{read(e){return this.array[e-40960]}load(e,r){tt.prototype.load.bind(this)(e,r,-40960)}}class js{constructor(){l(this,"cartridge"),l(this,"ram"),l(this,"romCharset"),l(this,"kernal"),l(this,"io"),l(this,"basicRom"),l(this,"colorRam"),l(this,"pinEXROM"),l(this,"pinGAME"),l(this,"activePlaSetup"),this.cartridge=null,this.activePlaSetup=new rr(0,2,1,2),this.ram=new Xs(new Array(65536)),this.pinEXROM=!1,this.pinGAME=!1,this.resetRAM(),this.colorRam=new $s(new Array(1024)),this.colorRam.array.fill(0)}resetRAM(){for(let e=0;e<65536;e++)this.ram.array[e]=e&64?255:0}setPLA(e){const r=(this.pinEXROM?0:16)+(this.pinGAME?0:8)+(e&7),a=Hs[r];this.activePlaSetup.setMemMode(a[0],a[1],a[2],a[3])}setOptions(e){Object.keys(e).forEach(r=>{this[r]=e[r]})}readMany(e,r){const a=[];for(let s=e;s<r;s++)a.push(this.read(s));return a}vic_read(e){return e&=65535,e>=4096&&e<=8191?this.romCharset.array[e-4096]:e>=36864&&e<=40959?this.romCharset.array[e-36864]:this.ram.read(e)}read(e){var r;return this.readWithPLA(e,this.activePlaSetup,((r=this.cartridge)==null?void 0:r.activePage)||0)}getMemType(e){e&=65535;const r=this.activePlaSetup;return e>=32768&&e<=40959?r.mem_8000:e>=40960&&e<=49151?r.mem_a000:e>=53248&&e<=57343?r.mem_d000:e>=57344&&e<=65535?r.mem_e000:0}readWithoutSideeffects(e){return this.read(e)}readWithPLA(e,r,a){if(e&=65535,e>=32768&&e<=40959)switch(r.mem_8000){case 3:return this.cartridge.readWithPage(e,a);case 0:return this.ram.read(e);default:throw new Error("Invalid Memory Mode")}else if(e>=40960&&e<=49151)switch(r.mem_a000){case 3:return this.cartridge.readWithPage(e,a);case 0:return this.ram.read(e);case 2:return this.basicRom.read(e);default:throw new Error("Invalid Memory Mode")}else if(e>=53248&&e<=57343)switch(r.mem_d000){case 0:return this.ram.read(e);case 2:return this.romCharset.read(e);case 1:return this.io.read(e);default:throw new Error("Invalid Memory Mode")}else if(e>=57344&&e<=65535)switch(r.mem_e000){case 0:return this.ram.read(e);case 2:return this.kernal.read(e);default:throw new Error("Invalid Memory Mode")}return this.ram.read(e)}}class zs extends Mt{constructor(e){super([]),l(this,"ioOwner"),this.ioOwner=e}read(e){return this.ioOwner.read(e)}write(e,r){this.ioOwner.write(e,r)}}class Js{constructor(){l(this,"memoryManager"),l(this,"vic"),l(this,"cia1"),l(this,"cpu"),l(this,"keyboard"),l(this,"joystick"),l(this,"clock"),l(this,"lastRead"),l(this,"lastWrite"),l(this,"lastRW"),l(this,"io"),l(this,"readAddressList"),l(this,"writeAddressList"),l(this,"dd00"),l(this,"cpu00",0),l(this,"cpu01",0),this.memoryManager=new js,this.readAddressList=new Array(65536).fill(-1e6),this.writeAddressList=new Array(65536).fill(-1e6),this.io=!0,this.dd00=0,this.lastRW=0,this.lastRead=0,this.lastWrite=0}addCPU(e){this.cpu=e}addClock(e){this.clock=e}addVIC(e){this.vic=e,this.vic.bus=this}addCIA1(e){this.cia1=e}addKeyboard(e){this.keyboard=e}addJoystick(e){this.joystick=e}addCartridge(){}write(e,r,a=this.io){if(r>255&&console.log(`Invalid data: ${r}`),e<=1)switch(e){case 0:this.cpu00=r;break;case 1:this.cpu01=r,this.memoryManager.setPLA(r);break}if(this.lastWrite=e,this.lastRW=e,this.writeAddressList[e]=this.clock.totalCycles,a&&e>=53248&&e<=57343){if(e>=53248&&e<=54271)return this.vic.write(e&61695,r);if(!(e>=54272&&e<=55295)){if(e>=55296&&e<=56319)return this.memoryManager.colorRam.write(e,r);if(e>=56320&&e<=56575)return this.cia1.write(e&65295,r);if(e>=56576&&e<=56831&&!(e&15))return this.dd00=r,this.vic.setVicBank(3-(r&3))}}const s=this.memoryManager.ram.array[e];if(this.memoryManager.ram.write(e,r),e==45||e==46){if(e==45&&r==s||e==46&&r==s)return;const i=this.memoryManager.ram.array[43]+this.memoryManager.ram.array[44]*256,n=this.memoryManager.ram.array[45]+this.memoryManager.ram.array[46]*256;if(i==0||n<=i)return;this.dispatchReadBasicFromRamEvent(1e3)}}dispatchReadBasicFromRamEvent(e){const r=this.memoryManager.ram.array[43]+this.memoryManager.ram.array[44]*256,a=this.memoryManager.ram.array[45]+this.memoryManager.ram.array[46]*256;r==0||a<=r||setTimeout(()=>{this.memoryManager.ram.array.slice(r,a)},e)}readWithoutSideffects(e){return this.read(e)}getMemType(e){return this.memoryManager.getMemType(e)}read(e){if(this.lastRead=e,this.lastRW=e,this.readAddressList[e]=this.clock.totalCycles,this.io&&e>=53248&&e<=57343){if(e>=53248&&e<=54271)return this.vic.read(e&61695);if(!(e>=54272&&e<=55295)){if(e>=55296&&e<=56319)return this.memoryManager.colorRam.read(e);if(e>=56320&&e<=56575)return this.cia1.read(e&65295);if(e>=56576&&e<=56831&&!(e&15))return this.dd00}}return this.memoryManager.read(e)}}var A=(t=>(t[t.N=128]="N",t[t.V=64]="V",t[t.B=16]="B",t[t.D=8]="D",t[t.I=4]="I",t[t.Z=2]="Z",t[t.C=1]="C",t))(A||{});class ea{constructor(e){l(this,"bus"),l(this,"pc",0),l(this,"sp",0),l(this,"a",0),l(this,"x",0),l(this,"y",0),l(this,"flags",0),l(this,"adr",0),l(this,"currOpMode"),l(this,"currOpFunc"),l(this,"opcode",0),l(this,"cacheInstructions",!1),l(this,"target",""),l(this,"instructions"),l(this,"clockCount",0),l(this,"irqNeeded",!1),l(this,"irqFinished",!1),l(this,"instrCache"),l(this,"isKilled",!1),l(this,"error",""),l(this,"saveDefaultFields",[]),l(this,"dataLo",0),l(this,"dataHi",0),l(this,"memType"),l(this,"execAddresses"),this.instructions=e,this.reset(),this.instrCache=[],this.saveDefaultFields="a x y sp pc flags clockCount adr dataLo dataHi memType".split(" "),this.execAddresses={0:{},1:{},2:{},3:{}}}before(e){}logInstr(e){const r={};this.saveDefaultFields.forEach(a=>{r[a]=this[a]}),Object.assign(r,e),this.instrCache.push(r),this.instrCache.length>1e4&&(this.instrCache=this.instrCache.slice(-5e3))}logInstrUpdate(e){const r=this.instrCache.length-1;r>=0&&Object.assign(this.instrCache[r],e)}formatLog(){try{let e="";for(let r=0;r<this.instrCache.length;r++)e+=this.formatLogItem(this.instrCache[r]);return e}catch{return console.log("Log error!"),""}}formatLogItem(e){return JSON.stringify(e)+`
`}reportTermination(){throw Error("Terminated!")}halt(){return this.error="no rom found.",1e6}clock(){this.irqNeeded&&(this.irq(),this.irqNeeded=!1);const e=this.pc;this.memType=this.bus.getMemType(this.pc),this.execAddresses[this.memType][e]=this.clockCount;const r=this.readPC();if(r===void 0)return this.halt();this.opcode=r,this.dataLo=this.bus.readWithoutSideffects(this.pc),this.dataHi=this.bus.readWithoutSideffects(this.pc+1);const[a,s,i,n,o,u]=this.instructions[r];this.cacheInstructions&&this.logInstr({pc:e,opName:a,modeStr:u,opcode:r}),this.clockCount++,this.before(r),this.currOpMode=i,this.currOpFunc=s;const d=i(this),p=s(this);this.after();let g=n+d+p;return isNaN(g)&&(g=0,this.isKilled=!0),this.cacheInstructions&&this.logInstrUpdate({afterAdr:this.adr,afterKilled:this.isKilled,cyclesUsed:g}),this.isKilled&&this.reportTermination(),g}after(){}sysCall(e){}addBus(e){this.bus=e}read(e){return this.bus.read(e)}readPC(){const e=this.bus.read(this.pc);if(this.pc=this.pc+1&65535,Number.isNaN(e))throw Error("Invalid number!");return e}write(e,r){this.bus.write(e,r)}irq(){}nmi(){}reset(){this.pc=0,this.isKilled=!1,this.error="",this.a=0,this.x=0,this.y=0,this.sp=253,this.flags=32,this.adr=0,this.clockCount=0,this.irqNeeded=!1,this.irqFinished=!1}setFlag(e,r){this.flags&=~e,r&&(this.flags|=e)}getFlag(e){return(this.flags&e)>0?1:0}setFlagZ(e){this.flags&=-3,e==0&&(this.flags|=2)}setFlagN(e){this.flags&=-129,e&128&&(this.flags|=128)}setFlagNZ(e){this.setFlagN(e),this.setFlagZ(e)}setPc(e){this.pc=e}}function jr(t,e){return t.toString(16).padStart(e,"0")}function Ae(t){return jr(t,2)}function Et(t){return jr(t,4)}function ta(t,e){return t.toString(2).padStart(e,"0")}function ra(t){return ta(t,8)}function Zt(t){return t%10+(Math.floor(t/10)&15)*16}class Er{constructor(){l(this,"latchValue",0),l(this,"counter",0),l(this,"flags",0),l(this,"change"),l(this,"stopAfterUnderflow",!0),this.change=!1}}class sa{constructor(e){l(this,"timerA"),l(this,"timerB"),l(this,"realTimeClock",0),l(this,"freq",0),this.bus=e,this.timerA=new Er,this.timerB=new Er,this.reset(),this.setFreq(1e6)}addCycles(e){this.realTimeClock+=e,this.timerA.counter!==void 0&&this.timerA.change&&(this.timerA.counter-=e),this.timerA.counter<0&&(this.timerA.stopAfterUnderflow?(this.timerA.change=!1,this.bus.cpu.getFlag(A.I)==0&&this.bus.cpu.irq()):this.bus.cpu.getFlag(A.I)==0&&(this.bus.cpu.irq(),this.timerA.counter=this.timerA.latchValue,this.timerA.change=!0)),this.timerB.counter&&this.timerB.change&&(this.timerB.counter-=e),this.timerB.counter<0}setFreq(e){this.freq=e}reset(){this.realTimeClock=0}read(e){switch(e&15){case 0:return this.bus.joystick.read(0);case 1:return this.bus.keyboard.read(e)&this.bus.joystick.read(1);case 2:case 3:return this.bus.keyboard.read(e);case 4:return this.timerA.counter&255;case 5:return this.timerA.counter>>8&255;case 6:return this.timerB.counter&255;case 7:return this.timerB.counter>>8&255;case 8:return Math.round(this.realTimeClock/this.freq*10)%10;case 9:return Zt(Math.round(this.realTimeClock/this.freq)%60);case 10:return Zt(Math.round(this.realTimeClock/this.freq*60)%60);case 11:{const r=Zt(Math.round(this.realTimeClock/this.freq*60*60)%12);return r+(r>=12?128:0)}case 13:{let r=this.timerA.counter<0?1:0;return r|=this.timerB.counter<0?2:0,r}default:return 0}}write(e,r){switch(e&15){case 0:case 1:case 2:case 3:this.bus.keyboard.write(e,r);break;case 4:this.timerA.counter&=65280,this.timerA.counter+=r,this.timerA.latchValue=this.timerA.counter;break;case 5:this.timerA.counter&=255,this.timerA.counter+=r<<8,this.timerA.latchValue=this.timerA.counter;break;case 6:this.timerB.counter&=65280,this.timerB.counter+=r,this.timerB.latchValue=this.timerB.counter;break;case 7:this.timerB.counter&=255,this.timerB.counter+=r<<8,this.timerB.latchValue=this.timerB.counter;break;case 8:return;case 9:return;case 10:return;case 11:return;case 13:return;case 14:this.timerA.flags=r,this.timerA.change=(r&1)>0,this.timerA.stopAfterUnderflow=(r&8)>0,(r&16)>0&&(this.timerA.counter=this.timerA.latchValue);break}}}class aa{constructor(){l(this,"totalCycles"),l(this,"bus"),l(this,"fpsCount"),l(this,"pcCallbacks"),this.totalCycles=0,this.fpsCount=0,this.pcCallbacks=Array(65536).fill(null)}addBus(e){this.bus=e}renderNext(){let e=!1,r=1;this.bus.vic.requestIRQ&&(this.bus.cpu.irqNeeded=!0,this.bus.vic.requestIRQ=!1),e||(r=this.clockAll()),e=this.bus.vic.render(r),this.totalCycles+=r}renderVIC(){let e=0;for(;e<this.bus.vic.scanLines;){const r=this.bus.vic.rasterY;this.bus.vic.render(8),r!=this.bus.vic.rasterY&&e++}}clockAll(){const e=this.pcCallbacks[this.bus.cpu.pc];e&&e.forEach(a=>{a()});const r=this.bus.cpu.clock();return this.bus.cia1.addCycles(r),r}renderFrame(e=4){if(!this.bus.cpu.error)for(let r=0;r<e;r++){for(;!this.bus.vic.isRendered();)this.renderNext();this.bus.vic.reset(),this.fpsCount++}}debugOnce(e){let r=!1;this.bus.vic.rasterY==0&&!this.bus.cpu.irqFinished&&(this.bus.cpu.irqNeeded=!0),this.bus.vic.rasterY>255&&(this.bus.cpu.irqFinished=!1);let a=1;r||(a=this.clockAll()),r=this.bus.vic.render(a),this.totalCycles+=a}debugNextFew(e){for(let r=0;r<e;r++)this.debugOnce([]);this.bus.vic.isRendered()}debugUntilBreakpoint(e,r=1){for(let a=0;a<r;a++)e&&e.indexOf(this.bus.cpu.pc)==-1&&this.debugOnce([]);this.bus.vic.isRendered()&&this.fpsCount++}}class ia extends ea{constructor(){super(oa)}irq(){Ta(this),this.irqNeeded=!1}nmi(){ka(this)}formatLogItem(e){const[r,a]=na[e.modeStr],s=e.dataLo,i=e.dataHi,n=e.pc+(s&127)-(s&128)&65535,o=r>1?Ae(e.dataLo):"  ",u=r>2?Ae(e.dataHi):"  ",d=e.opName+" "+a.replace("@H",Ae(i)).replace("@L",Ae(s)).replace("@R",Et(n)),p=`Clock     NV-BDIZC SP   A  X  Y   PC     Instruction 
`,g=`${Ae(e.opcode)} ${o} ${u}  `,h=`${e.clockCount}    ${ra(e.flags)} ${Ae(e.sp)} ${Ae(e.a)} ${Ae(e.x)} ${Ae(e.y)}   $${Et(e.pc)}: ${g} ${d.padEnd(14," ")}`+(e.adr!=e.afterAdr?`(->$${Et(e.afterAdr)})`:"")+`
`;return(e.extra?e.extra+`
`:"")+(e.clockCount%16==0?p:"")+h}reportTermination(e=!0){try{const r=this.formatLog(),a=new Blob([r],{type:"text/plain;charset=utf-8"}),s=document.createElement("a");s.href=URL.createObjectURL(a),s.download="logs.txt",s.click(),URL.revokeObjectURL(s.href)}catch{console.error("Termination report failed.")}if(e)throw Error("Terminated")}sysCall(e){const r=this.flags,a=this.sp,s=this.pc;for(this.pc=e,this.currOpFunc=la;a>this.sp||this.currOpFunc.name!="RTS";)this.clock();this.pc=s,this.sp=a,this.flags=r}}const na={imp:[1,""],imm:[2,"#$@L"],rel:[2,"@R"],abs:[3,"$@H@L"],abx:[3,"$@H@L, x"],aby:[3,"$@H@L, y"],zp:[2,"$@L"],zpx:[2,"$@L, x"],zpy:[2,"$@L, y"],izx:[2,"($@L, x)"],izy:[2,"($@L), y"],ind:[3,"($@H@L)"]},oa=[["BRK",Oa,v,7,0,"imp"],["ORA",Ce,Z,6,0,"izx"],["KIL",re,v,0,-10,"imp"],["SLO",Ve,Z,8,-10,"izx"],["NOP",V,B,3,-10,"zp"],["ORA",Ce,B,3,0,"zp"],["ASL",It,B,5,0,"zp"],["SLO",Ve,B,5,-10,"zp"],["PHP",ya,v,3,0,"imp"],["ORA",Ce,Q,2,0,"imm"],["ASL",Da,v,2,0,"imp"],["ANC",Vr,Q,2,-10,"imm"],["NOP",V,O,4,-10,"abs"],["ORA",Ce,O,4,0,"abs"],["ASL",It,O,6,1,"abs"],["SLO",Ve,O,6,-10,"abs"],["BPL",Wa,ye,2,2,"rel"],["ORA",Ce,H,5,0,"izy"],["KIL",re,v,0,-10,"imp"],["SLO",Ve,H,8,-10,"izy"],["NOP",V,N,4,-10,"zpx"],["ORA",Ce,N,4,0,"zpx"],["ASL",It,N,6,0,"zpx"],["SLO",Ve,N,6,-10,"zpx"],["CLC",Na,v,2,2,"imp"],["ORA",Ce,G,4,0,"aby"],["NOP",V,v,2,-10,"imp"],["SLO",Ve,G,7,-10,"aby"],["NOP",V,R,4,-10,"abx"],["ORA",Ce,R,4,0,"abx"],["ASL",It,R,7,0,"abx"],["SLO",Ve,R,7,-10,"abx"],["JSR",Sa,O,6,20,"abs"],["AND",Se,Z,6,0,"izx"],["KIL",re,v,0,-10,"imp"],["RLA",Ee,Z,8,-10,"izx"],["BIT",Nr,B,3,0,"zp"],["AND",Se,B,3,0,"zp"],["ROL",Ot,B,5,0,"zp"],["RLA",Ee,B,5,-10,"zp"],["PLP",Ca,v,4,0,"imp"],["AND",Se,Q,2,0,"imm"],["ROL",Ra,v,2,0,"imp"],["ANC",Vr,Q,2,-10,"imm"],["BIT",Nr,O,4,0,"abs"],["AND",Se,O,4,0,"abs"],["ROL",Ot,O,6,0,"abs"],["RLA",Ee,O,6,-10,"abs"],["BMI",Ka,ye,2,1,"rel"],["AND",Se,H,5,0,"izy"],["KIL",re,v,0,-10,"imp"],["RLA",Ee,H,8,-10,"izy"],["NOP",V,N,4,-10,"zpx"],["AND",Se,N,4,0,"zpx"],["ROL",Ot,N,6,0,"zpx"],["RLA",Ee,N,6,-10,"zpx"],["SEC",Va,v,2,1,"imp"],["AND",Se,G,4,0,"aby"],["NOP",V,v,2,-10,"imp"],["RLA",Ee,G,7,-10,"aby"],["NOP",V,R,4,-10,"abx"],["AND",Se,R,4,0,"abx"],["ROL",Ot,R,7,0,"abx"],["RLA",Ee,R,7,-10,"abx"],["RTI",wa,v,6,0,"imp"],["EOR",Te,Z,6,0,"izx"],["KIL",re,v,0,-10,"imp"],["SRE",Fe,Z,8,-10,"izx"],["NOP",V,B,3,-10,"zp"],["EOR",Te,B,3,0,"zp"],["LSR",kt,B,5,0,"zp"],["SRE",Fe,B,5,-10,"zp"],["PHA",va,v,3,3,"imp"],["EOR",Te,Q,2,1,"imm"],["LSR",Ba,v,2,0,"imp"],["ALR",Ja,Q,2,-10,"imm"],["JMP",Rr,O,3,6,"abs"],["EOR",Te,O,4,0,"abs"],["LSR",kt,O,6,0,"abs"],["SRE",Fe,O,6,-10,"abs"],["BVC",Za,ye,2,0,"rel"],["EOR",Te,H,5,0,"izy"],["KIL",re,v,0,-10,"imp"],["SRE",Fe,H,8,-10,"izy"],["NOP",V,N,4,-10,"zpx"],["EOR",Te,N,4,0,"zpx"],["LSR",kt,N,6,0,"zpx"],["SRE",Fe,N,6,-10,"zpx"],["CLI",La,v,2,0,"imp"],["EOR",Te,G,4,0,"aby"],["NOP",V,v,2,-10,"imp"],["SRE",Fe,G,7,-10,"aby"],["NOP",V,R,4,-10,"abx"],["EOR",Te,R,4,0,"abx"],["LSR",kt,R,7,0,"abx"],["SRE",Fe,R,7,-10,"abx"],["RTS",Ia,v,6,3,"imp"],["ADC",_e,Z,6,0,"izx"],["KIL",re,v,0,-10,"imp"],["RRA",Ne,Z,8,-10,"izx"],["NOP",V,B,3,-10,"zp"],["ADC",_e,B,3,0,"zp"],["ROR",wt,B,5,0,"zp"],["RRA",Ne,B,5,-10,"zp"],["PLA",xa,v,4,4,"imp"],["ADC",_e,Q,2,1,"imm"],["ROR",Ea,v,2,0,"imp"],["ARR",$a,Q,2,-10,"imm"],["JMP",Rr,ua,5,0,"ind"],["ADC",_e,O,4,2,"abs"],["ROR",wt,O,6,0,"abs"],["RRA",Ne,O,6,-10,"abs"],["BVS",Ha,ye,2,0,"rel"],["ADC",_e,H,5,0,"izy"],["KIL",re,v,0,-10,"imp"],["RRA",Ne,H,8,-10,"izy"],["NOP",V,N,4,-10,"zpx"],["ADC",_e,N,4,0,"zpx"],["ROR",wt,N,6,0,"zpx"],["RRA",Ne,N,6,-10,"zpx"],["SEI",Qa,v,2,0,"imp"],["ADC",_e,G,4,0,"aby"],["NOP",V,v,2,-10,"imp"],["RRA",Ne,G,7,-10,"aby"],["NOP",V,R,4,-10,"abx"],["ADC",_e,R,4,0,"abx"],["ROR",wt,R,7,0,"abx"],["RRA",Ne,R,7,-10,"abx"],["NOP",V,Q,2,-10,"imm"],["STA",De,Z,6,0,"izx"],["NOP",V,Q,2,-10,"imm"],["SAX",Bt,Z,6,-10,"izx"],["STY",Xt,B,3,0,"zp"],["STA",De,B,3,0,"zp"],["STX",Ht,B,3,0,"zp"],["SAX",Bt,B,3,-10,"zp"],["DEY",ca,v,2,1,"imp"],["NOP",V,Q,2,-10,"imm"],["TXA",ha,v,2,1,"imp"],["XAA",ja,Q,2,-10,"imm"],["STY",Xt,O,4,5,"abs"],["STA",De,O,4,14,"abs"],["STX",Ht,O,4,3,"abs"],["SAX",Bt,O,4,-10,"abs"],["BCC",qa,ye,2,4,"rel"],["STA",De,H,6,2,"izy"],["KIL",re,v,0,-10,"imp"],["AHX",Pr,H,6,-10,"izy"],["STY",Xt,N,4,0,"zpx"],["STA",De,N,4,0,"zpx"],["STX",Ht,Ct,4,0,"zpy"],["SAX",Bt,Ct,4,-10,"zpy"],["TYA",ba,v,2,1,"imp"],["STA",De,G,5,0,"aby"],["TXS",_a,v,2,0,"imp"],["TAS",ti,G,5,-10,"aby"],["SHY",Xa,R,5,-10,"abx"],["STA",De,R,5,0,"abx"],["SHX",za,G,5,-10,"aby"],["AHX",Pr,G,5,-10,"aby"],["LDY",lt,Q,2,6,"imm"],["LDA",ke,Z,6,0,"izx"],["LDX",ot,Q,2,3,"imm"],["LAX",Pe,Z,6,-10,"izx"],["LDY",lt,B,3,0,"zp"],["LDA",ke,B,3,0,"zp"],["LDX",ot,B,3,0,"zp"],["LAX",Pe,B,3,-10,"zp"],["TAY",Aa,v,2,1,"imp"],["LDA",ke,Q,2,7,"imm"],["TAX",fa,v,2,2,"imp"],["LAX",Pe,Q,2,-10,"imm"],["LDY",lt,O,4,3,"abs"],["LDA",ke,O,4,12,"abs"],["LDX",ot,O,4,2,"abs"],["LAX",Pe,O,4,-10,"abs"],["BCS",Ua,ye,2,2,"rel"],["LDA",ke,H,5,4,"izy"],["KIL",re,v,0,-10,"imp"],["LAX",Pe,H,5,-10,"izy"],["LDY",lt,N,4,0,"zpx"],["LDA",ke,N,4,0,"zpx"],["LDX",ot,Ct,4,0,"zpy"],["LAX",Pe,Ct,4,-10,"zpy"],["CLV",Pa,v,2,0,"imp"],["LDA",ke,G,4,0,"aby"],["TSX",ma,v,2,0,"imp"],["LAS",ei,G,4,-10,"aby"],["LDY",lt,R,4,0,"abx"],["LDA",ke,R,4,0,"abx"],["LDX",ot,G,4,0,"aby"],["LAX",Pe,G,4,-10,"aby"],["CPY",jt,Q,2,0,"imm"],["CMP",Ie,Z,6,0,"izx"],["NOP",V,Q,2,-10,"imm"],["DCP",Me,Z,8,-10,"izx"],["CPY",jt,B,3,0,"zp"],["CMP",Ie,B,3,0,"zp"],["DEC",Tt,B,5,0,"zp"],["DCP",Me,B,5,-10,"zp"],["INY",da,v,2,4,"imp"],["CMP",Ie,Q,2,3,"imm"],["DEX",ga,v,2,0,"imp"],["AXS",ri,Q,2,-10,"imm"],["CPY",jt,O,4,0,"abs"],["CMP",Ie,O,4,1,"abs"],["DEC",Tt,O,6,0,"abs"],["DCP",Me,O,6,-10,"abs"],["BNE",Ya,ye,2,8,"rel"],["CMP",Ie,H,5,0,"izy"],["KIL",re,v,0,-10,"imp"],["DCP",Me,H,8,-10,"izy"],["NOP",V,N,4,-10,"zpx"],["CMP",Ie,N,4,0,"zpx"],["DEC",Tt,N,6,0,"zpx"],["DCP",Me,N,6,-10,"zpx"],["CLD",Fa,v,2,0,"imp"],["CMP",Ie,G,4,0,"aby"],["NOP",V,v,2,-10,"imp"],["DCP",Me,G,7,-10,"aby"],["NOP",V,R,4,-10,"abx"],["CMP",Ie,R,4,0,"abx"],["DEC",Tt,R,7,0,"abx"],["DCP",Me,R,7,-10,"abx"],["CPX",$t,Q,2,0,"imm"],["SBC",pe,Z,6,0,"izx"],["NOP",V,Q,2,-10,"imm"],["ISC",Re,Z,8,-10,"izx"],["CPX",$t,B,3,0,"zp"],["SBC",pe,B,3,0,"zp"],["INC",St,B,5,0,"zp"],["ISC",Re,B,5,-10,"zp"],["INX",pa,v,2,1,"imp"],["SBC",pe,Q,2,1,"imm"],["NOP",V,v,2,0,"imp"],["SBC",pe,Q,2,-10,"imm"],["CPX",$t,O,4,0,"abs"],["SBC",pe,O,4,1,"abs"],["INC",St,O,6,1,"abs"],["ISC",Re,O,6,-10,"abs"],["BEQ",Ga,ye,2,6,"rel"],["SBC",pe,H,5,0,"izy"],["KIL",re,v,0,-10,"imp"],["ISC",Re,H,8,-10,"izy"],["NOP",V,N,4,-10,"zpx"],["SBC",pe,N,4,0,"zpx"],["INC",St,N,6,0,"zpx"],["ISC",Re,N,6,-10,"zpx"],["SED",Ma,v,2,0,"imp"],["SBC",pe,G,4,0,"aby"],["NOP",V,v,2,-10,"imp"],["ISC",Re,G,7,-10,"aby"],["NOP",V,R,4,-10,"abx"],["SBC",pe,R,4,0,"abx"],["INC",St,R,7,0,"abx"],["ISC",Re,R,7,-10,"abx"]];function Q(t){return t.adr=t.pc++,t.pc&=65535,0}function la(t){}function ua(t){let e=t.readPC()+(t.readPC()<<8);return(e&255)==255?t.adr=t.read(e)+t.read(++e-256)*256:t.adr=t.read(e)+t.read(++e)*256,0}function Z(t){let e=t.readPC()+t.x&255;return t.adr=t.read(e)+(t.read(++e&255)<<8),0}function H(t){let e=t.readPC();const r=t.read(e)+(t.read(++e&255)<<8);return t.adr=r+t.y&65535,(r^t.adr)>255?1:0}function O(t){return t.adr=t.readPC()+(t.readPC()<<8),0}function G(t){const e=t.readPC()+(t.readPC()<<8);return t.adr=e+t.y&65535,(e^t.adr)>255?1:0}function R(t){const e=t.readPC()+(t.readPC()<<8);return t.adr=e+t.x&65535,(e^t.adr)>255?1:0}function ye(t){const e=t.readPC();return t.adr=t.pc+(e&127)-(e&128)&65535,0}function v(t){return 0}function B(t){return t.adr=t.readPC(),0}function N(t){return t.adr=t.readPC()+t.x&255,0}function Ct(t){return t.adr=t.readPC()+t.y&255,0}function ca(t){return t.y=--t.y&255,t.setFlagNZ(t.y),0}function ga(t){return t.x=--t.x&255,t.setFlagNZ(t.x),0}function pa(t){return t.x=++t.x&255,t.setFlagNZ(t.x),0}function da(t){return t.y=++t.y&255,t.setFlagNZ(t.y),0}function Ce(t){return t.a=t.a|t.read(t.adr),t.setFlagNZ(t.a),0}function Se(t){return t.a=t.a&t.read(t.adr),t.setFlagNZ(t.a),0}function Te(t){return t.a=t.a^t.read(t.adr),t.setFlagNZ(t.a),0}function ha(t){return t.a=t.x,t.setFlagNZ(t.a),0}function ba(t){return t.a=t.y,t.setFlagNZ(t.a),0}function fa(t){return t.x=t.a,t.setFlagNZ(t.x),0}function Aa(t){return t.y=t.a,t.setFlagNZ(t.y),0}function ma(t){return t.x=t.sp,t.setFlagNZ(t.x),0}function _a(t){return t.sp=t.x,t.setFlagNZ(t.sp),0}function ke(t){return t.a=t.read(t.adr),t.setFlagNZ(t.a),0}function ot(t){return t.x=t.read(t.adr),t.setFlagNZ(t.x),0}function lt(t){return t.y=t.read(t.adr),t.setFlagNZ(t.y),0}function De(t){return t.write(t.adr,t.a),0}function Ht(t){return t.write(t.adr,t.x),0}function Xt(t){return t.write(t.adr,t.y),0}function va(t){return t.write(256+(t.sp--&255),t.a),t.sp&=255,0}function xa(t){return t.a=t.read(256+(++t.sp&255)),t.sp&=255,t.setFlagNZ(t.a),0}function ya(t){return t.write(256+(t.sp--&255),t.flags),t.sp&=255,0}function Ca(t){return t.flags=t.read(256+(++t.sp&255)),t.sp&=255,0}function St(t){const e=t.read(t.adr);t.write(t.adr,e);const r=e+1&255;return t.setFlagNZ(r),t.write(t.adr,r),0}function Tt(t){const e=t.read(t.adr);t.write(t.adr,e);const r=e-1&255;return t.setFlagNZ(r),t.write(t.adr,r),0}function Rr(t){return t.pc=t.adr,0}function Sa(t){return t.write(256+(t.sp--&255),t.pc-1>>8),t.sp&=255,t.write(256+(t.sp--&255),t.pc-1&255),t.sp&=255,t.pc=t.adr,0}function gr(t,e){return t.logInstrUpdate({extra:`Interrupt at ${Et(e)}`}),t.write(256+(t.sp--&255),t.pc-1>>8),t.sp&=255,t.write(256+(t.sp--&255),t.pc-1&255),t.sp&=255,t.write(256+(t.sp--&255),t.flags&239),t.sp&=255,t.adr=t.bus.read(e)+(t.bus.read(e+1)<<8),t.pc=t.adr,0}function Ta(t){t.getFlag(A.I)||gr(t,65534)}function ka(t){gr(t,65530)}function Ia(t){return t.pc=t.read(256+(++t.sp&255))+t.read(256+(++t.sp&255))*256+1,0}function wa(t){return t.flags=t.read(256+(++t.sp&255)),t.pc=t.read(256+(++t.sp&255))+t.read(256+(++t.sp&255))*256+1,0}function Oa(t){return t.setFlag(A.I,!0),t.setFlag(A.B,!0),gr(t,65534),0}function Ie(t){const e=t.a-t.read(t.adr);return t.setFlagNZ(e&255),t.setFlag(A.C,e>=0),0}function $t(t){const e=t.x-t.read(t.adr);return t.setFlagNZ(e&255),t.setFlag(A.C,e>=0),0}function jt(t){const e=t.y-t.read(t.adr);return t.setFlagNZ(e&255),t.setFlag(A.C,e>=0),0}function _e(t){let e=t.read(t.adr),r;if(t.currOpFunc==pe&&(e^=255),t.getFlag(A.D)){r=(t.a&15)+(e&15)+t.getFlag(A.C);const a=(t.a^r)&(e^r)&128;t.setFlag(A.V,a>0),r>=10&&(r=(r+6&15)+16),r+=(t.a&240)+(e&240),r>=160&&(r+=96),t.setFlag(A.C,r>255),t.a=t.a&255,t.setFlagNZ(t.a)}else{r=t.a+e+t.getFlag(A.C);const a=(t.a^r)&(e^r)&128;t.setFlag(A.V,a>0),t.a=r&255,t.setFlagNZ(t.a),t.setFlag(A.C,r>255)}return 0}function pe(t){return _e(t)}function kt(t){const e=t.read(t.adr);t.write(t.adr,e);const r=e>>1&255;return t.write(t.adr,r),t.setFlag(A.C,(e&1)==1),t.setFlagNZ(r),0}function It(t){const e=t.read(t.adr);t.write(t.adr,e);const r=e<<1&255;return t.write(t.adr,r),t.setFlag(A.C,(e&128)==128),t.setFlagNZ(r),0}function wt(t){const e=t.read(t.adr);t.write(t.adr,e);const r=(e>>1)+t.getFlag(A.C)*128&255;return t.write(t.adr,r),t.setFlag(A.C,(e&1)==1),t.setFlagNZ(r),0}function Ot(t){const e=t.read(t.adr);t.write(t.adr,e);const r=(e<<1)+t.getFlag(A.C)&255;return t.write(t.adr,r),t.setFlag(A.C,(e&128)==128),t.setFlagNZ(r),0}function Ba(t){return t.setFlag(A.C,(t.a&1)==1),t.a=t.a>>1,t.setFlagNZ(t.a),0}function Da(t){return t.setFlag(A.C,(t.a&128)==128),t.a=t.a<<1&255,t.setFlagNZ(t.a),0}function Ea(t){const e=(t.a>>1)+t.getFlag(A.C)*128&255;return t.setFlag(A.C,(t.a&1)==1),t.a=e,t.setFlagNZ(t.a),0}function Ra(t){const e=(t.a<<1)+t.getFlag(A.C)&255;return t.setFlag(A.C,(t.a&128)==128),t.a=e,t.setFlagNZ(t.a),0}function Nr(t){const e=t.read(t.adr);return t.setFlag(A.N,(e&128)==128),t.setFlag(A.V,(e&64)==64),t.setFlag(A.Z,(e&t.a)==0),0}function V(t){return 0}function Na(t){return t.setFlag(A.C,!1),0}function Va(t){return t.setFlag(A.C,!0),0}function Pa(t){return t.setFlag(A.V,!1),0}function Fa(t){return t.setFlag(A.D,!1),0}function Ma(t){return t.setFlag(A.D,!0),0}function La(t){return t.setFlag(A.I,!1),0}function Qa(t){return t.setFlag(A.I,!0),0}function Ya(t){return t.getFlag(A.Z)?0:(t.pc=t.adr,1)}function Ga(t){return t.getFlag(A.Z)?(t.pc=t.adr,1):0}function qa(t){return t.getFlag(A.C)?0:(t.pc=t.adr,1)}function Ua(t){return t.getFlag(A.C)?(t.pc=t.adr,1):0}function Wa(t){return t.getFlag(A.N)?0:(t.pc=t.adr,1)}function Ka(t){return t.getFlag(A.N)?(t.pc=t.adr,1):0}function Za(t){return t.getFlag(A.V)?0:(t.pc=t.adr,1)}function Ha(t){return t.getFlag(A.V)?(t.pc=t.adr,1):0}function re(t){return t.isKilled=!0,0}function Ee(t){const e=t.read(t.adr);t.write(t.adr,e);const r=(e<<1)+t.getFlag(A.C)&255;return t.write(t.adr,r),t.setFlag(A.C,(e&128)==128),t.setFlagNZ(r),t.a=t.a&t.read(t.adr),t.setFlagNZ(t.a),0}function Re(t){return t.isKilled=!0,0}function Ne(t){return t.isKilled=!0,0}function Bt(t){return t.isKilled=!0,0}function Ve(t){const e=t.read(t.adr);t.write(t.adr,e),t.setFlag(A.C,(e&128)==128);const r=e<<1&255;return t.setFlagNZ(r),t.write(t.adr,r),t.a=t.a|t.read(t.adr),t.setFlagNZ(t.a),0}function Vr(t){return t.isKilled=!0,0}function Xa(t){return t.isKilled=!0,0}function $a(t){return t.isKilled=!0,0}function ja(t){return t.isKilled=!0,0}function za(t){return t.isKilled=!0,0}function Pe(t){return t.a=t.read(t.adr),t.x=t.a,t.setFlagNZ(t.a),0}function Ja(t){return t.isKilled=!0,0}function Pr(t){return t.isKilled=!0,0}function ei(t){return t.isKilled=!0,0}function ti(t){return t.isKilled=!0,0}function Fe(t){const e=t.read(t.adr);t.write(t.adr,e);const r=e>>1&255;return t.write(t.adr,r),t.setFlag(A.C,(e&1)==1),t.setFlagNZ(r),t.a=t.a^t.read(t.adr),t.setFlagNZ(t.a),0}function ri(t){return t.isKilled=!0,0}function Me(t){return t.isKilled=!0,0}const Xe=[128,64,32,16,8,4,2,1];let Le=class{constructor(e){l(this,"id"),l(this,"x"),l(this,"x1",0),l(this,"y"),l(this,"y1",0),l(this,"doubleWidth"),l(this,"doubleHeight"),l(this,"colorCode"),l(this,"multiColor"),l(this,"visible"),l(this,"displayable"),l(this,"behindText"),l(this,"vic"),l(this,"data"),l(this,"dataStart"),l(this,"shape"),this.x=0,this.y=0,this.doubleHeight=!1,this.doubleWidth=!1,this.multiColor=!1,this.visible=!1,this.displayable=this.isVisible(),this.behindText=!1,this.colorCode=0,this.id=e,this.shape=0,this.dataStart=0,this.data=new Array(64).fill(0)}isVisible(){return this.visible}getSpriteHeight(){return 21*(this.doubleHeight?2:1)}getSpriteWidth(){return 24*(this.doubleWidth?2:1)}setPos(e){"x"in e&&(this.x=e.x),"y"in e&&(this.y=e.y),this.x1=this.x+this.getSpriteWidth(),this.y1=this.y+this.getSpriteHeight()}bitIterator(e,r,a){for(let s=0;s<8;s++)a(e[s],r&1),r=r>>1}};class Fr{constructor(){l(this,"bus"),l(this,"renderer"),l(this,"memory"),l(this,"cycleCount",0),l(this,"ctx"),l(this,"onscreenWidth",0),l(this,"onscreenHeight",0),l(this,"onscreenPixels",0),l(this,"screenBuffer"),l(this,"imageData"),l(this,"currentPixel",0),l(this,"rasterX",0),l(this,"rasterY",0),l(this,"frames",0),l(this,"cyclesPerLine",0),l(this,"pixelsMulti",8)}isRendered(){return!0}showGrids(){}initRowBlocks(){}render(e){this.initRowBlocks();for(let r=0,a=0;r<e;r++,a++)a>this.cyclesPerLine*this.pixelsMulti&&(this.initRowBlocks(),a=0),this.renderer();return this.cycleCount+=e,!1}getImageData(){return this.imageData}setRenderer(e){this.renderer=e}setMemory(e){this.memory=e}getDimensions(){return[this.onscreenWidth,this.onscreenHeight]}reset(){this.cycleCount=0,this.rasterX=0,this.rasterY=0,this.currentPixel=0}read(e){return 0}write(e,r){}}const Dt=[[0,0,0],[255,255,255],[136,0,0],[170,255,238],[204,68,204],[0,204,85],[0,0,170],[238,238,119],[221,136,85],[102,68,0],[255,119,119],[51,51,51],[119,119,119],[170,255,102],[0,136,255],[187,187,187]];let si=class extends Fr{constructor(e,r){super(),l(this,"pixelsMulti",8),l(this,"scanLines",0),l(this,"allWidth",0),l(this,"cyclesPerLine",0),l(this,"c64colors"),l(this,"borderX0",0),l(this,"borderY0",0),l(this,"borderX1",0),l(this,"borderY1",0),l(this,"backgroundX0",0),l(this,"backgroundY0",0),l(this,"backgroundX1"),l(this,"backgroundY1"),l(this,"totalCycles",0),l(this,"nextSpriteCheck",0),l(this,"gridCtx"),l(this,"gridPixels"),l(this,"gridData"),l(this,"d018",0),l(this,"colorBase",0),l(this,"textBase",0),l(this,"charsetBase",0),l(this,"gfxBase",0),l(this,"vicBank",0),l(this,"d01a",0),l(this,"d01b",0),l(this,"d01c",0),l(this,"d01d",0),l(this,"rasterIRQEnabled",!1),l(this,"borderColor",0),l(this,"borderRGB",[0,0,0]),l(this,"backgroundColor",0),l(this,"backgroundRGB",[0,0,0]),l(this,"rasterIRQLine",0),l(this,"interruptStatusRegister",0),l(this,"bitmapMode",!1),l(this,"extendedMode",!1),l(this,"multicolorMode",!1),l(this,"backgroundColor1",0),l(this,"backgroundColor2",0),l(this,"backgroundColor3",0),l(this,"multiColor1",0),l(this,"multiColor2",0),l(this,"sprites"),l(this,"spriteRenderNeeded"),l(this,"d010",0),l(this,"d011",0),l(this,"d015",0),l(this,"d016",0),l(this,"d017",0),l(this,"backgroundCollision",0),l(this,"spriteCollision",0),l(this,"requestIRQ",!1),this.c64colors=Dt,this.initRegs(),this.frames=0,this.memory=e,this.setBorder(0),this.setBackground(1),this.setRenderer(this.renderStandard8),Object.keys(r).forEach(a=>{this[a]=r[a]}),this.backgroundX1=this.backgroundX0+320,this.backgroundY1=this.backgroundY0+200,this.allWidth=this.cyclesPerLine*this.pixelsMulti,this.onscreenWidth=this.borderX1-this.borderX0,this.onscreenHeight=this.borderY1-this.borderY0,this.onscreenPixels=this.onscreenWidth*this.onscreenHeight,this.imageData=new ImageData(this.onscreenWidth,this.onscreenHeight),this.screenBuffer=this.imageData.data,this.totalCycles=this.scanLines*this.allWidth>>3,this.sprites=[];for(let a=0;a<8;a++){const s=new Le(a);this.sprites.push(s)}this.reset(),this.spriteRenderNeeded=[]}initRegs(){this.colorBase=55296,this.textBase=1024,this.gfxBase=0,this.vicBank=0,this.charsetBase=4096,this.d010=0,this.d016=0,this.d017=0,this.d018=0,this.d01a=0,this.d01b=0,this.d01c=0,this.d01d=0,this.rasterIRQEnabled=!1,this.interruptStatusRegister=0,this.bitmapMode=!1,this.extendedMode=!1,this.multicolorMode=!1,this.backgroundColor1=0,this.backgroundColor2=0,this.backgroundColor3=0,this.backgroundCollision=0,this.spriteCollision=0,this.rasterIRQLine=0,this.requestIRQ=!1}reset(){Fr.prototype.reset.call(this),this.nextSpriteCheck=50}setVicBank(e){this.vicBank=e,this.textBase=(this.textBase&16383)+e*16384,this.gfxBase=(this.gfxBase&16383)+e*16384,this.charsetBase=(this.charsetBase&16383)+e*16384}initRowBlocks(){if(this.rasterY>=this.nextSpriteCheck){const e=[],[r,a]=this.rasterToSpritePos(),s=24;for(let i=0;i<8;i++)this.sprites[i].visible&&this.sprites[i].y<=a+s&&this.sprites[i].y1>=a&&e.unshift(this.sprites[i]);this.spriteRenderNeeded=e,this.nextSpriteCheck+=8}}isImage(){return this.backgroundX0<=this.rasterX&&this.rasterX<this.backgroundX1&&this.backgroundY0<=this.rasterY&&this.rasterY<this.backgroundY1}isVisible(){return this.borderX0<=this.rasterX&&this.rasterX<this.borderX1&&this.borderY0<=this.rasterY&&this.rasterY<this.borderY1}setVicMemory(e,r){const a=(e&49152)>>14,s=(e&16383)>>10,i=(r&49152)>>14;if(a!==i)throw Error("Invalid address combination!");const n=(r&16383)>>10<<4|s;this.bus.write(53272,n);const o=3-(a&3);this.bus.write(56576,o)}read(e){switch(e){case 53248:case 53250:case 53252:case 53254:case 53256:case 53258:case 53260:case 53262:{const r=(e&15)>>1;return this.sprites[r].x&255}case 53249:case 53251:case 53253:case 53255:case 53257:case 53259:case 53261:case 53263:{const r=(e&15)>>1;return this.sprites[r].y&255}case 53264:return this.d010;case 53265:return this.d011&127|this.rasterY&128;case 53266:return this.rasterY&255;case 53269:return this.d015;case 53270:return this.d016;case 53271:return this.d017;case 53272:return this.d018;case 53273:return(this.interruptStatusRegister&15)+(this.interruptStatusRegister?128:0);case 53274:return this.d01a;case 53275:return this.d01b;case 53276:return this.d01c;case 53277:return this.d01d;case 53278:return this.spriteCollision;case 53279:return this.backgroundCollision;case 53280:return this.borderColor;case 53281:return this.backgroundColor;case 53282:return this.backgroundColor1;case 53283:return this.backgroundColor2;case 53284:return this.backgroundColor3;case 53285:return this.multiColor1;case 53286:return this.multiColor2;case 53287:case 53288:case 53289:case 53290:case 53291:case 53292:case 53293:case 53294:{const r=e-53287;return this.sprites[r].colorCode}default:return 0}}write(e,r){if(e>=55296&&e<=56319)throw Error("Should not be here!");switch(e){case 53248:case 53250:case 53252:case 53254:case 53256:case 53258:case 53260:case 53262:{const a=(e&15)>>1;this.sprites[a].setPos({x:(this.sprites[a].x&256)+r});break}case 53249:case 53251:case 53253:case 53255:case 53257:case 53259:case 53261:case 53263:{const a=(e&15)>>1;this.sprites[a].setPos({y:r});break}case 53264:Le.prototype.bitIterator(this.sprites,r,(a,s)=>{a.setPos({x:(a.x&255)+(s==1?256:0)})}),this.d010=r;break;case 53265:this.extendedMode=(r&64)>0,this.bitmapMode=(r&32)>0,this.d011=r,this.rasterIRQLine=(this.rasterIRQLine&255)+(r&128?256:0);break;case 53266:this.rasterIRQLine=(this.rasterIRQLine&256)+r;break;case 53269:Le.prototype.bitIterator(this.sprites,r,(a,s)=>{a.visible=s==1}),this.d015=r;break;case 53270:this.multicolorMode=(r&16)>0,this.d016=r;break;case 53271:Le.prototype.bitIterator(this.sprites,r,(a,s)=>{a.doubleHeight=s==1,a.setPos({})}),this.d017=r;break;case 53272:{this.d018=r;const a=((r&14)>>1)*2048;this.charsetBase=(this.charsetBase&49152)+a;const s=((r&14)>>3)*8192;this.gfxBase=(this.gfxBase&49152)+s;const i=((r&240)>>4)*1024;this.textBase=(this.textBase&49152)+i;break}case 53273:this.interruptStatusRegister&=240+(15-(r&15));break;case 53274:this.d01a=r,r&1&&(this.rasterIRQEnabled=!0);break;case 53275:Le.prototype.bitIterator(this.sprites,r,(a,s)=>{a.behindText=s==1}),this.d01b=r;break;case 53276:Le.prototype.bitIterator(this.sprites,r,(a,s)=>{a.multiColor=s==1}),this.d01c=r;break;case 53277:Le.prototype.bitIterator(this.sprites,r,(a,s)=>{a.doubleWidth=s==1,a.setPos({})}),this.d01d=r;break;case 53278:this.spriteCollision=0;break;case 53279:this.backgroundCollision=0;break;case 53280:this.setBorder(r);break;case 53281:this.setBackground(r);break;case 53282:this.backgroundColor1=r;break;case 53283:this.backgroundColor2=r;break;case 53284:this.backgroundColor3=r;break;case 53285:this.multiColor1=r;break;case 53286:this.multiColor2=r;break;case 53287:case 53288:case 53289:case 53290:case 53291:case 53292:case 53293:case 53294:{const a=e-53287;this.sprites[a].colorCode=r;break}}}setBorder(e){this.borderColor=e,this.borderRGB=Dt[e&15]}setBackground(e){this.backgroundColor=e,this.backgroundRGB=Dt[e&15]}setPixelOld(e){const r=this.currentPixel<<2;this.screenBuffer[r]=e[0],this.screenBuffer[r+1]=e[1],this.screenBuffer[r+2]=e[2],this.screenBuffer[r+3]=255,this.currentPixel++}setPixel(e){const[r,a,s]=Dt[e&15],i=this.currentPixel<<2;this.screenBuffer[i]=r,this.screenBuffer[i+1]=a,this.screenBuffer[i+2]=s,this.screenBuffer[i+3]=255,this.currentPixel++}showDebugLine(e=16){const r=this.currentPixel-e<<2;if(this.currentPixel>=e)for(let a=0;a<e;a++)this.screenBuffer[r+1+a*4]^=255}isRendered(){return isNaN(this.cycleCount)&&(this.cycleCount=0),this.cycleCount>=this.totalCycles?(this.cycleCount=0,this.frames++,this.dummyIRQ(),!0):!1}rasterToSpritePos(){return[this.rasterX-this.backgroundX0+24,this.rasterY-this.backgroundY0+50]}dummyIRQ(){}renderSpritePixel(){if(this.spriteRenderNeeded.length>0){let e=-1;const[r,a]=this.rasterToSpritePos(),s=[];if(this.spriteRenderNeeded.forEach(i=>{if(i.x<=r&&i.x1>r&&i.y<=a&&i.y1>a){const n=this.memory.read(this.textBase+1024-8+i.id);i.shape=n;let o=r-i.x,u=a-i.y;i.doubleWidth&&(o=o>>1),i.doubleHeight&&(u=u>>1);const d=(this.textBase&49152)+n*64,p=this.memory.read(d+(o>>3)+u*3);i.dataStart=d,i.data[(o>>3)+u*3]=p;let g=0,h=-1;i.multiColor?(g=p>>6-(o&6)&3,h=[-1,this.multiColor1,i.colorCode,this.multiColor2][g]):(g=p>>7-(o&7)&1,h=g==1?i.colorCode:-1),h!=-1&&(s.push(i.id),e=h)}}),s.length>1){this.spriteCollision=0;for(let i=0;i<s.length;i++)this.spriteCollision|=2**s[i]}return e}return-1}newRasterLine(){this.rasterIRQEnabled&&this.rasterY==this.rasterIRQLine&&(this.interruptStatusRegister|=129,this.requestIRQ=!0)}renderStandard8(){if(this.showDebugLine(),this.rasterX++,this.rasterX>=this.allWidth&&(this.rasterY++,this.rasterX=1,this.newRasterLine()),this.rasterY>this.scanLines&&this.reset(),!this.isVisible()){this.rasterX+=7;return}if(!this.isImage()){this.rasterX--;for(let x=0;x<8;x++)this.rasterX++,this.setPixel(this.borderColor);return}this.backgroundY0<=this.rasterY&&this.nextSpriteCheck==50&&this.initRowBlocks(),this.rasterX--;const e=this.rasterX-this.backgroundX0,r=this.rasterY-this.backgroundY0,a=(e>>3)+(r>>3)*40,s=r&7;let i=e&7,n=this.backgroundColor,o,u,d=0,p=this.memory.vic_read(a+this.textBase);const g=this.memory.colorRam.read(a+this.colorBase),h=p&15,m=p>>4;this.bitmapMode?(o=this.memory.vic_read(a+this.textBase),u=this.memory.vic_read(a*8+this.gfxBase+s),n=o&15,o=o>>4):(o=g,this.extendedMode&&(d=p>>6,p&=63),u=this.memory.vic_read(p*8+this.charsetBase+s));for(let x=0;x<8;x++){let W=n,S=!1;this.rasterX++;const P=this.renderSpritePixel();if(this.multicolorMode&&!this.bitmapMode){const E=i&6,q=Xe[E]+Xe[E+1];(u&q)>0&&((u&q)>>6-E==1?o=this.backgroundColor1:(u&q)>>6-E==2&&(o=this.backgroundColor2),W=o&15)}else if(this.multicolorMode&&this.bitmapMode){const E=i&6,q=Xe[E]+Xe[E+1],ge=(u&q)>>6-E;ge==0?o=this.backgroundColor:ge==1?o=m:ge==2?o=h:ge==3&&(o=g),W=o&15}else this.extendedMode?(u&Xe[i]||(o=this.memory.io.read(53281+d)),W=o&15):(u&Xe[i])>0&&(W=o&15,S=!0);P>-1&&(S&&(this.backgroundCollision=1),W=P&15),this.setPixel(W),i++}}};const ai={pixelsMulti:8,scanLines:312,cyclesPerLine:63,borderX0:96,borderY0:16,borderX1:480,borderY1:288,backgroundX0:128,backgroundY0:51};let ii=class extends si{constructor(e){super(e,ai)}};const zr=class Jr{constructor(e){this.keyboard=e,e.setMapping(Jr.keyMapping)}keyDown(e){e.preventDefault(),this.keyboard.setMatrixFromEvent(e)}keyUp(e){e.preventDefault(),this.keyboard.clearMatrixFromEvent(e)}keyPress(e){}};l(zr,"keyMapping",{Enter:"RETURN"," ":"SPACE",Backspace:"DELETE",ArrowRight:"CRSR_RT",ArrowDown:"CRSR_DN",ArrowUp:["CRSR_DN","LSHIFT"],ArrowLeft:["CRSR_RT","LSHIFT"],Home:"HOME",Shift:"LSHIFT",Control:"STOP",Alt:"C=",Tab:"CTRL",Escape:"<-",Pause:"RESTORE","!":["LSHIFT","1"],'"':["LSHIFT","2"],"#":["LSHIFT","3"],$:["LSHIFT","4"],"%":["LSHIFT","5"],"&":["LSHIFT","6"],"'":["LSHIFT","7"],"(":["LSHIFT","8"],")":["LSHIFT","9"],"+":"+","-":"-","*":"*",":":":","?":["LSHIFT","/"]});let ni=zr,oi=class{constructor(e="emu-canvas"){l(this,"canvas"),l(this,"cssWidth",0),l(this,"cssHeight",0),this.id=e}getCanvas(){return this.canvas}setCanvasSize(e,r){this.cssWidth=e,this.cssHeight=r,this.canvas.style.width=e+"px",this.canvas.style.height=r+"px"}};class li{read(e){switch(e){case 0:return 127;case 1:return 255;default:throw Error("Invalid joystick port!")}}}const es=class sr{constructor(){l(this,"matrix",[]),l(this,"directionA",1),l(this,"directionB",1),l(this,"mask",0),l(this,"keysDown",new Set),l(this,"keyMapping",{}),this.clearAll()}keyToKey2(e){if(Object.keys(this.keyMapping).indexOf(e)>=0)return this.keyMapping[e];if(e.length==1)return e.toUpperCase()}setMapping(e){this.keyMapping=e}clearAll(){this.matrix=Array(8).fill(0),this.keysDown=new Set}setMatrix(e){const r=document.getElementById("emulator-keys-display");r&&(r.innerText=Array.from(this.keysDown).join(" ")),this.matrix=Array(8).fill(0),(e.has("+")||e.has("-")||e.has(":")||e.has(";")||e.has("/")||e.has("*")||e.has("@")||e.has("=")||e.has("$")||e.has(";")||e.has("?"))&&(["Shift","Alt","Control","AltGraph"].forEach(a=>{e.delete(a),this.keysDown.delete(a)}),setTimeout(()=>{this.keysDown.clear()},200)),e.forEach(a=>{const s=this.keyToKey2(a);let i=[];typeof s=="string"?i=[s]:i=s,i&&i.forEach(n=>{if(n&&Object.keys(sr.keyCodes).indexOf(n)>=0){const[o,u]=sr.keyCodes[n];this.matrix[o]|=u}})})}setMatrixFromEvent(e){this.keysDown.add(e.key),this.setMatrix(this.keysDown)}clearMatrixFromEvent(e){this.keysDown.delete(e.key),this.setMatrix(this.keysDown)}clearKeys(){this.keysDown.clear()}getMasked(){let e=0,r=this.mask;for(let a=0;a<8;a++)r&1&&(e|=this.matrix[a]),r=r>>1;return e}read(e){switch(e){case 56320:return 0;case 56321:if(this.directionA)return this.getMasked()^255;break;default:return 0}return 0}write(e,r){switch(e){case 56320:this.directionA&&(this.mask=r^255);break;case 56321:this.directionA;break}}};l(es,"keyCodes",{STOP:[7,128],Q:[7,64],"C=":[7,32],SPACE:[7,16],2:[7,8],CTRL:[7,4],"<-":[7,2],1:[7,1],"/":[6,128],"^":[6,64],"=":[6,32],RSHIFT:[6,16],HOME:[6,8],";":[6,4],"*":[6,2],"£":[6,1],",":[5,128],"@":[5,64],":":[5,32],".":[5,16],"-":[5,8],L:[5,4],P:[5,2],"+":[5,1],N:[4,128],O:[4,64],K:[4,32],M:[4,16],0:[4,8],J:[4,4],I:[4,2],9:[4,1],V:[3,128],U:[3,64],H:[3,32],B:[3,16],8:[3,8],G:[3,4],Y:[3,2],7:[3,1],X:[2,128],T:[2,64],F:[2,32],C:[2,16],6:[2,8],D:[2,4],R:[2,2],5:[2,1],LSHIFT:[1,128],E:[1,64],S:[1,32],Z:[1,16],4:[1,8],A:[1,4],W:[1,2],3:[1,1],CRSR_DN:[0,128],F5:[0,64],F3:[0,32],F1:[0,16],F7:[0,8],CRSR_RT:[0,4],RETURN:[0,2],DELETE:[0,1]});let ui=es;const Mr={start:0,data:[]};var pr=(t=>(t[t.RUNNING=0]="RUNNING",t[t.STOPPED=1]="STOPPED",t[t.DEBUG=2]="DEBUG",t))(pr||{});class ci{constructor(){l(this,"state"),l(this,"clock"),l(this,"cpu"),l(this,"cia1"),l(this,"bus"),l(this,"vic"),l(this,"view"),l(this,"keypressHandler"),l(this,"breakpoints",[])}restart(){this.bus.memoryManager.resetRAM(),this.cpu.reset(),this.vic.reset(),this.cpu.setPc(64738),this.run()}addEventListener(e,r){Object.entries(e).forEach(([a,s])=>{var i;a=="pc"&&((i=this.clock.pcCallbacks)[s]||(i[s]=[]),this.clock.pcCallbacks[s].push(r))})}removeEventListener(e,r){Object.entries(e).forEach(([a,s])=>{a=="pc"&&(this.clock.pcCallbacks[s]=this.clock.pcCallbacks[s].filter(i=>i!==r))})}setViewWithCanvasId(e){this.view=new oi}setViewSize(e,r){this.view.setCanvasSize(e,r)}init(){this.bus=new Js,this.clock=new aa,this.cia1=new sa(this.bus),this.vic=new ii(this.bus.memoryManager),this.bus.addCPU(this.cpu),this.bus.addClock(this.clock),this.clock.addBus(this.bus),this.cpu.addBus(this.bus),this.bus.addVIC(this.vic),this.bus.addCIA1(this.cia1),this.bus.addKeyboard(new ui),this.bus.addJoystick(new li),this.keypressHandler=new ni(this.bus.keyboard);const e=[],r=[],a=[],s={romCharset:new Hr(e),kernal:new Xr(r),basicRom:new $r(a),io:new zs(this.vic)};this.bus.memoryManager.setOptions(s),this.state=1}setROMS(e){this.bus.memoryManager.setOptions(e),this.restart()}getData(e,r,a){return Mr}getDataFromRam(e,r){return Mr}sendKeys(e){}setDataInRam(e){const{start:r,data:a}=e;for(let s=0;s<a.length;s++){const i=r+s,n=a[s];this.bus.write(i,n,!1)}}setDataInIO(e){}getByte(e,r){return this.bus.memoryManager.readWithPLA(e,r.plaSetup,r.page||0)}getByteFromRam(e){return this.bus.memoryManager.readWithPLA(e,I.FULL_RAM,0)}setByteInRam(e,r){this.bus.write(e,r,!1)}setByteInIO(e,r){this.bus.write(e,r,!0)}setByteInCartRam(e,r,a){throw Error("Not implemented!")}run(){this.state=0}pause(){this.state=1}step(){this.renderNextInstruction(),this.state=1}renderNextInstruction(){this.clock.renderNext()}renderManyInstructions(e){for(let r=0;r<e;r++)this.clock.renderNext()}renderFullFrame(e){this.clock.renderFrame(e)}renderVIC(){this.clock.renderVIC()}debugNextInstruction(e){}debugManyInstructions(e,r){}debugFullFrame(e){}debugUntilBreakpoint(e){}mainLoop(){switch(this.state){case 0:{this.renderFullFrame(1);break}case 2:this.debugUntilBreakpoint(this.breakpoints),this.breakpoints&&this.breakpoints.indexOf(this.cpu.pc)!=-1&&(this.state=1);break}}paintOnCtx(e){e.putImageData(this.vic.getImageData(),0,0)}onLoaded(e){}resizeCanvas(e){e instanceof HTMLCanvasElement&&(e.width=this.vic.onscreenWidth,e.height=this.vic.onscreenHeight)}onKeyDown(e){e.preventDefault(),this.bus.keyboard.setMatrixFromEvent(e)}onKeyUp(e){e.preventDefault(),this.bus.keyboard.clearMatrixFromEvent(e)}clearKeys(){this.bus.keyboard.clearKeys()}loadFile(){}}class Lr extends ci{constructor(){super(),this.cpu=new ia}onLoaded(e){[42638,42291,42615].forEach(a=>{this.cpu.sysCall(a)});const r=e.start+e.data.length+5;[46,48,50].forEach(a=>{this.cpu.write(a,r>>8),this.cpu.write(a-1,r&255)})}}var Y=(t=>(t[t.scopeString=0]="scopeString",t[t.scopeCommand=1]="scopeCommand",t[t.scopeRem=2]="scopeRem",t[t.scopeArgs=3]="scopeArgs",t))(Y||{});class Ye{static encodeTextAsBytes(e){return[0]}static voidEncoder(e){return[]}}class J{static screenCodeToChar(e,r=!1){return r?[`@ABCDEFGHIJKLMNOPQRSTUVWXYZ[£]↑← !"#$%&'()*+,-./0123456789:;<=>?━♠│─▔▔▁▍▕╮╰╯└╲╱┌┐●▁♥▏╭╳○♣▕♦➕⡇|.. ▌▄‾▁▎▒▕⣤.▕┣▗┗┓▂┏┻┳┫▎▍▐‾▀▃.▖▝┛▘▚`[e&127],(e&128)>0]:[`@abcdefghijklmnopqrstuvwxyz[£]↑← !"#$%&'()*+,-./0123456789:;<=>?━ABCDEFGHIJKLMNOPQRSTUVWXYZ➕⡇|π◥ ▌▄‾▁▎▒▕⣤◤▕┣▗┗┓▂┏┻┳┫▎▍▐‾▀▃⅃▖▝┛▘▚`[e&127],(e&128)>0]}static petsciiCodeToScreen(e){let r=0;return e<32?r=e+128:32<=e&&e<64?r=e:64<=e&&e<96?r=e-64:96<=e&&e<128?r=e-32:128<=e&&e<160?r=e+64:160<=e&&e<192?r=e-64:192<=e&&e<224||224<=e&&e<255?r=e-128:e==255&&(r=94),r}static textToPetscii(e){let r=e.charCodeAt(0);return(65<=r&&r<=90||97<=r&&r<=122)&&(r^=32),r}static textToScreen(e){const r=J.textToPetscii(e);return J.petsciiCodeToScreen(r)}static petsciiCodeToChar(e,r=!1){return J.screenCodeToChar(J.petsciiCodeToScreen(e),r)}static screenCodeToEscaped(e,r=!1){if(r)throw Error("Small character conversion not implemented!");return e==64||e>=91?["code",e]:["chr",`@abcdefghijklmnopqrstuvwxyz[£]↑← !"#$%&'()*+,-./0123456789:;<=>?━ABCDEFGHIJKLMNOPQRSTUVWXYZ`[e]]}static petsciiCodeToEscaped(e,r=!1){const a=J.petsciiCodeToScreen(e),s=J.screenCodeToEscaped(a,r);return s[0]=="code"&&(s[1]=e),s}static petsciiCodeToSafe(e,r=!1){const[a,s]=J.petsciiCodeToEscaped(e,r);return a=="chr"?s:"?"}}const Rt={locate:[128,130],read:[129,128],break:[130,192],call:[131,128],def:[132,160],endif:[133,192],for:[134,160],goto:[135,129],local:[136,128],if:[137,176],fend:[138,192],clr:[139,128],let:[140,128],memset:[141,130],next:[142,192],on:[143,128],poke:[144,129],continue:[145,192],repeat:[146,160],set:[147,128],then:[148,192],until:[149,129],voice:[150,136],while:[151,129],exec:[152,129],input:[153,129],sys:[154,128],CHAR:[160,0],F08:[161,24],DQUOTE:[162,2],WORD:[163,21],UWORD:[164,17],F2416:[165,30],BYTE:[166,16],SQUOTE:[167,2],F88:[168,29],FLOAT:[169,31],DCHAR:[170,1],inc:[171,128],QQUOTE:[172,2],dec:[173,128],_label:[174,128],rem:[175,128],"+":[176,34],"-":[177,34],"*":[178,35],AND:[179,32],"&&":[179,32],div:[180,35],"/":[180,35],OR:[181,32],"||":[181,32],mod:[182,35],"%":[182,35],xor:[183,36],"^":[183,36],and:[184,36],"&":[184,36],or:[185,36],"|":[185,36],"<":[186,33],"==":[187,33],"=":[187,33],">=":[188,33],"!=":[189,33],"<>":[189,33],"<=":[190,33],">":[191,33],print:[192,128],data:[193,128],bitmap:[194,136],fcall:[195,128],dend:[196,192],else:[197,144],fast:[198,160],gosub:[199,129],elif:[200,144],dim:[201,160],open:[202,128],color:[203,130],loop:[204,192],memcopy:[205,130],end:[206,192],do:[207,224],dpoke:[208,129],close:[209,129],return:[210,129],sprite:[211,136],timer:[212,128],get:[213,128],font:[214,136],wait:[215,130],inkey:[217,128],settings:[218,128],to:[220,64],pi:[222,64],right:[223,98],_lf:[224,192],cos:[225,97],int:[226,97],tan:[227,97],addr:[228,64],sgn:[229,97],limit:[230,98],mid:[231,98],step:[232,64],fpi:[233,64],atn:[234,97],frac:[235,97],dpeek:[236,98],spc:[237,97],sin:[238,97],peek:[239,98],abs:[240,97],left:[241,98],rnd:[242,98],when:[243,98],has:[244,98],tab:[245,97],len:[246,97],time:[247,64],sub:[248,96],ord:[249,97],_sh_lf:[250,0],fn:[251,64],chr:[252,97],find:[253,96],val:[254,97],between:[255,98]},gi={128:["locate",130],129:["read",128],130:["break",192],131:["call",128],132:["def",160],133:["endif",192],134:["for",160],135:["goto",129],136:["local",128],137:["if",176],138:["fend",192],139:["clr",128],140:["let",128],141:["memset",130],142:["next",192],143:["on",128],144:["poke",129],145:["continue",192],146:["repeat",160],147:["set",128],148:["then",192],149:["until",129],150:["voice",136],151:["while",129],152:["exec",129],153:["input",129],154:["sys",128],160:["CHAR",0],161:["F08",24],162:["DQUOTE",2],163:["WORD",21],164:["UWORD",17],165:["F2416",30],166:["BYTE",16],167:["SQUOTE",2],168:["F88",29],169:["FLOAT",31],170:["DCHAR",1],171:["inc",128],172:["QQUOTE",2],173:["dec",128],174:["_label",128],175:["rem",128],176:["+",34],177:["-",34],178:["*",35],179:["&&",32],180:["/",35],181:["||",32],182:["%",35],183:["^",36],184:["&",36],185:["|",36],186:["<",33],187:["=",33],188:[">=",33],189:["<>",33],190:["<=",33],191:[">",33],192:["print",128],193:["data",128],194:["bitmap",136],195:["fcall",128],196:["dend",192],197:["else",144],198:["fast",160],199:["gosub",129],200:["elif",144],201:["dim",160],202:["open",128],203:["color",130],204:["loop",192],205:["memcopy",130],206:["end",192],207:["do",224],208:["dpoke",129],209:["close",129],210:["return",129],211:["sprite",136],212:["timer",128],213:["get",128],214:["font",136],215:["wait",130],217:["inkey",128],218:["settings",128],220:["to",64],222:["pi",64],223:["right",98],224:["_lf",192],225:["cos",97],226:["int",97],227:["tan",97],228:["addr",64],229:["sgn",97],230:["limit",98],231:["mid",98],232:["step",64],233:["fpi",64],234:["atn",97],235:["frac",97],236:["dpeek",98],237:["spc",97],238:["sin",97],239:["peek",98],240:["abs",97],241:["left",98],242:["rnd",98],243:["when",98],244:["has",98],245:["tab",97],246:["len",97],247:["time",64],248:["sub",96],249:["ord",97],250:["_sh_lf",0],251:["fn",64],252:["chr",97],253:["find",96],254:["val",97],255:["between",98]},pi={print:[192,128],locate:[128,130],inc:[171,128],dec:[173,128],let:[140,128],set:[147,128],for:[134,160],next:[142,192],repeat:[146,160],if:[137,176],then:[148,192],endif:[133,192],else:[197,144],elif:[200,144],do:[207,224],loop:[204,192],while:[151,129],until:[149,129],fast:[198,160],fcall:[195,128],fend:[138,192],poke:[144,129],dpoke:[208,129],read:[129,128],def:[132,160],call:[131,128],dend:[196,192],goto:[135,129],gosub:[199,129],on:[143,128],return:[210,129],end:[206,192],clr:[139,128],dim:[201,160],local:[136,128],inkey:[217,128],sys:[154,128],wait:[215,130],input:[153,129],timer:[212,128],memcopy:[205,130],memset:[141,130],color:[203,130],data:[193,128],exec:[152,129],open:[202,128],get:[213,128],close:[209,129],break:[130,192],continue:[145,192],sprite:[211,136],voice:[150,136],bitmap:[194,136],font:[214,136],settings:[218,128]},di={print:192,locate:128,inc:171,dec:173,let:140,set:147,for:134,next:142,repeat:146,if:137,then:148,endif:133,else:197,elif:200,do:207,loop:204,while:151,until:149,fast:198,fcall:195,fend:138,poke:144,dpoke:208,read:129,def:132,call:131,dend:196,goto:135,gosub:199,on:143,return:210,end:206,clr:139,dim:201,local:136,inkey:217,sys:154,wait:215,input:153,timer:212,memcopy:205,memset:141,color:203,data:193,exec:152,open:202,get:213,close:209,break:130,continue:145,sprite:211,voice:150,bitmap:194,font:214,settings:218},zt={BYTE:{shortCode:"b",longCode:"BYTE",tokenValue:166,type_value:16,rangeMin:0,rangeMax:256,description:"8bit integer number, values: 0..255"},WORD:{shortCode:"W",longCode:"WORD",tokenValue:163,type_value:21,rangeMin:-32768,rangeMax:32768,description:"16bit signed integer number, values: -32768..32767"},UWORD:{shortCode:"w",longCode:"UWORD",tokenValue:164,type_value:17,rangeMin:0,rangeMax:65536,description:"16bit unsigned integer number, values: 0..65535"},F08:{shortCode:"f",longCode:"F08",tokenValue:0,type_value:24,rangeMin:0,rangeMax:1,description:"8bit unsigned fractional number, values: 0.0..1.0"},F88:{shortCode:"S",longCode:"F88",tokenValue:0,type_value:29,rangeMin:-128,rangeMax:128,description:"16bit signed fractional number, values: -128.0..128.0"},F2416:{shortCode:"L",longCode:"F2416",tokenValue:165,type_value:30,rangeMin:null,rangeMax:null,description:"5 bytes signed number, 24bit integer and 16 bit fractional part"},FLOAT:{shortCode:"%",longCode:"FLOAT",tokenValue:0,type_value:31,rangeMin:null,rangeMax:null,description:"Legacy float number"},CHAR:{shortCode:"c",longCode:"CHAR",tokenValue:160,type_value:0,rangeMin:null,rangeMax:null,description:"8bit single character"},DCHAR:{shortCode:"d",longCode:"DCHAR",tokenValue:0,type_value:1,rangeMin:null,rangeMax:null,description:"16bit, 2 characters"},VARSTR:{shortCode:"$",longCode:"VARSTR",tokenValue:-1,type_value:2,rangeMin:null,rangeMax:null,description:"Variable length string - each operation creates a new item in memory. Data: [len][STR...]"},FIXSTR:{shortCode:"$",longCode:"FIXSTR",tokenValue:-1,type_value:3,rangeMin:null,rangeMax:null,description:"Fixed length string, always uses the same memory. Data: [maxlen][len][STR...][unused...]"},NONE:{shortCode:"0",longCode:"NONE",tokenValue:0,type_value:0,rangeMin:0,rangeMax:0,description:""},UBYTE:{shortCode:"b",longCode:"UBYTE",tokenValue:0,type_value:16,rangeMin:0,rangeMax:256,description:""},SBYTE:{shortCode:"B",longCode:"SBYTE",tokenValue:0,type_value:20,rangeMin:-128,rangeMax:128,description:""},SWORD:{shortCode:"W",longCode:"SWORD",tokenValue:0,type_value:21,rangeMin:-32768,rangeMax:32768,description:""},UF08:{shortCode:"f",longCode:"UF08",tokenValue:0,type_value:24,rangeMin:0,rangeMax:1,description:""},SF08:{shortCode:"F",longCode:"SF08",tokenValue:0,type_value:28,rangeMin:null,rangeMax:null,description:""},UF88:{shortCode:"s",longCode:"UF88",tokenValue:0,type_value:25,rangeMin:0,rangeMax:256,description:""},SF88:{shortCode:"S",longCode:"SF88",tokenValue:0,type_value:29,rangeMin:-128,rangeMax:128,description:""},UF2416:{shortCode:"l",longCode:"UF2416",tokenValue:0,type_value:26,rangeMin:null,rangeMax:null,description:""},SF2416:{shortCode:"L",longCode:"SF2416",tokenValue:0,type_value:30,rangeMin:null,rangeMax:null,description:""}},Jt={b:{shortCode:"b",longCode:"UBYTE",tokenValue:0,type_value:16,rangeMin:0,rangeMax:256,description:""},W:{shortCode:"W",longCode:"SWORD",tokenValue:0,type_value:21,rangeMin:-32768,rangeMax:32768,description:""},w:{shortCode:"w",longCode:"UWORD",tokenValue:164,type_value:17,rangeMin:0,rangeMax:65536,description:"16bit unsigned integer number, values: 0..65535"},f:{shortCode:"f",longCode:"UF08",tokenValue:0,type_value:24,rangeMin:0,rangeMax:1,description:""},S:{shortCode:"S",longCode:"SF88",tokenValue:0,type_value:29,rangeMin:-128,rangeMax:128,description:""},L:{shortCode:"L",longCode:"SF2416",tokenValue:0,type_value:30,rangeMin:null,rangeMax:null,description:""},"%":{shortCode:"%",longCode:"FLOAT",tokenValue:0,type_value:31,rangeMin:null,rangeMax:null,description:"Legacy float number"},c:{shortCode:"c",longCode:"CHAR",tokenValue:160,type_value:0,rangeMin:null,rangeMax:null,description:"8bit single character"},d:{shortCode:"d",longCode:"DCHAR",tokenValue:0,type_value:1,rangeMin:null,rangeMax:null,description:"16bit, 2 characters"},$:{shortCode:"$",longCode:"FIXSTR",tokenValue:-1,type_value:3,rangeMin:null,rangeMax:null,description:"Fixed length string, always uses the same memory. Data: [maxlen][len][STR...][unused...]"},0:{shortCode:"0",longCode:"NONE",tokenValue:0,type_value:0,rangeMin:0,rangeMax:0,description:""},B:{shortCode:"B",longCode:"SBYTE",tokenValue:0,type_value:20,rangeMin:-128,rangeMax:128,description:""},F:{shortCode:"F",longCode:"SF08",tokenValue:0,type_value:28,rangeMin:null,rangeMax:null,description:""},s:{shortCode:"s",longCode:"UF88",tokenValue:0,type_value:25,rangeMin:0,rangeMax:256,description:""},l:{shortCode:"l",longCode:"UF2416",tokenValue:0,type_value:26,rangeMin:null,rangeMax:null,description:""}},hi={font_set_source0_target0:0,font_set_source0_target1:1,font_set_source1_target0:4,font_set_source1_target1:5,font_set_source_rom_target0:8,font_set_source_rom_target1:9,font_def_uncompressed_multi:16,font_def_uncompressed_1:17,font_def_uncompressed_2:18,font_def_uncompressed_3:19,font_def_uncompressed_4:20,font_def_uncompressed_5:21,font_def_uncompressed_6:22,font_def_uncompressed_7:23,font_copy_full:24,font_copy_lo:25,font_copy_hi:26,font_copy_range_same_index:27,font_copy_range:28,font_create_2x1:32,font_create_2x2:33,font_map_4x4_from:35,font_map_4x4_full:36,font_map_4x8_default:37,font_map_4x8_full:38,font_map_8x4_default:39,font_map_8x4_full:40,font_set_8x8_fill:41,font_use_1x1:48,font_use_2x1:49,font_use_2x2:50,font_use_4x4:51,font_use_4x8:52,font_use_8x4:53,font_use_8x8:54,font_invert_all:64,font_invert_range:65,font_create_from_spr_3x3:81,font_create_from_spr_3x2:82,font_create_from_spr_2x3:83,font_create_from_spr_2x2:84},bi={pi:[222,64],fpi:[233,64],to:[220,64],step:[232,64],peek:[239,98],dpeek:[236,98],rnd:[242,98],cos:[225,97],sin:[238,97],tan:[227,97],atn:[234,97],int:[226,97],frac:[235,97],ord:[249,97],chr:[252,97],when:[243,98],addr:[228,64],len:[246,97],val:[254,97],abs:[240,97],left:[241,98],mid:[231,98],right:[223,98],find:[253,96],sub:[248,96],time:[247,64],tab:[245,97],spc:[237,97],sgn:[229,97],fn:[251,64],has:[244,98],between:[255,98],limit:[230,98]},fi={type:["t",0,0],size:["S",0,0],addr:["@",0,0],word:["w",32,0],byte:["b",32,0],fx2:["f",32,0],fx5:["F",32,0],frac:["F×",32,0],chr:["$",48,16],str:["s",48,16],int:["i",48,16],abs:["a",48,16],sign:["n",48,16],rdn:["r",48,16],rup:["R",48,16],minus:["M×",48,16],plus:["P×",48,16],dbl:["d",48,16],div2:["D",48,16],ord:["o",48,0],ucase:["C",48,0],lcase:["c",48,0],lo:["l",0,0],hi:["h",0,0],lnib:["L",0,0],hnib:["H",0,0],lnib2:["L×",0,0],hnib2:["H×",0,0],getw:["G",24,16],getb:["g",24,16],avg:["A",32,32],sum:["S×",32,32],min:["m",255,1],max:["M",255,1],ix:["I×",255,1],jx:["J×",255,1],kx:["K×",255,1],push:["p",255,1],pop:["P",255,1],ax:["A×",255,1],axm:["x",255,1]},Ai={tab:128,transparent:129,recolor_only:130,stop:131,scroll_actual_column:132,white:133,home_current_line:134,end_current_line:135,disable_c_shift:136,enable_c_shift:137,rep_next:138,rep_double:139,rep_between:140,return:141,lo_up_charset:142,scroll_circular_on:143,scroll_actual_line:144,down:145,reverse_on:146,home:147,delete:148,clear_line_content:149,remove_line:150,scroll_left:151,scroll_right:152,scroll_up:153,scroll_down:154,setx:155,red:156,right:157,green:158,blue:159,stamp_set_mode:160,stamp_use:161,stamp_use_last:162,window_start:163,window_stop:164,box_set_single:165,box_set_style:166,box_user_def:167,box_draw_filled:168,box_draw_empty:169,box_set_sides:170,box_box_filled_compr:171,box_box_empty_compr:172,use_fn:173,setxy:174,typewriter_mode:175,buffer_def:176,buffer_opt:177,buffer_copy:178,buffer_paste:179,input_rx:180,input_cursor:181,format_str:182,format_dec:183,format_hex:184,decompress:185,set_mode_a:186,set_mode_b:187,set_mode_c:188,scroll_set_area:189,scroll_window:190,scroll_screen:191,background:192,orange:193,border:194,run:195,sety:196,f1:197,f3:198,f5:199,f7:200,f2:201,f4:202,f6:203,f8:204,shift_return:205,up_gfx_charset:206,scroll_circular_off:207,black:208,up:209,reverse_off:210,clear:211,insert:212,brown:213,pink:214,dark_gray:215,gray:216,light_green:217,light_blue:218,light_gray:219,purple:220,cursor_left:221,yellow:222,cyan:223,set_addr0:224,set_addr1:225,set_addr2:226,set_addr3:227,push_one:228,push_two:229,push_multi:230,print_src_var:231,print_src_addr:232,print_db:233,print_dw:234,print_hb:235,print_hw:236,print_s:237,print_f:238,format_f:239,def_f1:240,def_f3:241,def_f5:242,def_f7:243,def_f2:244,def_f4:245,def_f6:246,def_f8:247,parambuff_susp:248,parambuff_on:249,parambuff_off:250,set_col_bckg:251,set_col_bord:252,set_col_bcbd:253,decode:254,extra_ff:255,pos_save:65281,pos_load:65282,qsys:65283,qsys_bank:65284,set_tab:65285,poke_single:65286,set_mem:65287,fill_mem:65288},er={0:"@",1:"a",2:"b",3:"c",4:"d",5:"e",6:"f",7:"g",8:"h",9:"i",10:"j",11:"k",12:"l",13:"m",14:"n",15:"o",16:"p",17:"q",18:"r",19:"s",20:"t",21:"u",22:"v",23:"w",24:"x",25:"y",26:"z",27:"[",29:"]",32:" ",33:"!",34:'"',35:"#",36:"$",37:"%",38:"&",39:"'",40:"(",41:")",42:"*",43:"+",44:",",45:"-",46:".",47:"/",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",58:":",59:";",60:"<",61:"=",62:">",63:"?",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",97:"K×",98:"I×",99:"T×",101:"G×",103:"M×",106:"N×",107:"Q×",108:"D×",109:"Z×",110:"S×",111:"P×",112:"A×",113:"E×",114:"R×",115:"W×",116:"H×",117:"J×",118:"L×",119:"Y×",120:"U×",121:"O×",123:"F×",124:"C×",125:"X×",126:"V×",127:"B×",28:"{POUND}",30:"{ARR UP}",31:"{ARR LEFT}",64:"{SH *}",91:"{SH +}",92:"{CM -}",93:"{SH -}",94:"{PI}",95:"{CM *}",96:"{SH SPACE}",100:"{CM @}",102:"{CM +}",104:"{CM POUND}",105:"{SH POUND}",122:"{SH @}"},de={"@":0,a:1,b:2,c:3,d:4,e:5,f:6,g:7,h:8,i:9,j:10,k:11,l:12,m:13,n:14,o:15,p:16,q:17,r:18,s:19,t:20,u:21,v:22,w:23,x:24,y:25,z:26,"[":27,"]":29," ":32,"!":33,'"':34,"#":35,$:36,"%":37,"&":38,"'":39,"(":40,")":41,"*":42,"+":43,",":44,"-":45,".":46,"/":47,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,":":58,";":59,"<":60,"=":61,">":62,"?":63,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,"K×":97,"I×":98,"T×":99,"G×":101,"M×":103,"N×":106,"Q×":107,"D×":108,"Z×":109,"S×":110,"P×":111,"A×":112,"E×":113,"R×":114,"W×":115,"H×":116,"J×":117,"L×":118,"Y×":119,"U×":120,"O×":121,"F×":123,"C×":124,"X×":125,"V×":126,"B×":127,"{POUND}":28,"{ARR UP}":30,"{ARR LEFT}":31,"{SH *}":64,"{SH +}":91,"{CM -}":92,"{SH -}":93,"{PI}":94,"{CM *}":95,"{SH SPACE}":96,"{CM @}":100,"{CM +}":102,"{CM POUND}":104,"{SH POUND}":105,"{SH @}":122,Ł:28,"^":30,"~":31,"<==":31,"<_":31,"<--":31},mi={spr_autoinc_0:0,spr_copy_idx:3,spr_rot_fill:4,spr_mirr_fill_multi:5,spr_mirr_fill_sing:6,spr_spec:15,spr_mirr_h_mult:16,spr_mirr_h_sing:17,spr_mirr_v:18,spr_rot90:19,spr_rot180_sing:20,spr_rot180_mult:21,spr_rot270:22,spr_rot90_mirr_h_sing:23,spr_rot90_mirr_v_sing:24,spr_sh_left_mult:26,spr_sh_right_mult:27,spr_sh_left_sing:28,spr_sh_right_sing:29,spr_sh_up:30,spr_sh_down:31,spr_def_raw:33,spr_copy:34,spr_def_cmp0:35,spr_def_cmp_base:36,spr_double_x:41,spr_double_y:42,spr_double_xy:43,spr_use_predef0:48,spr_use_predef1:49,spr_use_predef2:50,spr_use_predef3:51,spr_use_predef4:52,spr_use_predef5:53,spr_use_predef6:54,spr_use_predef7:55,spr_set_predef0:56,spr_set_predef1:57,spr_set_predef2:58,spr_set_predef3:59,spr_set_predef4:60,spr_set_predef5:61,spr_set_predef6:62,spr_set_predef7:63,spr_autoinc_S:64,spr_inc_S:65,spr_dec_S:66,spr_copy_idx_S:67,spr_rot_fill_S:68,spr_mirr_fill_multi_S:69,spr_mirr_fill_sing_S:70,spr_spec_S:79,spr_mirr_h_mult_S:80,spr_mirr_h_sing_S:81,spr_mirr_v_S:82,spr_rot90_S:83,spr_rot180_sing_S:84,spr_rot180_mult_S:85,spr_rot270_S:86,spr_rot90_mirr_h_sing_S:87,spr_rot90_mirr_v_sing_S:88,spr_sh_left_mult_S:90,spr_sh_right_mult_S:91,spr_sh_left_sing_S:92,spr_sh_right_sing_S:93,spr_sh_up_S:94,spr_sh_down_S:95,spr_set_idx_S:96,spr_def_raw_S:97,spr_copy_S:98,spr_def_cmp0_S:99,spr_def_cmp_base_S:100,spr_double_x_S:105,spr_double_y_S:106,spr_double_xy_S:107,spr_use_predef0_S:112,spr_use_predef1_S:113,spr_use_predef2_S:114,spr_use_predef3_S:115,spr_use_predef4_S:116,spr_use_predef5_S:117,spr_use_predef6_S:118,spr_use_predef7_S:119,spr_set_predef0_S:120,spr_set_predef1_S:121,spr_set_predef2_S:122,spr_set_predef3_S:123,spr_set_predef4_S:124,spr_set_predef5_S:125,spr_set_predef6_S:126,spr_set_predef7_S:127,spr_autoinc_T:128,spr_inc_T:129,spr_dec_T:130,spr_copy_idx_T:131,spr_rot_fill_T:132,spr_mirr_fill_multi_T:133,spr_mirr_fill_sing_T:134,spr_spec_T:143,spr_mirr_h_mult_T:144,spr_mirr_h_sing_T:145,spr_mirr_v_T:146,spr_rot90_T:147,spr_rot180_sing_T:148,spr_rot180_mult_T:149,spr_rot270_T:150,spr_rot90_mirr_h_sing_T:151,spr_rot90_mirr_v_sing_T:152,spr_sh_left_mult_T:154,spr_sh_right_mult_T:155,spr_sh_left_sing_T:156,spr_sh_right_sing_T:157,spr_sh_up_T:158,spr_sh_down_T:159,spr_set_idx_T:160,spr_def_raw_T:161,spr_copy_T:162,spr_def_cmp0_T:163,spr_def_cmp_base_T:164,spr_double_x_T:169,spr_double_y_T:170,spr_double_xy_T:171,spr_use_predef0_T:176,spr_use_predef1_T:177,spr_use_predef2_T:178,spr_use_predef3_T:179,spr_use_predef4_T:180,spr_use_predef5_T:181,spr_use_predef6_T:182,spr_use_predef7_T:183,spr_set_predef0_T:184,spr_set_predef1_T:185,spr_set_predef2_T:186,spr_set_predef3_T:187,spr_set_predef4_T:188,spr_set_predef5_T:189,spr_set_predef6_T:190,spr_set_predef7_T:191,spr_autoinc_TS:192,spr_inc_TS:193,spr_dec_TS:194,spr_copy_idx_TS:195,spr_rot_fill_TS:196,spr_mirr_fill_multi_TS:197,spr_mirr_fill_sing_TS:198,spr_spec_TS:207,spr_mirr_h_mult_TS:208,spr_mirr_h_sing_TS:209,spr_mirr_v_TS:210,spr_rot90_TS:211,spr_rot180_sing_TS:212,spr_rot180_mult_TS:213,spr_rot270_TS:214,spr_rot90_mirr_h_sing_TS:215,spr_rot90_mirr_v_sing_TS:216,spr_sh_left_mult_TS:218,spr_sh_right_mult_TS:219,spr_sh_left_sing_TS:220,spr_sh_right_sing_TS:221,spr_sh_up_TS:222,spr_sh_down_TS:223,spr_set_idx_TS:224,spr_def_raw_TS:225,spr_copy_TS:226,spr_def_cmp0_TS:227,spr_def_cmp_base_TS:228,spr_double_x_TS:233,spr_double_y_TS:234,spr_double_xy_TS:235,spr_use_predef0_TS:240,spr_use_predef1_TS:241,spr_use_predef2_TS:242,spr_use_predef3_TS:243,spr_use_predef4_TS:244,spr_use_predef5_TS:245,spr_use_predef6_TS:246,spr_use_predef7_TS:247,spr_set_predef0_TS:248,spr_set_predef1_TS:249,spr_set_predef2_TS:250,spr_set_predef3_TS:251,spr_set_predef4_TS:252,spr_set_predef5_TS:253,spr_set_predef6_TS:254,spr_set_predef7_TS:255},Qe={NEXT_ADDR:32,BRANCH_ADDR:16,FN_WITH_BRACKET:32,COMMAND:128},je={a:1,b:2,c:3,d:4,e:5,f:6,g:7,h:8,i:9,j:10,k:11,l:12,m:13,n:14,o:15,p:16,q:17,r:18,s:19,t:20,u:21,v:22,w:23,x:24,y:25,z:26,A:27,B:28,C:29,D:30,E:31,F:32,G:33,H:34,I:35,J:36,K:37,L:38,M:39,N:40,O:41,P:42,Q:43,R:44,S:45,T:46,U:47,V:48,W:49,X:50,Y:51,Z:52,Ax:53,Bx:54,Cx:55,Dx:56,Ex:57,Fx:58,Gx:59,Hx:60,Ix:61,Jx:62,Kx:63,Lx:64,Mx:65,Nx:66,Ox:67,Px:68,Qx:69,Rx:70,Sx:71,Tx:72,Ux:73,Vx:74,Wx:75,Xx:76,Yx:77,Zx:78},D=class{};D.CTT_COMMAND_TOKENS=gi,D.TTC_COMMAND_TOKENS=Object.fromEntries(Object.entries(Rt).map(([t,e])=>[t,e[0]])),D.TTC_SCREEN_TOKENS={...Ai,...mi,...hi},D.TTC_STRING_TOKENS=D.TTC_SCREEN_TOKENS,D.TTC_STRING_TOKENS_UPPER=Object.fromEntries(Object.entries(D.TTC_STRING_TOKENS).map(([t,e])=>[t.toUpperCase(),e])),D.CTT_STRING_TOKENS=Object.fromEntries(Object.entries(D.TTC_STRING_TOKENS).filter(([t,e])=>t.indexOf("spr_")!==0).map(([t,e])=>[e,t])),D.EXTRA_ZEROS=Object.fromEntries(Object.entries(Rt).map(([t,e])=>{let r=0;return e[1]&Qe.COMMAND&&e[1]&(Qe.NEXT_ADDR|Qe.BRANCH_ADDR)&&(e[1]&Qe.NEXT_ADDR&&r++,e[1]&Qe.BRANCH_ADDR&&r++),[t,r*2]})),D.IS_COMMAND=Object.fromEntries(Object.entries(Rt).map(([t,e])=>[t,!!(e[1]&Qe.COMMAND)])),D.CTT_SPRITE_TOKENS=Object.fromEntries(Object.entries(D.TTC_STRING_TOKENS).filter(([t,e])=>t.indexOf("spr_")==0).map(([t,e])=>[e,t])),D.blockEndToken=D.TTC_COMMAND_TOKENS._lf,D.finalToken=D.TTC_COMMAND_TOKENS.end,D.strDQuote=D.TTC_COMMAND_TOKENS.DQUOTE,D.strSQuote=D.TTC_COMMAND_TOKENS.SQUOTE,D.strBQuote=D.TTC_COMMAND_TOKENS.SQUOTE,D.strQQuote=D.TTC_COMMAND_TOKENS.QQUOTE,D.cmdParams={...pi},D.gbFuncs={SETPOS(t,e){const r=parseInt(t,10)+parseInt(e,10)*40;return[D.TTC_SCREEN_TOKENS.set_addr0+(r>>8),r&255]}};let U=D;const ts=class ar{static getTokensFromMemory(e,r=2049){const a=function(u,d){return u+d*256},s=[];let i=0,n=r,o="";for(;i<e.length;){let u=function(m){if(h>=128){const x=U.CTT_COMMAND_TOKENS[h];if(!x)return;m.key=h>162?"func":"command",m.value=x,o=x}h>=65&&h<=90&&(m.key="identifier",m.value=m.escapedValue),h==32&&(m.key="whiteSpc",m.value=m.escapedValue)};if(n<i+r||n<r||n>r+e.length){console.log(`Invalid address ${n}`);break}if(i=n-r,n=a(e[i],e[i+1]),n==0)break;const d=a(e[i+2],e[i+3]);s.push({key:"label",value:d.toString(10),pos:i+r}),i+=4;let p;p=Y.scopeCommand;const g={key:"error",value:"error",escapedMode:"",escapedValue:""};let h=0;for(;i+r<n&&(h=e[i],h!=0);){switch(g.value="error",g.key="error",[g.escapedMode,g.escapedValue]=J.petsciiCodeToEscaped(h),p){case Y.scopeCommand:u(g),p=Y.scopeArgs,g.value=="rem"&&(p=Y.scopeRem);break;case Y.scopeRem:g.key="rem",g.value=g.escapedValue;break;case Y.scopeString:if(g.escapedValue=='"'?(p=Y.scopeArgs,g.key="other"):g.key="strDQuote",g.escapedMode=="code"){const m=ar.STR_CODES[o]||ar.STR_CODES.print;g.value=m[h]?`{${m[h]}}`:`{${g.escapedValue}}`}else g.value=g.escapedValue;break;case Y.scopeArgs:g.value=g.escapedValue,g.key="other",u(g),g.value=='"'?p=Y.scopeString:g.value==":"?p=Y.scopeCommand:(g.value>="0"&&g.value<="9"||g.value==".")&&(g.key="floatNum");break}s.push({key:g.key,value:g.value,pos:i+r}),i++}s.push({key:"newLines",value:`
`,pos:i+r})}return s}static tokenArrayToRepr(e){let r="";return e.forEach(a=>{r+=a.value}),r}};ts.STR_CODES={print:U.CTT_STRING_TOKENS,sprite:U.CTT_SPRITE_TOKENS,font:U.CTT_STRING_TOKENS};let rs=ts;const ir=class gt{static getGroups(e){const r={};return e===void 0||e?.groups===void 0?{}:(Object.keys(e.groups).forEach(a=>{if(e.groups&&e.groups[a]!==void 0&&e.groups[a]!==""){const s=e.groups[a];r[a]=s}}),r)}static verboseRegexp(e,r){const a=new RegExp("(?<!\\\\)\\s|[/][/].*|[/][*][\\s\\S]*[*][/]","g"),s=e.replace(a,"");return new RegExp(s,r)}static convertSpecToBytes(e,r){const a=r.tokens||{},s=r.funcs||{},i=r.worldLH===void 0?!0:r.worldLH;r.useUppercase===void 0||r.useUppercase;const n=[];let o;function u(h,m=!1){return!m&&h<256?[h]:i?[h&255,h>>8&255]:[h>>8&255,h&255]}gt.STRING_PARSER.lastIndex=0;let d=1e4;const p=[];for(;o=gt.STRING_PARSER.exec(e);){if(d--,d<0)throw"Too many iterations!";const h=gt.getGroups(o),m=o[0];if(m===""||m==null)break;let x=[];if(h.deci!==void 0){const S=h.deci.trim();x=u(parseInt(S,10),S.slice(-1).toLowerCase()=="w")}else if(h.hexa!==void 0){const S=h.hexa.replace(/[$]|(0x)/,"");x=u(parseInt(S,16),S.slice(-1).toLowerCase()=="w")}else if(h.str_extra_fn!==void 0)if(s[h.str_extra_fn]===void 0){const S=Object.keys(s).map(E=>E.toLowerCase()),P=h.str_extra_fn.toLowerCase();if(S.includes(P)){const E=Object.keys(s)[S.indexOf(P)];x=s[E](...h.str_extra_fnparam.split(/,\s*/g))}else throw new Error(`Function not implemented: ${h.str_extra_fn}`)}else x=s[h.str_extra_fn](...h.str_extra_fnparam.split(/,\s*/g));else if(h.code!==void 0){if(a[h.code]!==void 0)x=a[h.code];else{x=a.undefined;const S=h.code.toLowerCase(),P=Object.keys(a).map(E=>E.toLowerCase()).indexOf(S);P>=0&&(x=Object.values(a)[P])}x===void 0&&(p.push({code:h.code,pos:(r.pos||0)+o.index}),x=[63])}else h.sep&&h.sep.trim()==","&&(x=[0]);let W=1;h.multi&&(W=parseInt(h.multi,10)),typeof x=="number"&&(x=[x]);for(let S=0;S<W;S++)n.push(...x)}const g=p.length>0?"ERROR":"OK";return{byteArray:n,status:g,invalidCodes:p}}static convertStringToBytes(e,r){const a=[],s=[];let i,n,o="OK";const u=r.normalConverter||(p=>String.prototype.charCodeAt.bind(p)(0)),d=/({[^}]+})|(.)/g;for(;i=d.exec(e);){const[p,g,h]=i;if(g){r.pos=i.index;const{byteArray:m,status:x,invalidCodes:W}=gt.convertSpecToBytes(g.slice(1,-1),r);x!=="OK"&&(o=x,s.push(...W)),a.push(...m)}else n=u(h),a.push(n)}return{byteArray:a,status:o,invalidCodes:s}}};ir.STRING_PARSER=ir.verboseRegexp(String.raw`
         (\s*?)(
          (?<rem>(([-]{2}|[/]{2}).*$)|[/][*][\s\S]*?[*][/]) |

          ( (?<str_extra_fn>\w+\s*)[(]
            (?<str_extra_fnparam>[^)][^)]*?)
            (?<str_extra_end>[)])
          ) |

          (
            (?<code>[a-zA-Z_][a-zA-Z_0-9]*) |
            (?<hexa>(?:[$]|0x)[0-9a-fA-F]+[w]{0,1}) |
            (?<deci>[0-9]+[w]{0,1})

          )?
          (?:[*]?)
          (?<multi>[0-9]+)?
          (?<sep>[,;]\s*|$|\s+)?
        )
        `,"gm");let ft=ir;class _i extends Array{}var xe=(t=>(t.remark="remark",t.docstr="docstr",t.remMulti="remMulti",t.strDQuote="strDQuote",t.strSQuote="strSQuote",t.strBQuote="strBQuote",t.whiteSpc="whiteSpc",t.numHex="hexNum",t.numFloat="floatNum",t.numInt="intNum",t.identifier="identifier",t.other="other",t))(xe||{});const vi={remark:[1100,String.raw`(?<remark>\/\/.*$)`],remDash:[1150,String.raw`(?<remark>[\-]{2}.*$)`],docstr:[1200,String.raw`(?<docstr>\/[*]{2}[\S\s]*?[*]\/)`],remMulti:[1300,String.raw`(?<rem_multi>\/[*][\S\s]*?[*]\/)`],strDQuote:[2100,String.raw`(?<other__strDO>\")(?<strDQuote>[^\"]*?)(?<other__strDC>\")`],strSQuote:[2200,String.raw`(?<other__strSO>\')(?<strSQuote>[^\']*?)(?<other__strSC>\')`],strBQuote:[2300,String.raw`(?<other__strBO>\`)(?<strBQuote>[^\`]*?)(?<other__strBC>\`)`],whiteSpc:[3100,String.raw`(?<whiteSpc>\s+)`],hexNum:[4100,String.raw`(?<hexNum>(0x[0-9a-f]+))`],floatNum:[4200,String.raw`(?<floatNum>(\d*[.]\d*))`],intNum:[4300,String.raw`(?<intNum>(\d+))`],identifier:[8100,String.raw`(?<identifier>[\w.]+)`]};class te{constructor(e){if(!e.TokenClass||!e.splitFunc||!e.rxPattern)throw Error("Invalid TokenizerSettings object. Use class to create one!");this.settings=e,this.TokenClass=this.settings.TokenClass,this.rxPattern=new RegExp(this.settings.rxPattern,"gm"),Object.keys(e.subFormatPatterns).length>0?this.subFormatPatterns=Object.fromEntries(Object.entries(e.subFormatPatterns).map(([r,a])=>[r,te.convertTokenizerFunction(a)])):this.subFormatPatterns={},this.rawText="",this.tokens=new _i,this.linePosTable=[],this.tokenizedRaw=""}reset(){this.tokens=[],this.linePosTable=[]}static convertTokenizerFunction(e){return typeof e=="string"?te.verboseRegexp(e,"gm"):e}static verboseRegexp(e,r){const a=new RegExp("(?<!\\\\)\\s|[/][/].*|[/][*][\\s\\S]*[*][/]","g"),s=e.replace(a,"");return new RegExp(s,r)}static buildRxString(e,r=null,a="(?<other>.)"){const s=[];e.forEach(o=>{let u=r?.[o];if(u||(u=vi[o]),!u)throw Error(`Invalid item: ${o}`);s.push(u)});const i=s.sort((o,u)=>o[0]-u[0]).map(o=>o[1]);a&&i.push(a);const n=i.join(" | ");return te.verboseRegexp(n,"gm")}static noSplitter(e,r,a){return[e]}static lineSplitter(e,r,a){const s=e.value.split(/\r\n|\r|\n/gm);if(s.length==1)return[e];const i=[];return s.forEach((n,o)=>{if(o){const p=te.createToken("addNewLine","",e.pos,r,a);i.push(p)}const u=e.pos+0,d=te.createToken(e.key,n,u,r,a);i.push(d)}),i}getRxString(){return this.rxPattern.toString()}addToken(e,r,a){const s=te.createToken(e,r,a,this.settings,this.TokenClass);this.tokens.push(s)}static createToken(e,r,a,s,i){const n=s.mapper[e]||e,o=s.htmlClassPrefix+n,u=r,d=s.PrettifierClass.prettifyToken(e,n,u);return new i(e,r,a,u,d,n,o,s.tokenTypeMapper)}get currentPos(){const e=this.tokens[this.tokens.length-1].pos;return this.posToString(e)}tokenizeString(e){this.rawText=e,this.reset(),this.tokenizedRaw="",this.collectLineInfo();let r;this.rxPattern.lastIndex=0;let a=-1,s=1;for(;r=this.rxPattern.exec(this.rawText);){let i,n;if(!r.groups)throw Error("Use named capturing blocks!");const o=Object.entries(r.groups).filter(([u,d])=>d!=null);if(Object.values(o).reduce((u,d)=>u+d[1].length,0)!==r[0].length)throw Error(`Use named capturing blocks - not captured completely: ${r[0]}`);if(r.index==a)throw Error("Invalid regexp - do not use elements which can return empty values, e.g. (?<value>.*) !");if(r.index!=a+s){const u=e.slice(a+s,r.index);a==-1&&(a=0),this.addToken("_guard",u,a),this.tokenizedRaw+=u}o.forEach(u=>{[i,n]=u,i=i.replace(/__.*$/,""),(!this.settings.skipEmpty||n)&&(this.addToken(i,n,r.index),this.tokenizedRaw+=n)}),a=r.index||0,s=r[0].length||0}if(a+s<e.length){const i=e.slice(a+s);this.addToken("_guard",i,a),this.tokenizedRaw+=i}if(this.tokenizedRaw.length!=e.length)throw Error("Invalid regexp - characters are missing!")}collectLineInfo(){this.linePosTable=[];const e=this.rawText.split(`
`);let r=0,a=0;e.forEach(s=>{a=r+s.length;const i={start:r,end:a};this.linePosTable.push(i),r=a+1})}getLineInfo(e){let r=-1,a=-1;for(;e>r;)a++,r=this.linePosTable[a].end;return[a,this.linePosTable[a--].start]}posToString(e,r="ln %ln col %col",a=1){const[s,i]=this.getLineInfo(e),n=e-i;return r.replace("%ln",(s+a).toString()).replace("%pos",e.toString()).replace("%col",(n+a).toString())}static getNewLines(e){return e.key!=="whiteSpc"?0:e.value.match(/\r\n|\n|\r/g)?.length||0}getFormattedFromTokens(e="reprPretty"){const r=this.tokens,a=[""],s=[""],i=[""],n=[""],o=[""];return r.forEach((u,d,p)=>{const[g,h]=this.settings.PrettifierClass.getNewLineCountFunction(u,p,d);h?m(h):g&&this.settings.splitFunc(g,this.settings,this.TokenClass).forEach((S,P)=>{S.key=="addNewLine"?m(1):(S.value!=""||!this.settings.skipEmpty)&&W(S,this)});function m(S){for(let P=0;P<S;P++)a.push(""),s.push(""),i.push(""),n.push(""),o.push("")}function x(S,P,E,q,ge){if(P in q){let yt=function(nt,Be){const Dr=E.slice(nt,Be);it+=Dr.length,x(S,"error",Dr,q,ge)};const we=q[P];if(typeof we=="function"){const[nt,Be]=we(P,E);return x(S,nt,Be,q,ge),S}if(!(we instanceof RegExp))throw Error("Not a regexp value!");let K;we.lastIndex=0;let it=0,Oe=0;for(;K=we.exec(E);){if(!K||!K.groups||!K[0].length||K.index==null)throw Error("Update regexp - empty result!");Object.entries(K.groups).forEach(([nt,Be])=>{Be&&(it+=Be.length,x(S,nt,Be,q,ge))}),K.index!=Oe&&yt(Oe,K.index),Oe=K.index+K[0].length}if(Oe!=E.length&&yt(Oe,E.length),it!=E.length)throw Error("Update regexp - characters are missing!");return S}else{const yt=ge.mapper[P.replace(/__.*$/,"")]||P.replace(/__.*$/,""),we=ge.htmlClassPrefix+yt;return E.replace(/ /g," ").split(`
`).forEach((K,it)=>{if(it>0&&m(1),K.length>0){const Oe=`<span class='${we}'>${K}</span>`;a[a.length-1]+=Oe,s[s.length-1]+=K,i[i.length-1]+=K,n[n.length-1]+=K,o[o.length-1]+=K}}),S}}function W(S,P){g!=null&&x([[]],S.key,S.value,P.subFormatPatterns,P.settings)}}),{allFormattedHTML:a,allTexts:s,allRepr:n,allReprPretty:o,allValues:i}}}const bt={0:[],1:[U.TTC_COMMAND_TOKENS.BYTE],2:[U.TTC_COMMAND_TOKENS.WORD],3:[U.TTC_COMMAND_TOKENS.F08],4:[U.TTC_COMMAND_TOKENS.F88]};class ze{constructor(e,r){this.typeCodes=e,this.settings=r}digitToArray(e){const r=parseInt(e);if(r<0||r>9)throw TypeError(`Invalid digit for byte parsing: ${e}`);return[J.textToScreen(e)]}byteToArray(e){const r=parseInt(e);if(r<-128||r>255)throw TypeError(`Invalid value for byte parsing: ${e}`);return[...this.typeCodes[1],r+256&255]}wordToArray(e){const r=parseInt(e);if(r<-32768||r>65535)throw TypeError(`Invalid value for word parsing: ${e}`);const a=r+65536&65535;return[...this.typeCodes[2],a&255,a>>8]}integerToArray(e){return this.settings.integerEncoders.map(r=>{try{return r.bind(this)(e)}catch{return[]}}).filter(r=>r.length>0)[0]}}const dr={allowDigits:!0,allowTokens:!0,integerEncoders:[ze.prototype.digitToArray,ze.prototype.byteToArray,ze.prototype.wordToArray]},xi=254;class $e extends Error{constructor(e,r){const a=`Invalid variable name: ${e}. ${r}`;super(a),this.name="InvalidVariableNameError",Object.setPrototypeOf(this,new.target.prototype)}}function yi(t){return t.sort((e,r)=>je[e]-je[r]).reduce((e,r)=>{if(e.length===0)return[[r]];const a=e[e.length-1],s=a[a.length-1];return je[r]===je[s]+1?a.push(r):e.push([r]),e},[]).map(e=>e.length>2?`${e[0]}-${e[e.length-1]}`:e.join("")).join("")}class Ci{constructor(){this.rxTypesLong=Object.keys(zt).join("|"),this.rxTypesShort=Object.keys(Jt).join("").replace(/0/,""),this.defaultSizePostfix={128:"$",254:""},this.numberTokenizer=new ze(bt,dr),this.variableMapping={}}getDimText(e){let r="";return e.forEach(a=>{a.category==="dimDetailsLong"&&(r+=a.value+`
`)}),r}getType(e){const r={dataLength:1,memBytes:1},a=/^(?<baseType>\$|FIXSTR|.*)[.]?(?<dataLength>\d+)?$/,s=e.match(a);let i=1;if(!s?.groups)throw new Error(`Invalid type string format: ${e}`);(s.groups.baseType==="$"||s.groups.baseType==="FIXSTR")&&(s?.groups.dataLength?i=Number(s.groups.dataLength):i=xi,r.dataLength=i,r.memBytes=i+2);const n=s.groups.baseType;if(n in Jt)return{...Jt[n],...r};if(n.toUpperCase()in zt)return{...zt[n.toUpperCase()],...r};throw new Error(`Invalid type string format: ${e}`)}parseDimShort(e){throw Error("Not implemented dim short parse!")}parseDimLong(e,r){const a=te.verboseRegexp(String.raw`
            (?<wspc3>^\s*)(?<type>
                ${this.rxTypesLong} |
                ([$]\d+) |
                [${this.rxTypesShort}]
            )
            (?<arr_sign>(<[=-]{1,2}))?
            (?<arr_size>\d*)
            (?=$|\s+) |
            (
                (?<var_name>
                    [a-zA-Z][a-zA-Z_×]*
                )
                (?<wspc1>\s*[,;]?\s*)
                (
                    (?<comment>[-|\/]{2}.*?$) |
                    (?<break>,|$)
                )
            ) |
            (?<wspc2>[\t\x20]+\n?|\n) |

            (?<error_word>\w+) |
            (?<error>.)`,"gmi");a.lastIndex=0;let s,i=0,n=0;const o=[],u={};let d=null,p=0,g=null,h=0;for(;s=a.exec(e);){if(!s||!s.groups||!s[0].length||s.index==null)throw Error("Update regexp - empty result!");Object.entries(s.groups).forEach(([m,x])=>{if(x){if(i+=x.length,m==="type"&&(d=this.getType(x),p=0),m==="arr_size"&&(p=parseInt(x,10)),m==="var_name"){this.assertVarNameValid(x,r,!0),g=x;const W=g.replace(/×/g,"x"),S=je[W]||h+100;u[g]={type:d,arr_size:p,comment:"",idx:h,idxScore:S},h++}m==="comment"&&g&&(u[g].comment=x.replace(/^--\s*/g,"")||""),m==="error"&&o.push([n,s?.index,x]),m==="error_word"&&o.push([n,s?.index,`Invalid word: ${x}`])}}),s.index!=n&&o.push([n,s.index,s[0]]),n=s.index+s[0].length,i!=n&&o.push([n,s?.index,e.substring(n,s?.index)])}if(n!=e.length&&o.push([n,0]),i!=e.length)throw Error("Update regexp - characters are missing!");return this.variableMapping=u,{vars:u,errors:o}}getVariableMapping(){return this.variableMapping}assertVarNameValid(e,r,a){const s=/^[a-zA-Z]×?$/.test(e),i=/^[a-zA-Z][a-zA-Z_]{1,}$/.test(e);if(!a&&!s)throw new $e(e,"Only a single letter or a letter with × is allowed.");if(e in Rt)throw new $e(e,"Variable name cannot be a keyword.");if(a&&!r&&s)throw new $e(e,"No single letter variable names are allowed. Use #directshort directive to allow them.");if(!(a&&i||a&&r&&s||!a&&s))throw new $e(e,"Invalid variable name, ony a-z,A-Z, A×-Z×, _ are allowed.")}assignVariableNames(e){const r=Object.entries(e).sort((i,n)=>i[1].idxScore-n[1].idxScore),a=[...Object.keys(je)],s={};return r.forEach(([i,n])=>{const o=n.idxScore<100;let u=i;if(o){const d=a.indexOf(i);if(d!==-1)a.splice(d,1);else throw new $e(i,"Short variable name not found in possible variables.")}else if(u=a.shift()||"",!u)throw new $e(i,"No more short variable names available.");s[u]={...n,varName:i,transformedVarName:u,isShortVar:o}}),s}encodeDimLong(e){const r=[],a={};Object.values(e).forEach(n=>{const{type:o,arr_size:u}=n,{encodedType:d,encodedTypeBytes:p}=this.getTypeCode(o,u);n.typeCode=d,n.encodedTypeBytes=p;const g=d;a[g]=a[g]||[],a[g].push(n)});const s=Object.values(e).sort((n,o)=>n.idx-o.idx).map(n=>n.typeCode).filter((n,o,u)=>u.indexOf(n)===o),i={};return Object.entries(a).forEach(([n,o])=>{if(n===null)return;const u=[];if(o[0].type==null)return;u.push(...o[0].encodedTypeBytes),i[n]=u;const d=o.map(h=>h.transformedVarName),p=yi(d),g=ft.convertStringToBytes(p,nr).byteArray;u.push(...g)}),s.forEach(n=>{const o=i[n];r.push(...o,de[","])}),r.pop(),r}getTypeCode(e,r){let a="";const s=[];if(e.shortCode!="$")a+=e.shortCode,s.push(de[e.shortCode]);else if(Object.keys(this.defaultSizePostfix).includes(e.dataLength.toString(10))){const i=this.defaultSizePostfix[e.dataLength];a+=`$${i}`,s.push(de.$,...ft.convertStringToBytes(i,nr).byteArray)}else a+=`$${e.dataLength}`,s.push(de.$,...this.numberTokenizer.integerToArray(e.dataLength.toString(10)));return r>0&&(a+=`{'<=='}${r.toString()}}`,e.shortCode=="$"&&s.push(de["<=="]),s.push(...this.numberTokenizer.integerToArray(r.toString(10)))),{encodedType:a,encodedTypeBytes:s}}}var j=(t=>(t[t.unset=0]="unset",t[t.mutableTrue=1]="mutableTrue",t[t.mutableFalse=2]="mutableFalse",t[t.finalTrue=3]="finalTrue",t[t.finalFalse=4]="finalFalse",t))(j||{});class ve{constructor(e=0){this._value=0,this._value=e}isTrue(){return this._value===1||this._value===3}isFalse(){return this._value===2||this._value===4}isFinal(){return this._value===3||this._value===4}set value(e){this.isFinal()||(e===!0?this._value=1:e===!1?this._value=2:this._value=e)}}class ss{constructor(e){this.text=e,this.directives={},this.directiveValues=[],this.directiveFunctions={}}process(){this.readGlobalDirectiveValues()}readGlobalDirectiveValues(){const e=/(?:^[\n\s]*)((#\S*\s*)+)/m,r=this.text.match(e);if(!r)return{result:[],error:null};const a=r[1].split(/\s+/).map(i=>i.trim().replace(/#/g,"")).filter(i=>i.length>0),s=[];return a.forEach(i=>{Object.keys(this.directives).indexOf(i)===-1&&s.push(i)}),s.length>0?{result:[],error:`Invalid directive(s): ${s.join(", ")}`}:{result:a,error:null}}useGlobalDirectives(){const e=this.readGlobalDirectiveValues();if(e.error)throw new Error(e.error);this.directiveValues=e.result,this.directiveValues.forEach(r=>{this.directiveFunctions[r]()})}getFinalDirectives(){const e={};return Object.entries(this.directives).forEach(([r,a])=>{a instanceof ve&&(a=a.isTrue()),e[r]=a}),e}}class hr{static prettifyToken(e,r,a){return""}static getIndentOffset(e,r){return[0,0]}static getNewLineCountFunction(e,r,a){return[e,0]}}class Si extends hr{static prettifyToken(e,r,a){return a}static getIndentOffset(e,r){return[0,0]}static getNewLineCountFunction(e,r,a){return e.key!=="whiteSpc"?[e,0]:[null,e.value.match(/\r\n|\n|\r/g)?.length||0]}}const as=class is{constructor(e,r,a,s,i,n,o,u=null){this.key=e,this.value=r,this.pos=a,this.repr=s,this.reprPretty=i,this.category=n,this.spanClass=o,this.typeMapper=u||is.defaultMapper}isRemark(){return this.typeMapper.remark.indexOf(this.key)>=0}isNumber(){return this.typeMapper.number.indexOf(this.key)>=0}isString(){return this.typeMapper.string.indexOf(this.key)>=0}isUnaryOperation(){return this.typeMapper.unaryOp.indexOf(this.value)>=0}isBinaryOperation(){return this.typeMapper.binaryOp.indexOf(this.value)>=0}isAssignment(){return this.typeMapper.assignment.indexOf(this.value)>=0}isType(e){return this.typeMapper[e].indexOf(this.key)>=0||this.typeMapper[e].indexOf(this.value)>=0}};as.defaultMapper={remark:["remark","rem_multi","docstr"],number:["hexNum","floatNum","intNum"],string:["strDQuote","strSQuote","strBQuote"],binaryOp:["+","-","<","<=","==",">",">=","!=","!==","===","||","&&","*","/","%","|","&"],unaryOp:["(","-","~"],assignment:["=","|=","&=","+=","-=","*=","/=","^="]};let Qr=as;class ns{constructor(e){Object.keys(e).forEach(r=>{if(["rxPattern","subFormatPatterns","skipEmpty","mapper","PrettifierClass","TokenClass","splitFunc","getNewLineCountFunction","tokenTypeMapper","htmlClassPrefix"].indexOf(r)==-1)throw Error(`Invalid key ${r} for tokenizer settings!`)}),this.rxPattern=e.rxPattern||/(?<symbol>.)/g,this.subFormatPatterns=e.subFormatPatterns||{},this.skipEmpty=e.skipEmpty===void 0?!0:e.skipEmpty,this.mapper=e.mapper||{},this.htmlClassPrefix=e.htmlClassPrefix||"",this.splitFunc=e.splitFunc||te.noSplitter,this.tokenTypeMapper=e.tokenTypeMapper||Qr.defaultMapper,this.TokenClass=e.TokenClass||Qr,this.PrettifierClass=e.PrettifierClass||Si,this.getNewLineCountFunction=e.getNewLineCountFunction||null}}const os=class ls extends hr{static prettifyToken(e,r,a){return e!=="func"&&e!=="command"&&e!=="other"?a:e=="command"?a+" ":ls.PRETTIFY_REPL[a]||a}static getIndentOffset(e,r){return[0,0]}static getNewLineCountFunction(e,r,a){return e.key!=="newLines"?[e,0]:[null,e.value.match(/\r\n|\n|\r/g)?.length||0]}};os.PRETTIFY_REPL={"=":" = ","+":" + ","-":" - ","*":" * ","/":" / ",",":", ",to:" to ",step:" step ",and:" and ",or:" or ",fn:"fn ",then:" then "};let us=os;const cs=(t,e)=>e.length-t.length,Ti=Object.keys(di).sort(cs).join("|"),ki=Object.entries(bi).map(([t,e])=>{const[r,a]=e;return a&Qe.FN_WITH_BRACKET?String.raw`${t}\(`:t}).sort(cs).join("|");var Nt=(t=>(t[t.AUTO=0]="AUTO",t[t.VERBOSE=1]="VERBOSE",t[t.SHORT=2]="SHORT",t))(Nt||{});class Lt extends te{constructor(e={}){const r={1:{gbIdentifier:"gbIdentifierLong",gbDim:"gbDimLong"},2:{gbIdentifier:"gbIdentifierShort",gbDim:"gbDimShort"},0:{}};let a=e.verboseMode||0;a===0&&(a=1);const s={gbIdentifierLong:[8e3,String.raw`(?<identifier>[\w×]+)`],gbIdentifierShort:[8e3,String.raw`(?<identifier>[\w][×]?)`],gbSysVar:[8100,String.raw`(?<sysId>[@][\w×]+)`],gbPostfix:[8200,String.raw`(?<postfix>\.[\w×]+)`],gbLabel:[4e3,String.raw`(?<label>^[\w]+\s*[:]$)`],gbDimLong:[6e3,String.raw`(?<command__dim>dim)(?<dimDetailsLong>[^;]*)(?<whiteSpc__dim>;)`],gbDimShort:[6e3,String.raw`(?<command__dim>dim)(?<dimDetailsShort>[^;]*)(?<whiteSpc__dim>;)`],gbCommand:[6050,String.raw`(?<command>\?|${Ti})(?![a-zA-Z_])`],gbFunction:[6100,String.raw`(?<func>${ki})(?![a-zA-Z_])`],gbOperator:[6200,String.raw`(?<operator>(AND|OR|div|mod|xor|and|or)(?![a-zA-Z_])|[+\-*\/^>=<&])`],v2Sep:[7e3,String.raw`(?<commandSep>[:])`],newLines:[3050,String.raw`(?<newLines>(\r\n|\n|\r)+)`],whiteSpace:[3100,String.raw`(?<whiteSpc>[\t\ \xA0]+)`],gbTypes:[6300,String.raw`(?<idType>([us]?(byte|word|f08|f88|f2416|float))|char|dchar|varstr|fixstr|[$])`],gbRemDash:[1150,String.raw`(?<remarkDash>[\-]{2}.*$)`],gbSysBlock:[1e3,String.raw`(?<sysBlock>[#]start.*?[#]end\s*)`],gbSysCmd:[1200,String.raw`(?<sysCmd__const>[#]const[^;]+?[;])`],gbSysUse:[1200,String.raw`(?<use>^\s*[#]use\s+[\w=,]+)`],gbSysCmdOther:[1250,String.raw`(?<sysCmd__other>[#].*$)`],gbExpr:[6300,String.raw`(?<expr>[{][^}]*?[}])`],gbOther:[8500,String.raw`(?<other__8500>[@,;\(\)\[\]])`],gbStrQQuote:[2050,String.raw`(?<other_quote__strQO>\"\")(?<strQQuote>(?:[{][^}]*?[}]|.)*?)(?<other_quote__strQC>\"\")`],gbStrDQuote:[2100,String.raw`(?<other_quote__strDO>\")(?<strDQuote>(?:[{][^}]*?[}]|[^\"])*?)(?<other_quote__strDC>\")`],gbStrSQuote:[2200,String.raw`(?<other_quote__strSO>\')(?<strSQuote>(?:[{][^}]*?[}]|[^\'])*?)(?<other_quote__strSC>\')`],gbStrBQuote:[2300,String.raw`(?<other_quote__strBO>\`)(?<strBQuote>(?:[{][^}]*?[}]|[^\`])*?)(?<other_quote__strBC>\`)`]},i=te.buildRxString([xe.remark,xe.docstr,xe.remMulti,xe.numInt,xe.numFloat,"gbSysCmdOther","gbSysCmd","gbSysBlock","gbSysUse","gbStrQQuote","gbStrDQuote","gbStrSQuote","gbStrBQuote","gbExpr","gbOther","gbRemDash","gbSysVar",r[a].gbIdentifier,"gbPostfix","gbLabel","gbOperator","gbTypes",r[a].gbDim,"gbCommand","gbFunction","newLines","v2Sep","whiteSpace"],s,""),n={strDQuote:String.raw`  (
                                      (?<other__sp_open>[{])
                                      (?<strSpecial>[^}]*?)
                                      (?<other__sp_close>[}])
                                    ) |
                                    (?<strNormal>[^{]+)`,strSpecial:String.raw`
            (?<whiteSpc__100>\s*?)(
             (?<remark__str>(([-]{2}|[/]{2}).*$)|[/][*][\s\S]*?[*][/]) |

             ( (?<func__str>\w+\s*)
                (?<other__bropen>[(])
                (?<strfunc_params>[^)]*?)
               (?<other__brclose>[)])
             ) |

             (
               (?<strSpecCheck>\w+) |
               (?<intNum__1>[a-zA-Z_][a-zA-Z_0-9]*) |
               (?<intNum__2>(?:[$]|0x)[0-9a-fA-F]+[w]{0,1}) |
               (?<intNum__3>[0-9]+[w]{0,1})
             )
             ((?<other__multi>\s*[*]\s*)(?<intNum__str>[0-9]+))?
             (?<other__100>[,;]\s*|\s+|\s*$)
           ) |
           (?<other__101>\s+) |
           (?<error>.+?)
           `,strSpecCheck:Lt.validateCode,strfunc_params:String.raw`
                            (?<other__spec100>\")(?<strNormal__strspec>[^\"]*?)(?<other__spec150>\") |
                            (?<intNum__spec100>\d+) |
                            (?<other__spec200>[,]) |
                            (?<other__spec300>.)
                            `,dimDetailsShort:"__main"},o={command:"CMD",commandRem:"CMD",func:"FUNC",error:"ERR",strDQuote:"STR",strQQuote:"STR",strSQuote:"STR",strBQuote:"STR",strNormal:"STR",strSpec:"SPEC",label:"LABEL",floatNum:"NUM",intNum:"NUM",identifier:"VAR",identifier2:"VAR",idExtra:"EXTRA",idType:"FUNC",sysId:"FUNC",commandSep:"SEP",whiteSpc:"SPC",remark:"REM",remarkDash:"REM",rem_multi:"REM",docstr:"DOCSTR",other:"OTHER",other_quote:"SKIP",sysCmd:"SYS",sysCmd2:"SYS",postfix:"FUNC"},u=new ns({rxPattern:i,subFormatPatterns:n,mapper:o,htmlClassPrefix:"editor-style-",PrettifierClass:us});super(u)}static validateCode(e,r){return r.toUpperCase()in U.TTC_STRING_TOKENS_UPPER?["strSpec",r]:["error",r]}getTokensFromMemory(e){const r=rs.getTokensFromMemory(e);this.reset(),r.forEach(a=>{this.addToken(a.key,String(a.value),a.pos)})}tokenizeStr(e){this.tokenizeString(e)}}class gs extends ss{constructor(){super(...arguments),this.directives={verbose:new ve(j.mutableTrue),compact:new ve(j.mutableFalse),strict:new ve(j.mutableTrue),loose:new ve(j.mutableFalse),inline:new ve(j.mutableFalse),safe:new ve(j.mutableTrue),trusted:new ve(j.mutableFalse),directshort:new ve(j.mutableFalse)},this.directiveFunctions={verbose:()=>{this.directives.verbose.value=!0,this.directives.compact.value=!1},compact:()=>{this.directives.verbose.value=!1,this.directives.compact.value=!0},strict:()=>{this.directives.strict.value=!0,this.directives.loose.value=!1},loose:()=>{this.directives.strict.value=!1,this.directives.loose.value=!0},inline:()=>{this.directives.inline.value=!0},safe:()=>{this.directives.safe.value=!0,this.directives.trusted.value=!1},trusted:()=>{this.directives.safe.value=!1,this.directives.trusted.value=!0},directshort:()=>{this.directives.directshort.value=!0}}}setSettings(e){e.verboseMode===Nt.VERBOSE?(this.directives.verbose.value=j.finalTrue,this.directives.compact.value=j.finalFalse):e.verboseMode===Nt.SHORT?(this.directives.verbose.value=j.finalFalse,this.directives.compact.value=j.finalTrue):e.verboseMode===Nt.AUTO&&(this.directives.verbose.value=!0,this.directives.compact.value=!1)}analyzeVarsFromTokenized(e){const r={};return e.forEach(a=>{a.category==="VAR"&&(r[a.value]=(r[a.value]||0)+1)}),r}getDimDetails(e){let r=0,a=e.findIndex(s=>s.category==="DIM");if(a===-1)return{memSettings:r};for(e[a+1]?.category=="intNum"&&(r=e[a+1].value,a+=2);a<e.length&&!(e[a].category==="commandSep"&&e[a].value===";");){if(e[a].category==="idType"){for(e[a].value,e[a+1]?.category==="intNum"&&(e[a+1].value,a++),a++;e[a]?.category==="VAR";)e[a].value,e[a].value;a++}a++}}}class Yr{constructor(e,r){this.typeCodes=e,this.settings=r,this.subTokenized=[],this.varMappings={},this.validChars=[],this.reset()}reset(){this.subTokenized=[],this.varMappings={};const e=[],r=[],a=[];for(let s=0;s<26;s++)e.push(er[s+1]),r.push(er[s+65]),a.push(er[s+65]+"×");this.validChars.push(...e,...r,...a)}subTokenize(e,r=!1){let a=/(?<postindex>\.\d+|<-\d+)|(?<quickindex><-\w+)|(?<postfix>\.\w+)|(?<base>[a-z_A-Z×]+)/gm;r||(a=/(?<postindex>\.\d+|<-\d+)|(?<quickindex><-\w+)|(?<postfix>\.\w+)|(?<base>[a-zA-Z][×]?)(?<postfix2>[\w×]*)/gm),a.lastIndex=0;let s=null;const i=[];for(;(s=a.exec(e))!==null;){s.index===a.lastIndex&&a.lastIndex++;const n=s.groups?.base||"",o=s.groups?.postfix||"",u=s.groups?.postindex||"",d=s.groups?.quickindex||"",p=!r||n.length==1||n.length==2&&n[1]=="×";if(n){const g=p?n:this.longvarToShortvar(n);if(i.push(de[g]),s.groups?.postfix2){let h=0;for(;h<s.groups?.postfix2.length;){let m=s.groups?.postfix2[h];s.groups?.postfix2[h+1]=="×"&&(m+="×",h++),m&&i.push(de[m]),h++}}}if(o){const g=fi[o.replace(/\./g,"")][0];i.push(de[g])}else if(u){const g=u.replace(/<-|\./g,""),h=new ze(bt,dr).integerToArray(g);i.push(...h)}else if(d){const g=d.replace(/<-|\./g,""),h=p?g:this.longvarToShortvar(g);i.push(de["<--"]),i.push(de[h])}}return i}longvarToShortvar(e){if(this.settings.isStrict&&e.length>0&&this.settings.dimObject[e]===void 0)throw new Error(`Variable ${e} not found in DIM declaration`);const r=this.getNextShortVar();if(!r)throw new Error("No more short variable names available");const a=this.varMappings[r];if(a){if(a.longvar!==e)throw new Error(`Short variable ${r} already defined as ${a.longvar}`);return r}return this.varMappings[r]={shortvar:r,longvar:e,isArray:!1,length:0},r}getNextShortVar(){return this.validChars.shift()||""}}const Gr={isStrict:!1,dimObject:{}},nr={tokens:U.TTC_STRING_TOKENS,normalConverter:J.textToScreen,funcs:U.gbFuncs},z=class pt extends Ye{constructor(e={}){super(),this.varTokenizer=new Yr(bt,Gr)}static numEncoder(e,r){if(e.key=="intNum")return new ze(bt,dr).integerToArray(e.value);throw TypeError(`Invalid type for ${e.key}: ${e.value}`)}static dimEncoder(e,r){const a=new Ci,s=e.value,{vars:i,errors:n}=a.parseDimLong(s,!0),o=a.assignVariableNames(i);return a.encodeDimLong(o)}static stringEncoder(e,r){if(e.key=="other"&&e.value=="?")return[U.TTC_COMMAND_TOKENS.print];const a=[],{byteArray:s,status:i}=ft.convertStringToBytes(e.repr,nr);if(i!=="OK"&&console.log(i),["strDQuote","strSQuote","strBQuote","strQQuote"].includes(e.key)){const n=U[e.key];a.push(n),a.push(s.length)}return a.concat(s)}static otherEncoder(e,r){return r.lastCommand=="clr"&&e.repr==","?[]:pt.stringEncoder(e,r)}static varEncoder(e,r){return r.varTokenizer.subTokenize(e.repr,r.isVerbose)}static cmdEncoder(e,r){const a=e.repr.replace("(",""),s=U.TTC_COMMAND_TOKENS[a],i=U.EXTRA_ZEROS[a];return i>0?[s,...Array(i).fill(0)]:(U.IS_COMMAND[a]&&(r.lastCommand=a),[s])}static encodeTextAsBytes(e,r={}){const a=new gs(e);a.setSettings(r),a.useGlobalDirectives();const s=new Lt(r);s.tokenizeString(e),a.analyzeVarsFromTokenized(s.tokens);const i=a.getFinalDirectives();return pt.encodeTokens(s.tokens,i)}static encodeTokens(e,r){const a=[],s={nextAddr:0,line:null,data:[]};function i(){if(s.data.length>0){const u=Object.assign({},s);a.push(u),s.data=[]}}const n={isVerbose:r.verbose,varTokenizer:new Yr(bt,Gr),lastCommand:""};e.forEach(u=>{if(u.category=="LABEL"){i(),parseInt(u.value,10);return}const d=pt.encoders[u.key]||pt.encoders[u.category];if(d){const p=d(u,n);s.data.push(...p)}else throw Error(`Encoder needed for ${u.key}, ${u.category} for value ${u.value}!`)}),i();const o=[];return a.forEach(u=>{o.push(...u.data,U.blockEndToken)}),o.push(U.finalToken),o}};z.encoders={idType:z.stringEncoder,postfix:z.varEncoder,STR:z.stringEncoder,NUM:z.numEncoder,VAR:z.varEncoder,SEP:z.stringEncoder,CMD:z.cmdEncoder,FUNC:z.cmdEncoder,operator:z.cmdEncoder,OTHER:z.otherEncoder,commandSep:Ye.voidEncoder,SKIP:Ye.voidEncoder,whiteSpc:Ye.voidEncoder,sysCmd:Ye.voidEncoder,newLines:Ye.voidEncoder,dimDetailsLong:z.dimEncoder};let Ii=z;class ps{constructor(e){this.settings=e,this.tokens=[],this.activeTokenId=0,this.token={},this.nextToken={},this.scope="",this.docStr={},this.params={},this.tags=[],this.labels={},this.functions={}}parseTokens(e){this.tokens=e,this.activeTokenId=0,this.token={key:"_whsp"},this.params={vars:{}},this.docStr={},this.scope="__global",this.tags=[],this.labels={},this.functions={}}isFinished(){return this.activeTokenId>=this.tokens.length}posToString(){return this.settings.posToStringFn(this.token.pos)}startTag(e,r){const a="   ".repeat(this.tags.length);this.tags.push(e),console.log(`${a}<${e}> ${r}`)}endTag(){const e=this.tags.pop(),r="   ".repeat(this.tags.length);console.log(`${r}</${e}>`)}advance(){if(this.isFinished())throw Error("Document finished unexpectedly!");do{this.token=this.tokens[this.activeTokenId],this.activeTokenId++,this.token.key==this.settings.keys._docstr&&(this.docStr[this.scope]=(this.docStr[this.scope]||"")+this.token.value);const e=this.activeTokenId;do this.nextToken=this.tokens[this.activeTokenId],this.activeTokenId++;while((this.nextToken.key==this.settings.keys._whsp||this.nextToken.isRemark())&&!this.isFinished());if(this.activeTokenId=e,this.nextToken==null)break}while((this.token.key==this.settings.keys._whsp||this.token.isRemark())&&!this.isFinished())}unexpectedToken(e){throw Error(`Unexpected token '${this.token.value}' at ${this.posToString()}. 
Expected: ${e}.`)}eatGivenType(e){this.advance(),this.token.key!==e&&this.unexpectedToken(e)}eatIdentifier(){return this.eatGivenType("identifier"),this.token}eatValue(e){this.advance(),this.token.value!==e&&this.unexpectedToken(e)}eatAnyOfList(e){this.advance(),e.indexOf(this.token.value)==-1&&e.indexOf(this.token.key)==-1&&this.unexpectedToken(e.toString())}eatMany(e){const r={},a=/([{]{2}(?<inputType>\w+)\s+(?<inputName>\w+)[}]{2})|(?<const>\S+)|(?<whitespace>\s+)/gm;let s=null;for(;(s=a.exec(e))!==null;)if(s.groups!==void 0&&(s.groups.const!==void 0?this.eatValue(s.groups.const):s.groups.inputType!==void 0&&(this.eatGivenType(s.groups.inputType),r[s.groups.inputName]=this.token),this.isFinished()))throw Error(`Unfinished expression, expected ${e}`);return r}parseVarDeclaration(){const e=this.eatIdentifier().value;this.eatValue(":");const r=this.eatIdentifier().value;this.params.vars[e]=r}parseClassConst(){this.parseConst()}parseParams(){let e="",r="";const a={};for(;this.eatAnyOfList(["identifier",")"]),!(this.token.value==")"||(e=this.token.value,r="any",this.eatAnyOfList([":",",",")"]),this.token.value==":"&&(r=this.eatIdentifier().value,this.eatAnyOfList([",",")"])),a[e]=r,this.token.value==")")););return a}parseExpression(){for(this.startTag("expression","");this.advance(),this.token.isUnaryOperation()&&this.advance(),!(!this.token.isNumber()&&!this.token.isString());)this.nextToken.isBinaryOperation()&&this.advance();this.endTag()}parseDict(){for(this.eatValue("{");this.token.value!="}";)this.advance()}parseList(){this.eatValue("[");let e=1;for(;e!=0;)this.advance(),this.token.value=="["&&e++,this.token.value=="]"&&e--}parseConst(){const e=this.eatIdentifier().value;this.eatValue("="),this.startTag("const",e),this.nextToken.value=="{"?this.parseDict():this.nextToken.value=="["?this.parseList():this.parseExpression(),this.endTag()}parseBlock(){for(this.startTag("block","");;){const e=this.activeTokenId;if(this.advance(),this.token.value=="}"){this.activeTokenId=e;break}if(this.token.key=="keyword")switch(this.token.value){case"const":this.parseConst()}}this.endTag()}parseMethod(){const e=this.eatIdentifier().value;this.startTag("method",e),this.params.method=e,this.eatValue("("),this.parseParams(),this.eatValue("{"),this.parseBlock(),this.eatValue("}"),this.endTag()}parseMethods(){for(;this.parseMethod(),this.nextToken.value!="}";);}parseClass(){const e=this.eatMany("class {{identifier classname}} extends GolfClass {").classname.value;for(this.params.class=e,this.startTag("class",e);;){const r=this.activeTokenId;if(this.advance(),this.activeTokenId=r,this.token.value=="}")break;switch(this.nextToken.value){case":":this.parseVarDeclaration();break;case"=":this.parseClassConst();break;case"(":this.parseMethod();break}}this.eatValue("}"),this.endTag()}}const ds=class hs{constructor(e){this.posToStringFn=e.posToStringFn||String,this.keys=e.keys||hs.defaultKeys}};ds.defaultKeys={_whsp:"whiteSpc",_docstr:"docstr"};let bs=ds;class wi extends ps{constructor(){const e=new bs({});super(e)}}const qr={Tokenizer:Lt,Prettifier:us,Parser:wi,Encoder:Ii,Decoder:rs,Preprocessor:gs},ne=class{};ne.BASIC_TOKENS={128:"end",129:"for",130:"next",131:"data",132:"input#",133:"input",134:"dim",135:"read",136:"let",137:"goto",138:"run",139:"if",140:"restore",141:"gosub",142:"return",143:"rem",144:"stop",145:"on",146:"wait",147:"load",148:"save",149:"verify",150:"def",151:"poke",152:"print#",153:"print",154:"cont",155:"list",156:"clr",157:"cmd",158:"sys",159:"open",160:"close",161:"get",162:"new",163:"tab(",164:"to",165:"fn",166:"spc(",167:"then",168:"not",169:"step",170:"+",171:"-",172:"*",173:"/",174:"^",175:"and",176:"or",177:">",178:"=",179:"<",180:"sgn",181:"int",182:"abs",183:"usr",184:"fre",185:"pos",186:"sqr",187:"rnd",188:"log",189:"exp",190:"cos",191:"sin",192:"tan",193:"atn",194:"peek",195:"len",196:"str$",197:"val",198:"asc",199:"chr$",200:"left$",201:"right$",202:"mid$",203:"go",255:"pi"},ne.SCREEN_COMMANDS={0:"null",1:"ct_a",2:"ct_b",3:"ct_c",4:"ct_d",5:"white",6:"ct_f",7:"ct_g",8:"ct_h",9:"ct_i",10:"ct_j",11:"ct_k",12:"ct_l",13:"return",14:"ct_n",15:"ct_o",16:"ct_p",17:"down",18:"reverse_on",19:"home",20:"delete",21:"ct_u",22:"ct_v",23:"ct_w",24:"ct_x",25:"ct_y",26:"ct_z",28:"red",29:"right",30:"green",31:"blue",32:"space",92:"pound",95:"arrow_left",129:"orange",133:"f1",134:"f3",135:"f5",136:"f7",137:"f2",138:"f4",139:"f6",140:"f8",144:"black",145:"up",146:"reverse_off",147:"clear",149:"brown",150:"pink",151:"dark_gray",152:"gray",153:"light_green",154:"light_blue",155:"light_gray",156:"purple",157:"left",158:"yellow",159:"cyan",160:"sh_space",161:"cm_k",162:"cm_i",163:"cm_t",164:"cm_@",165:"cm_g",166:"cm_+",167:"cm_m",168:"cm_pound",169:"sh_pound",170:"cm_n",171:"cm_q",172:"cm_d",173:"cm_z",174:"cm_s",175:"cm_p",176:"cm_a",177:"cm_e",178:"cm_r",179:"cm_w",180:"cm_h",181:"cm_j",182:"cm_l",183:"cm_y",184:"cm_u",185:"cm_o",186:"sh_@",187:"cm_f",188:"cm_c",189:"cm_x",190:"cm_v",191:"cm_b",192:"sh_asterisk",219:"sh_+",220:"cm_-",221:"sh_-",223:"cm_asterisk",255:"pi"},ne.CTT_COMMAND_TOKENS=ne.BASIC_TOKENS,ne.TTC_COMMAND_TOKENS={end:128,for:129,next:130,data:131,"input#":132,input:133,dim:134,read:135,let:136,goto:137,run:138,if:139,restore:140,gosub:141,return:142,rem:143,stop:144,on:145,wait:146,load:147,save:148,verify:149,def:150,poke:151,"print#":152,print:153,cont:154,list:155,clr:156,cmd:157,sys:158,open:159,close:160,get:161,new:162,"tab(":163,to:164,fn:165,"spc(":166,then:167,not:168,step:169,"+":170,"-":171,"*":172,"/":173,"^":174,and:175,or:176,">":177,"=":178,"<":179,sgn:180,int:181,abs:182,usr:183,fre:184,pos:185,sqr:186,rnd:187,log:188,exp:189,cos:190,sin:191,tan:192,atn:193,peek:194,len:195,str$:196,val:197,asc:198,chr$:199,left$:200,right$:201,mid$:202,go:203,pi:255},ne.CTT_SCREEN_TOKENS=ne.SCREEN_COMMANDS,ne.TTC_SCREEN_TOKENS={null:0,ct_a:1,ct_b:2,ct_c:3,ct_d:4,white:5,ct_f:6,ct_g:7,ct_h:8,ct_i:9,ct_j:10,ct_k:11,ct_l:12,return:13,ct_n:14,ct_o:15,ct_p:16,down:17,reverse_on:18,home:19,delete:20,ct_u:21,ct_v:22,ct_w:23,ct_x:24,ct_y:25,ct_z:26,red:28,right:29,green:30,blue:31,space:32,pound:92,arrow_left:95,orange:129,f1:133,f3:134,f5:135,f7:136,f2:137,f4:138,f6:139,f8:140,black:144,up:145,reverse_off:146,clear:147,brown:149,pink:150,dark_gray:151,gray:152,light_green:153,light_blue:154,light_gray:155,purple:156,left:157,yellow:158,cyan:159,sh_space:160,cm_k:161,cm_i:162,cm_t:163,"cm_@":164,cm_g:165,"cm_+":166,cm_m:167,cm_pound:168,sh_pound:169,cm_n:170,cm_q:171,cm_d:172,cm_z:173,cm_s:174,cm_p:175,cm_a:176,cm_e:177,cm_r:178,cm_w:179,cm_h:180,cm_j:181,cm_l:182,cm_y:183,cm_u:184,cm_o:185,"sh_@":186,cm_f:187,cm_c:188,cm_x:189,cm_v:190,cm_b:191,sh_asterisk:192,"sh_+":219,"cm_-":220,"sh_-":221,cm_asterisk:223,pi:255},ne.TTC_STRING_TOKENS=ne.TTC_SCREEN_TOKENS;let Je=ne;class fs{static getTokensFromMemory(e,r=2049){const a=function(o,u){return o+u*256},s=[];let i=0,n=r;for(;i<e.length;){let o=function(h){if(g>=128){const m=Je.CTT_COMMAND_TOKENS[g];if(!m)return;h.key=g>162?"func":"command",h.value=m}g>=65&&g<=90&&(h.key="identifier",h.value=h.escapedValue),g==32&&(h.key="whiteSpc",h.value=h.escapedValue)};if(n<i+r||n<r||n>r+e.length){console.log(`Invalid address ${n}`);break}if(i=n-r,n=a(e[i],e[i+1]),n==0)break;const u=a(e[i+2],e[i+3]);s.push({key:"label",value:u.toString(10),pos:i+r}),i+=4;let d;d=Y.scopeCommand;const p={key:"error",value:"error",escapedMode:"",escapedValue:""};let g=0;for(;i+r<n&&(g=e[i],g!=0);){switch(p.value="error",p.key="error",[p.escapedMode,p.escapedValue]=J.petsciiCodeToEscaped(g),d){case Y.scopeCommand:o(p),d=Y.scopeArgs,p.value=="rem"&&(d=Y.scopeRem);break;case Y.scopeRem:p.key="rem",p.value=p.escapedValue;break;case Y.scopeString:p.escapedValue=='"'?(d=Y.scopeArgs,p.key="other"):p.key="strDQuote",p.escapedMode=="code"?p.value=Je.CTT_SCREEN_TOKENS[g]?`{${Je.CTT_SCREEN_TOKENS[g]}}`:`{${p.escapedValue}}`:p.value=p.escapedValue;break;case Y.scopeArgs:p.value=p.escapedValue,p.key="other",o(p),p.value=='"'?d=Y.scopeString:p.value==":"?d=Y.scopeCommand:(p.value>="0"&&p.value<="9"||p.value==".")&&(p.key="floatNum");break}s.push({key:p.key,value:p.value,pos:i+r}),i++}s.push({key:"newLines",value:`
`,pos:i+r})}return s}static tokenArrayToRepr(e){let r="";return e.forEach(a=>{r+=a.value}),r}}const As=class ms extends hr{static prettifyToken(e,r,a){return e!=="func"&&e!=="command"&&e!=="other"?a:e=="command"?a+" ":ms.PRETTIFY_REPL[a]||a}static getIndentOffset(e,r){return[0,0]}static getNewLineCountFunction(e,r,a){return e.key!=="newLines"?[e,0]:[null,e.value.match(/\r\n|\n|\r/g)?.length||0]}};As.PRETTIFY_REPL={"=":" = ","+":" + ","-":" - ","*":" * ","/":" / ",",":", ",to:" to ",step:" step ",and:" and ",or:" or ",fn:"fn ",then:" then "};let _s=As;class vs extends te{constructor(e={}){const r={v2Identifier:[8e3,String.raw`  (?<identifier>[\w]{1,2})      // First max 2 chars
                                            (?<idExtra>[\w]*)             // Remaining are not used
                                            (?<idType>[$%]?)              // Type declaration: $ or %
                                            `],v2Label:[2e3,String.raw`^(?<whiteSpc3>\s*)(?<label>[\d]+)`],v2Command:[6e3,String.raw`(?<command>end|for|next|data|input#|input|dim|read|let|goto|run|if|restore|gosub|return|rem|stop|on|wait|load|save|verify|def|poke|print#|print|cont|list|clr|cmd|sys|open|close|get|new)`],v2Function:[6100,String.raw`(?<identifier2>[\w]{0,2})?(?<func>tab\(|to|fn|spc\(|then|not|step|and|or|sgn|int|abs|usr|fre|pos|sqr|rnd|log|exp|cos|sin|tan|atn|peek|len|str\$|val|asc|chr\$|left\$|right\$|mid\$)`],V2Operator:[6200,String.raw`(?<operator>[+\-*/^>=<])`],v2Sep:[7e3,String.raw`(?<commandSep>[:])`],v2Rem:[1e3,String.raw`(?<commandRem>rem)(?<rem>.*$)`],newLines:[3050,String.raw`(?<newLines>(\r\n|\n|\r)+)`],whiteSpace:[3100,String.raw`(?<whiteSpc>[\t \u00a0]+)`]},a=te.buildRxString([xe.numInt,xe.numFloat,xe.strDQuote,"v2Identifier","v2Label","V2Operator","v2Command","v2Function","newLines","v2Sep","v2Rem","whiteSpace"],r),s={command:"CMD",commandRem:"CMD",func:"FUNC",strDQuote:"STR",label:"LABEL",floatNum:"NUM",intNum:"NUM",identifier:"VAR",identifier2:"VAR",idExtra:"EXTRA",idType:"FUNC",commandSep:"SEP",whiteSpc:"SPC",rem:"REM",other:"OTHER"},i=new ns({rxPattern:a,mapper:s,htmlClassPrefix:"editor-style-",PrettifierClass:_s});super(i)}getTokensFromMemory(e){const r=fs.getTokensFromMemory(e);this.reset(),r.forEach(a=>{this.addToken(a.key,String(a.value),a.pos)})}tokenizeStr(e){this.tokenizeString(e)}}const oe=class Vt extends Ye{static stringEncoder(e){if(e.key=="other"&&e.value=="?")return[Je.TTC_COMMAND_TOKENS.print];const r={tokens:Je.TTC_STRING_TOKENS,normalConverter:J.textToPetscii},{byteArray:a,status:s}=ft.convertStringToBytes(e.repr,r);return s!=="OK"&&console.log(s),a}static cmdEncoder(e){return[Je.TTC_COMMAND_TOKENS[e.repr]]}static encodeTextAsBytes(e){const r=new vs;return r.tokenizeString(e),Vt.encodeTokens(r.tokens)}static encodeTokens(e){let r=2049;const a=[],s={nextAddr:0,line:null,data:[]};function i(){if(s.data.length>0){r+=s.data.length+5,s.nextAddr=r;const o=Object.assign({},s);a.push(o),s.data=[],s.nextAddr=0}}e.forEach(o=>{if(o.category=="LABEL"){i();const d=parseInt(o.value,10);s.line=d;return}const u=Vt.encoders[o.key]||Vt.encoders[o.category];if(u){const d=u(o);s.data.push(...d)}}),i();const n=[];return a.forEach(o=>{n.push(o.nextAddr&255,o.nextAddr>>8),n.push(o.line&255,o.line>>8),n.push(...o.data,0)}),n.push(0,0),n}};oe.encoders={idType:oe.stringEncoder,STR:oe.stringEncoder,NUM:oe.stringEncoder,VAR:oe.stringEncoder,SEP:oe.stringEncoder,CMD:oe.cmdEncoder,FUNC:oe.cmdEncoder,operator:oe.cmdEncoder,OTHER:oe.stringEncoder};let Oi=oe;class Bi extends ps{constructor(){const e=new bs({});super(e)}}const Di={Tokenizer:vs,Prettifier:_s,Parser:Bi,Encoder:Oi,Decoder:fs,Preprocessor:ss};var xs=(t=>(t.BASIC_V2="BasicV2",t.BASIC_V2_verbose="BasicV2-verbose",t.GOLFBAS_short="GolfBasic",t.GOLFBAS_verbose="GolfBasic-verbose",t))(xs||{});const Ei={BasicV2:Di,GolfBasic:qr,"GolfBasic-verbose":qr};class Ri{constructor(){return this.language="undefined",this.model={},this}usePredefinedLanguage(e){return this.language=e,this.model=Ei[e],this}defineLanguage(e){return this.language=e,this}}function Ni(){const t=new Ri().usePredefinedLanguage(xs.GOLFBAS_verbose).model.Encoder,e=`        fast a
        print i
        fend

        fast b
        inc ,49152
        fend

        poke49157,3
        sprite E 255
        sprite "{spr_def_raw_T $14 $00, $00, $00, $00, $00, $30, $01, $FC, $70, $03, $38, $E0, $1E, $BC, $E0, $1F, $F8, $70, $0A, $FC, $70, $1F, $F8, $60, $0F, $3C, $C0, $00, $38, $80, $00, $3D, $00, $07, $FF, $80, $0F, $FF, $C0, $07, $3F, $E0, $03, $01, $E0, $01, $80, $C0, $0F, $C0, $C0, $00, $01, $E0, $00, $00, $00, $00, $00, $00, $00, $00, $00}"
        sprite "{spr_def_raw 3 $ff 192 3 $ff $00}"
        for i to 8
            sprite m i, 50+i*10, 90+i*10
            sprite S× 20+i
            sprite C× 2+i
            sprite M× 100, 100, i * 20 + 50
        next
        print"0"

        timer i 1, 1, a
        timer i 2, 1, b

        for i to 30000 step 2
            for j to 8
                sprite m j, i&511, i&255, j * 20 + 50
            next
        next
        print"done"`.replace(/\n/g,":");return t.encodeTextAsBytes(e)}const Vi={locate:[128,130],read:[129,128],break:[130,192],call:[131,128],def:[132,160],endif:[133,192],for:[134,160],goto:[135,129],local:[136,128],if:[137,176],fend:[138,192],clr:[139,128],let:[140,128],memset:[141,130],next:[142,192],on:[143,128],poke:[144,129],continue:[145,192],repeat:[146,160],set:[147,128],then:[148,192],until:[149,129],voice:[150,136],while:[151,129],exec:[152,129],input:[153,129],sys:[154,128],CHAR:[160,0],F08:[161,24],DQUOTE:[162,2],WORD:[163,21],UWORD:[164,17],F2416:[165,30],BYTE:[166,16],SQUOTE:[167,2],F88:[168,29],FLOAT:[169,31],DCHAR:[170,1],inc:[171,128],QQUOTE:[172,2],dec:[173,128],_label:[174,128],rem:[175,128],"+":[176,34],"-":[177,34],"*":[178,35],AND:[179,32],"&&":[179,32],div:[180,35],"/":[180,35],OR:[181,32],"||":[181,32],mod:[182,35],"%":[182,35],xor:[183,36],"^":[183,36],and:[184,36],"&":[184,36],or:[185,36],"|":[185,36],"<":[186,33],"==":[187,33],"=":[187,33],">=":[188,33],"!=":[189,33],"<>":[189,33],"<=":[190,33],">":[191,33],print:[192,128],data:[193,128],bitmap:[194,136],fcall:[195,128],dend:[196,192],else:[197,144],fast:[198,160],gosub:[199,129],elif:[200,144],dim:[201,160],open:[202,128],color:[203,130],loop:[204,192],memcopy:[205,130],end:[206,192],do:[207,224],dpoke:[208,129],close:[209,129],return:[210,129],sprite:[211,136],timer:[212,128],get:[213,128],font:[214,136],wait:[215,130],inkey:[217,128],settings:[218,128],to:[220,64],pi:[222,64],right:[223,98],_lf:[224,192],cos:[225,97],int:[226,97],tan:[227,97],addr:[228,64],sgn:[229,97],limit:[230,98],mid:[231,98],step:[232,64],fpi:[233,64],atn:[234,97],frac:[235,97],dpeek:[236,98],spc:[237,97],sin:[238,97],peek:[239,98],abs:[240,97],left:[241,98],rnd:[242,98],when:[243,98],has:[244,98],tab:[245,97],len:[246,97],time:[247,64],sub:[248,96],ord:[249,97],_sh_lf:[250,0],fn:[251,64],chr:[252,97],find:[253,96],val:[254,97],between:[255,98]},et=[130,128,192,128,160,192,160,129,128,176,192,128,128,130,192,128,129,192,160,128,192,129,136,129,129,129,128,0,0,0,0,0,0,24,2,21,17,30,16,2,29,31,1,128,2,128,128,128,34,34,35,32,35,32,35,36,36,36,33,33,33,33,33,33,128,128,136,128,192,144,160,129,144,160,128,130,192,130,192,224,129,129,129,136,128,128,136,130,0,128,128,0,64,0,64,98,192,97,97,97,64,97,98,98,64,64,97,97,98,97,97,98,97,98,98,98,98,97,97,64,96,97,0,64,97,96,97,98],Ur={locate:128,read:129,break:130,call:131,def:132,endif:133,for:134,goto:135,local:136,if:137,fend:138,clr:139,let:140,memset:141,next:142,on:143,poke:144,continue:145,repeat:146,set:147,then:148,until:149,voice:150,while:151,exec:152,input:153,sys:154,CHAR:160,F08:161,DQUOTE:162,WORD:163,UWORD:164,F2416:165,BYTE:166,SQUOTE:167,F88:168,FLOAT:169,DCHAR:170,inc:171,QQUOTE:172,dec:173,_label:174,rem:175,"+":176,"-":177,"*":178,AND:179,"&&":179,div:180,"/":180,OR:181,"||":181,mod:182,"%":182,xor:183,"^":183,and:184,"&":184,or:185,"|":185,"<":186,"==":187,"=":187,">=":188,"!=":189,"<>":189,"<=":190,">":191,print:192,data:193,bitmap:194,fcall:195,dend:196,else:197,fast:198,gosub:199,elif:200,dim:201,open:202,color:203,loop:204,memcopy:205,end:206,do:207,dpoke:208,close:209,return:210,sprite:211,timer:212,get:213,font:214,wait:215,inkey:217,settings:218,to:220,pi:222,right:223,_lf:224,cos:225,int:226,tan:227,addr:228,sgn:229,limit:230,mid:231,step:232,fpi:233,atn:234,frac:235,dpeek:236,spc:237,sin:238,peek:239,abs:240,left:241,rnd:242,when:243,has:244,tab:245,len:246,time:247,sub:248,ord:249,_sh_lf:250,fn:251,chr:252,find:253,val:254,between:255},Pi={128:"locate",129:"read",130:"break",131:"call",132:"def",133:"endif",134:"for",135:"goto",136:"local",137:"if",138:"fend",139:"clr",140:"let",141:"memset",142:"next",143:"on",144:"poke",145:"continue",146:"repeat",147:"set",148:"then",149:"until",150:"voice",151:"while",152:"exec",153:"input",154:"sys",160:"CHAR",161:"F08",162:"DQUOTE",163:"WORD",164:"UWORD",165:"F2416",166:"BYTE",167:"SQUOTE",168:"F88",169:"FLOAT",170:"DCHAR",171:"inc",172:"QQUOTE",173:"dec",174:"_label",175:"rem",176:"+",177:"-",178:"*",179:"&&",180:"/",181:"||",182:"%",183:"^",184:"&",185:"|",186:"<",187:"=",188:">=",189:"<>",190:"<=",191:">",192:"print",193:"data",194:"bitmap",195:"fcall",196:"dend",197:"else",198:"fast",199:"gosub",200:"elif",201:"dim",202:"open",203:"color",204:"loop",205:"memcopy",206:"end",207:"do",208:"dpoke",209:"close",210:"return",211:"sprite",212:"timer",213:"get",214:"font",215:"wait",217:"inkey",218:"settings",220:"to",222:"pi",223:"right",224:"_lf",225:"cos",226:"int",227:"tan",228:"addr",229:"sgn",230:"limit",231:"mid",232:"step",233:"fpi",234:"atn",235:"frac",236:"dpeek",237:"spc",238:"sin",239:"peek",240:"abs",241:"left",242:"rnd",243:"when",244:"has",245:"tab",246:"len",247:"time",248:"sub",249:"ord",250:"_sh_lf",251:"fn",252:"chr",253:"find",254:"val",255:"between"},ut={UWORD:"w",FIXSTR:"$",UBYTE:"b",SBYTE:"B",SWORD:"W"},ct={FIXSTR:3,UBYTE:16,SBYTE:20,SWORD:21},y={font_set_source0_target0:0,font_set_source0_target1:1,font_set_source1_target0:4,font_set_source1_target1:5,font_set_source_rom_target0:8,font_set_source_rom_target1:9,font_def_uncompressed_multi:16,font_def_uncompressed_1:17,font_def_uncompressed_2:18,font_def_uncompressed_3:19,font_def_uncompressed_4:20,font_def_uncompressed_5:21,font_def_uncompressed_6:22,font_def_uncompressed_7:23,font_copy_full:24,font_copy_lo:25,font_copy_hi:26,font_copy_range_same_index:27,font_copy_range:28,font_create_2x1:32,font_create_2x2:33,font_map_4x4_from:35,font_map_4x4_full:36,font_map_4x8_default:37,font_map_4x8_full:38,font_map_8x4_default:39,font_map_8x4_full:40,font_set_8x8_fill:41,font_use_1x1:48,font_use_2x1:49,font_use_2x2:50,font_use_4x4:51,font_use_4x8:52,font_use_8x4:53,font_use_8x8:54,font_invert_all:64,font_invert_range:65,font_create_from_spr_3x3:81,font_create_from_spr_3x2:82,font_create_from_spr_2x3:83,font_create_from_spr_2x2:84},me={type:20,size:83,addr:0,word:23,byte:2,lo:12,hi:8},ys=["tab","transparent","recolor_only","stop","scroll_actual_column","white","home_current_line","end_current_line","disable_c_shift","enable_c_shift","rep_next","rep_double","rep_between","return","lo_up_charset","scroll_circular_on","scroll_actual_line","down","reverse_on","home","delete","clear_line_content","remove_line","scroll_left","scroll_right","scroll_up","scroll_down","setx","red","right","green","blue","stamp_set_mode","stamp_use","stamp_use_last","window_start","window_stop","box_set_single","box_set_style","box_user_def","box_draw_filled","box_draw_empty","box_set_sides","box_box_filled_compr","box_box_empty_compr","use_fn","setxy","typewriter_mode","buffer_def","buffer_opt","buffer_copy","buffer_paste","input_rx","input_cursor","format_str","format_dec","format_hex","decompress","set_mode_a","set_mode_b","set_mode_c","scroll_set_area","scroll_window","scroll_screen","background","orange","border","run","sety","f1","f3","f5","f7","f2","f4","f6","f8","shift_return","up_gfx_charset","scroll_circular_off","black","up","reverse_off","clear","insert","brown","pink","dark_gray","gray","light_green","light_blue","light_gray","purple","cursor_left","yellow","cyan","set_addr0","set_addr1","set_addr2","set_addr3","push_one","push_two","push_multi","print_src_var","print_src_addr","print_db","print_dw","print_hb","print_hw","print_s","print_f","format_f","def_f1","def_f3","def_f5","def_f7","def_f2","def_f4","def_f6","def_f8","parambuff_susp","parambuff_on","parambuff_off","set_col_bckg","set_col_bord","set_col_bcbd","decode","extra_ff"],br={tab:128,transparent:129,recolor_only:130,stop:131,scroll_actual_column:132,white:133,home_current_line:134,end_current_line:135,disable_c_shift:136,enable_c_shift:137,rep_next:138,rep_double:139,rep_between:140,return:141,lo_up_charset:142,scroll_circular_on:143,scroll_actual_line:144,down:145,reverse_on:146,home:147,delete:148,clear_line_content:149,remove_line:150,scroll_left:151,scroll_right:152,scroll_up:153,scroll_down:154,setx:155,red:156,right:157,green:158,blue:159,stamp_set_mode:160,stamp_use:161,stamp_use_last:162,window_start:163,window_stop:164,box_set_single:165,box_set_style:166,box_user_def:167,box_draw_filled:168,box_draw_empty:169,box_set_sides:170,box_box_filled_compr:171,box_box_empty_compr:172,use_fn:173,setxy:174,typewriter_mode:175,buffer_def:176,buffer_opt:177,buffer_copy:178,buffer_paste:179,input_rx:180,input_cursor:181,format_str:182,format_dec:183,format_hex:184,decompress:185,set_mode_a:186,set_mode_b:187,set_mode_c:188,scroll_set_area:189,scroll_window:190,scroll_screen:191,background:192,orange:193,border:194,run:195,sety:196,f1:197,f3:198,f5:199,f7:200,f2:201,f4:202,f6:203,f8:204,shift_return:205,up_gfx_charset:206,scroll_circular_off:207,black:208,up:209,reverse_off:210,clear:211,insert:212,brown:213,pink:214,dark_gray:215,gray:216,light_green:217,light_blue:218,light_gray:219,purple:220,cursor_left:221,yellow:222,cyan:223,set_addr0:224,set_addr1:225,set_addr2:226,set_addr3:227,push_one:228,push_two:229,push_multi:230,print_src_var:231,print_src_addr:232,print_db:233,print_dw:234,print_hb:235,print_hw:236,print_s:237,print_f:238,format_f:239,def_f1:240,def_f3:241,def_f5:242,def_f7:243,def_f2:244,def_f4:245,def_f6:246,def_f8:247,parambuff_susp:248,parambuff_on:249,parambuff_off:250,set_col_bckg:251,set_col_bord:252,set_col_bcbd:253,decode:254,extra_ff:255,pos_save:65281,pos_load:65282,qsys:65283,qsys_bank:65284,set_tab:65285,poke_single:65286,set_mem:65287,fill_mem:65288},Fi={0:"@",1:"a",2:"b",3:"c",4:"d",5:"e",6:"f",7:"g",8:"h",9:"i",10:"j",11:"k",12:"l",13:"m",14:"n",15:"o",16:"p",17:"q",18:"r",19:"s",20:"t",21:"u",22:"v",23:"w",24:"x",25:"y",26:"z",27:"[",29:"]",32:" ",33:"!",34:'"',35:"#",36:"$",37:"%",38:"&",39:"'",40:"(",41:")",42:"*",43:"+",44:",",45:"-",46:".",47:"/",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",58:":",59:";",60:"<",61:"=",62:">",63:"?",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",97:"K×",98:"I×",99:"T×",101:"G×",103:"M×",106:"N×",107:"Q×",108:"D×",109:"Z×",110:"S×",111:"P×",112:"A×",113:"E×",114:"R×",115:"W×",116:"H×",117:"J×",118:"L×",119:"Y×",120:"U×",121:"O×",123:"F×",124:"C×",125:"X×",126:"V×",127:"B×",28:"{POUND}",30:"{ARR UP}",31:"{ARR LEFT}",64:"{SH *}",91:"{SH +}",92:"{CM -}",93:"{SH -}",94:"{PI}",95:"{CM *}",96:"{SH SPACE}",100:"{CM @}",102:"{CM +}",104:"{CM POUND}",105:"{SH POUND}",122:"{SH @}"},Ge={"@":0,a:1,b:2,c:3,d:4,e:5,f:6,g:7,h:8,i:9,j:10,k:11,l:12,m:13,n:14,o:15,p:16,q:17,r:18,s:19,t:20,u:21,v:22,w:23,x:24,y:25,z:26,"[":27,"]":29," ":32,"!":33,'"':34,"#":35,$:36,"%":37,"&":38,"'":39,"(":40,")":41,"*":42,"+":43,",":44,"-":45,".":46,"/":47,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,":":58,";":59,"<":60,"=":61,">":62,"?":63,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,"K×":97,"I×":98,"T×":99,"G×":101,"M×":103,"N×":106,"Q×":107,"D×":108,"Z×":109,"S×":110,"P×":111,"A×":112,"E×":113,"R×":114,"W×":115,"H×":116,"J×":117,"L×":118,"Y×":119,"U×":120,"O×":121,"F×":123,"C×":124,"X×":125,"V×":126,"B×":127,"{POUND}":28,"{ARR UP}":30,"{ARR LEFT}":31,"{SH *}":64,"{SH +}":91,"{CM -}":92,"{SH -}":93,"{PI}":94,"{CM *}":95,"{SH SPACE}":96,"{CM @}":100,"{CM +}":102,"{CM POUND}":104,"{SH POUND}":105,"{SH @}":122,Ł:28,"^":30,"~":31,"<==":31,"<_":31,"<--":31},C={spr_autoinc_0:0,spr_copy_idx:3,spr_rot_fill:4,spr_mirr_fill_multi:5,spr_mirr_fill_sing:6,spr_spec:15,spr_mirr_h_mult:16,spr_mirr_h_sing:17,spr_mirr_v:18,spr_rot90:19,spr_rot180_sing:20,spr_rot180_mult:21,spr_rot270:22,spr_rot90_mirr_h_sing:23,spr_rot90_mirr_v_sing:24,spr_sh_left_mult:26,spr_sh_right_mult:27,spr_sh_left_sing:28,spr_sh_right_sing:29,spr_sh_up:30,spr_sh_down:31,spr_def_raw:33,spr_copy:34,spr_def_cmp0:35,spr_def_cmp_base:36,spr_double_x:41,spr_double_y:42,spr_double_xy:43,spr_use_predef0:48,spr_use_predef1:49,spr_use_predef2:50,spr_use_predef3:51,spr_use_predef4:52,spr_use_predef5:53,spr_use_predef6:54,spr_use_predef7:55,spr_set_predef0:56,spr_set_predef1:57,spr_set_predef2:58,spr_set_predef3:59,spr_set_predef4:60,spr_set_predef5:61,spr_set_predef6:62,spr_set_predef7:63,spr_autoinc_S:64,spr_inc_S:65,spr_dec_S:66,spr_copy_idx_S:67,spr_rot_fill_S:68,spr_mirr_fill_multi_S:69,spr_mirr_fill_sing_S:70,spr_spec_S:79,spr_mirr_h_mult_S:80,spr_mirr_h_sing_S:81,spr_mirr_v_S:82,spr_rot90_S:83,spr_rot180_sing_S:84,spr_rot180_mult_S:85,spr_rot270_S:86,spr_rot90_mirr_h_sing_S:87,spr_rot90_mirr_v_sing_S:88,spr_sh_left_mult_S:90,spr_sh_right_mult_S:91,spr_sh_left_sing_S:92,spr_sh_right_sing_S:93,spr_sh_up_S:94,spr_sh_down_S:95,spr_set_idx_S:96,spr_def_raw_S:97,spr_copy_S:98,spr_def_cmp0_S:99,spr_def_cmp_base_S:100,spr_double_x_S:105,spr_double_y_S:106,spr_double_xy_S:107,spr_use_predef0_S:112,spr_use_predef1_S:113,spr_use_predef2_S:114,spr_use_predef3_S:115,spr_use_predef4_S:116,spr_use_predef5_S:117,spr_use_predef6_S:118,spr_use_predef7_S:119,spr_set_predef0_S:120,spr_set_predef1_S:121,spr_set_predef2_S:122,spr_set_predef3_S:123,spr_set_predef4_S:124,spr_set_predef5_S:125,spr_set_predef6_S:126,spr_set_predef7_S:127,spr_autoinc_T:128,spr_inc_T:129,spr_dec_T:130,spr_copy_idx_T:131,spr_rot_fill_T:132,spr_mirr_fill_multi_T:133,spr_mirr_fill_sing_T:134,spr_spec_T:143,spr_mirr_h_mult_T:144,spr_mirr_h_sing_T:145,spr_mirr_v_T:146,spr_rot90_T:147,spr_rot180_sing_T:148,spr_rot180_mult_T:149,spr_rot270_T:150,spr_rot90_mirr_h_sing_T:151,spr_rot90_mirr_v_sing_T:152,spr_sh_left_mult_T:154,spr_sh_right_mult_T:155,spr_sh_left_sing_T:156,spr_sh_right_sing_T:157,spr_sh_up_T:158,spr_sh_down_T:159,spr_set_idx_T:160,spr_def_raw_T:161,spr_copy_T:162,spr_def_cmp0_T:163,spr_def_cmp_base_T:164,spr_double_x_T:169,spr_double_y_T:170,spr_double_xy_T:171,spr_use_predef0_T:176,spr_use_predef1_T:177,spr_use_predef2_T:178,spr_use_predef3_T:179,spr_use_predef4_T:180,spr_use_predef5_T:181,spr_use_predef6_T:182,spr_use_predef7_T:183,spr_set_predef0_T:184,spr_set_predef1_T:185,spr_set_predef2_T:186,spr_set_predef3_T:187,spr_set_predef4_T:188,spr_set_predef5_T:189,spr_set_predef6_T:190,spr_set_predef7_T:191,spr_autoinc_TS:192,spr_inc_TS:193,spr_dec_TS:194,spr_copy_idx_TS:195,spr_rot_fill_TS:196,spr_mirr_fill_multi_TS:197,spr_mirr_fill_sing_TS:198,spr_spec_TS:207,spr_mirr_h_mult_TS:208,spr_mirr_h_sing_TS:209,spr_mirr_v_TS:210,spr_rot90_TS:211,spr_rot180_sing_TS:212,spr_rot180_mult_TS:213,spr_rot270_TS:214,spr_rot90_mirr_h_sing_TS:215,spr_rot90_mirr_v_sing_TS:216,spr_sh_left_mult_TS:218,spr_sh_right_mult_TS:219,spr_sh_left_sing_TS:220,spr_sh_right_sing_TS:221,spr_sh_up_TS:222,spr_sh_down_TS:223,spr_set_idx_TS:224,spr_def_raw_TS:225,spr_copy_TS:226,spr_def_cmp0_TS:227,spr_def_cmp_base_TS:228,spr_double_x_TS:233,spr_double_y_TS:234,spr_double_xy_TS:235,spr_use_predef0_TS:240,spr_use_predef1_TS:241,spr_use_predef2_TS:242,spr_use_predef3_TS:243,spr_use_predef4_TS:244,spr_use_predef5_TS:245,spr_use_predef6_TS:246,spr_use_predef7_TS:247,spr_set_predef0_TS:248,spr_set_predef1_TS:249,spr_set_predef2_TS:250,spr_set_predef3_TS:251,spr_set_predef4_TS:252,spr_set_predef5_TS:253,spr_set_predef6_TS:254,spr_set_predef7_TS:255},se={SUB_COMMAND:8,EVAL_SINGLE:1,EVAL_ALL:2,COMMAND:128,FUNC:64,OPERATOR:32,TYPE:0,MASK_LONG:224},Mi=[255,78,81,84,87,90,93,96,99,102,105,108,111,114,117,120,123,126,129,132,135,138,141,144,147,150,153,255,255,255,255,255,255,186,180,213,255,174,255,192,255,255,195,204,165,231,210,201,156,168,207,222,177,183,189,228,216,198,255,171,162,225,219,159,255,0,3,6,9,12,15,18,21,24,27,30,33,36,39,42,45,48,51,54,57,60,63,66,69,72,75,255,255,255,255,255],ie={rega:1,regx:65,regy:112,regp:111,pcnt:16,param:80,time:20,timehi:84,scrx:24,scry:25,raster:9};var Pt=(t=>(t[t.ALL=0]="ALL",t[t.DEBUG_DETAIL=80]="DEBUG_DETAIL",t[t.DEBUG=256]="DEBUG",t[t.WARN=512]="WARN",t[t.ERR=1024]="ERR",t))(Pt||{});class At{addFn;fs;minPriority;targetPath="";fileStream;constructor(){this.minPriority=1024}static createFileLogger(e="logs",r=1024){const a=new At;a.minPriority=r,a.addFn=a.addToFile,(e.endsWith("/")||e.endsWith("\\"))&&(e=e.slice(0,-1));try{a.fs=require("fs"),a.fs.mkdir(e,i=>{if(i&&i.code!="EEXIST")return console.error(i)})}catch(i){console.error(i),a.fs={appendFileSync:console.log}}const s=new Date().toISOString().slice(0,13);return a.targetPath=`${e}/log_${s}.txt`,a}static createConsoleLogger(e=512){const r=new At;return r.minPriority=e,r.addFn=r.addToConsole,r}add(e,...r){this.minPriority>e||this.addFn(e,...r)}warn(...e){this.add(512,...e)}err(...e){this.add(1024,...e)}debug(...e){this.add(256,...e)}debugDetail(...e){this.add(80,...e)}addToConsole(e,...r){console.log(String(r))}addToFile(e,...r){let a="@gb_constructor";if(gb?._getCallStack)try{a=gb._getCallStack()[3].funcName}catch{}const s=new Date().toISOString()+" | "+a+" - "+String(r)+`
`;this.fs.appendFileSync(this.targetPath,s)}setPriority(e){this.minPriority=e}}Number.prototype.lo=function(){return this&255};Number.prototype.hi=function(){return this>>8&255};Number.prototype.toHex=function(t){return this.toString(16).padStart(t,"0")};Number.prototype.toDec=function(t){return this.toString(10).padStart(t,"0")};Number.prototype.toBin=function(t){return this.toString(2).padStart(t,"0")};Number.prototype.toHex2=function(){return this.toHex(2)};Number.prototype.toHex4=function(){return this.toHex(4)};Number.prototype.toBCD8=function(){return this%10+(Math.floor(this/10)&15)*16};Number.prototype.getWord=function(t,e){return t+e*256};Number.prototype.asByte=function(){return this&255};Number.prototype.asWord=function(){return this&65535};String.prototype.splice=function(t,e,r=""){return this.slice(0,t)+r+this.slice(t+e)};function f(t){return fr(t[0])}function Ft(t,e=!1){return e?[`@ABCDEFGHIJKLMNOPQRSTUVWXYZ[£]↑← !"#$%&'()*+,-./0123456789:;<=>?━♠│─▔▔▁▍▕╮╰╯└╲╱┌┐●▁♥▏╭╳○♣▕♦➕⡇|.. ▌▄‾▁▎▒▕⣤.▕┣▗┗┓▂┏┻┳┫▎▍▐‾▀▃.▖▝┛▘▚`[t&127],(t&128)>0]:[`@abcdefghijklmnopqrstuvwxyz[£]↑← !"#$%&'()*+,-./0123456789:;<=>?━ABCDEFGHIJKLMNOPQRSTUVWXYZ➕⡇|π◥ ▌▄‾▁▎▒▕⣤◤▕┣▗┗┓▂┏┻┳┫▎▍▐‾▀▃⅃▖▝┛▘▚`[t&127],(t&128)>0]}function Li(t){let e=0;return t<32?e=t+128:32<=t&&t<64?e=t:64<=t&&t<96?e=t-64:96<=t&&t<128?e=t-32:128<=t&&t<160?e=t+64:160<=t&&t<192?e=t-64:192<=t&&t<224||224<=t&&t<255?e=t-128:t==255&&(e=94),e}function Qi(t){let e=t.charCodeAt(0);return(65<=e&&e<=90||97<=e&&e<=122)&&(e^=32),e}function fr(t){const e=Qi(t);return Li(e)}class dt{_value;name;constructor(e){this._value=0,this.name=e}get value(){return this._value&255}asByte(){return this._value&255}set value(e){this._value=e&255}get lo(){return this._value}get hi(){return 0}set lo(e){this._value=e&255}set hi(e){}get N(){return(this.lo&128)>0}get V(){return(this.lo&64)>0}get Z(){return this.lo==0}inc(e=1){this._value=this._value+e&255}dec(e=1){this._value=this._value-e&255}mul(e){this._value=this._value*e&255}bitTest(e){return(this._value&e)==e}valueOf(){return this._value}repeat(e){const r=this.name;if(r!="x"&&r!="y")throw new Error(`Invalid register ${r}`);const a=gb._owner["_"+r];for(;this._value>0;){e();const s=gb._owner["_"+r];if(a!=s)throw new Error(`$Invalid owner ${s} instead of ${a}`);this.dec()}}[Symbol.toPrimitive](e){return e==="number"?this.valueOf():0}get asChar(){return Ft(this.value)[0]}}function Yi(t,e,r,a){const s=[];return e.split("").forEach((i,n)=>{const o="_"+i.toLowerCase(),u=a[0][i];gb[o].value=u,s.push(gb[o])}),s}function Wr(t,e,r,a){let s="";e.split("").forEach((i,n)=>{const o="_"+i.toLowerCase()||"X";if(s=a[n].name,gb[o].name!=s)throw new Error(`Invalid value for register ${i}: ${gb[o].name} vs ${s}`);gb.regSetter(o,gb[o].value,r.name),gb._stacks[i.toLowerCase()].push(gb._owner[o])})}function Gi(t,e,r,a){e.split("").forEach((s,i)=>{})}function tr(t,e){e.split("").forEach((r,a)=>{const s="_"+r.toLowerCase(),i=gb._stacks[r.toLowerCase()].pop();gb._owner[s]=i||"Unknown"})}function b(t){function e(s,i,n){return!(n[0]instanceof dt)&&n[0]instanceof Object&&(n=Yi(s,t.input,i,n)),t.input&&Wr(s,t.input,i,n),t.save&&gb.save(t.save),t.safeInput&&(gb.save(t.safeInput),Wr(s,t.safeInput,i,n)),t.tempProtect&&gb._temp.protect(s),t.output&&Gi(s,t.output),n}function r(s,i,n){t.output&&tr(s,t.output),t.tempProtect&&gb._temp.unprotect(s),t.safeInput&&(tr(s,t.safeInput),gb.restore(t.safeInput)),t.save&&gb.restore(t.save),t.input&&tr(s,t.input)}function a(){try{gb={}}catch{global.gb={}}gb._logger=At.createFileLogger("logs/",Pt.ERR),gb._logger.setPriority(Pt.ALL)}return function(s,i,n){const o=n.value;return typeof gb>"u"&&a(),n.value=function(...u){gb._calls[o.name]||(gb._calls[o.name]={calls:0,totalTime:0}),gb._calls[o.name].calls++;const d=performance.now(),p=e(this,o,u),g=o.apply(this,p);return r(this),gb._calls[o.name].totalTime+=performance.now()-d,g},n}}class k{initVars(){}initVals(e){Object.keys(e).forEach(r=>{try{const a=this[r];a.value=e[r]??0}catch(a){throw new Error(`Error during initializating variable ${String(r)}:
`+a.message)}})}init(){}setMem(e,r){gb._bus.write(e,r)}setRAM(e,r){this.setMem(e,r)}}const Cs=Pi,_={...Ur,SQUOTE:167,DQUOTE:162,assignValue:Ur["="]},qi=Object.assign({},br,C,y);var ee=(t=>(t[t.ARR=32]="ARR",t[t.NUM=16]="NUM",t[t.FRAC=8]="FRAC",t[t.SIGNED=4]="SIGNED",t[t.LEN=3]="LEN",t[t.LEN1=0]="LEN1",t[t.LEN2=1]="LEN2",t[t.LEN3=2]="LEN3",t[t.LEN5=3]="LEN5",t[t.LENV=2]="LENV",t[t.LENF=3]="LENF",t[t.STR=0]="STR",t[t.NULL=0]="NULL",t[t.NUM_SFRAC=28]="NUM_SFRAC",t[t.NUM_FRAC=24]="NUM_FRAC",t[t.NUM_SINT=20]="NUM_SINT",t[t.NUM_INT=16]="NUM_INT",t[t.NO_SUPPORT=0]="NO_SUPPORT",t))(ee||{}),Qt=(t=>(t[t.ARR=32]="ARR",t[t.NON_ARR=32]="NON_ARR",t[t.NUM=16]="NUM",t[t.FRAC=24]="FRAC",t[t.INT=24]="INT",t[t.SINT=28]="SINT",t[t.SFRAC=28]="SFRAC",t[t.BYTE=19]="BYTE",t[t.WORD=19]="WORD",t[t.STR=16]="STR",t))(Qt||{}),Yt=(t=>(t[t.ARR=32]="ARR",t[t.NON_ARR=0]="NON_ARR",t[t.NUM=16]="NUM",t[t.FRAC=24]="FRAC",t[t.INT=16]="INT",t[t.SINT=20]="SINT",t[t.SFRAC=28]="SFRAC",t[t.BYTE=16]="BYTE",t[t.WORD=17]="WORD",t[t.STR=0]="STR",t))(Yt||{}),$=(t=>(t[t._NONE=0]="_NONE",t[t._CHAR=0]="_CHAR",t[t._DCHAR=1]="_DCHAR",t[t._VARSTR=2]="_VARSTR",t[t._FIXSTR=3]="_FIXSTR",t[t._UBYTE=16]="_UBYTE",t[t._UWORD=17]="_UWORD",t[t._SBYTE=20]="_SBYTE",t[t._SWORD=21]="_SWORD",t[t._UF08=24]="_UF08",t[t._UF88=25]="_UF88",t[t._U2416=27]="_U2416",t[t._SF08=28]="_SF08",t[t._SF88=29]="_SF88",t[t._S2416=31]="_S2416",t[t._FLOAT=3]="_FLOAT",t[t.CONST_STR=131]="CONST_STR",t[t.RET_STR=0]="RET_STR",t[t.RET_INT=16]="RET_INT",t[t.RET_MASK=16]="RET_MASK",t))($||{});class Ze{modifier=Gt._NULL;type=T._NONE;memory=[];name="___";namespace="___";address=-1;rawValue=null;bytes=0;comment="";taint=0;createVar(e,r,a,s){this.name=e,this.namespace="",this.bytes=1,this.rawValue=a,this.taint=0,typeof r=="number"?(this.address=r,gb._gvar.reserveByAddress(e,this.address,s)):r[0]==="="?(this.address=gb._gvar.varAddr[r.slice(1)],gb._gvar.reserveByAddress(e,this.address,s)):r[0]==="+"?(this.address=gb._gvar.varAddr[r.slice(1)]+1,gb._gvar.reserveByAddress(e,this.address,s)):r[0]==="~"?this.address=parseInt(r.slice(1)):this.address=gb._gvar.reserveByZone(e,r,s),gb._gvar.varAddr[e]=this.address,gb._gvar.mapped[this.address]||=[];const i={name:e,ref:e};gb._gvar.mapped[this.address].push(i)}assertTaint(){!gb._taint.isEnabled()||this.taint==0||this.taint!=gb._taint.getTaint()&&gb.error.systemError(`Taint error: ${this.namespace}.${this.name} was tainted to ${this.taint} instead of ${gb._taint.getTaint()}!`)}setTaint(){this.taint=gb._taint.getTaint()}get value(){this.assertTaint();let e=this.memory[this.address];return this.bytes==2&&(e+=this.memory[this.address+1]*256),e}set value(e){this.setTaint(),this.memory[this.address]=e&255,this.bytes==2&&(this.memory[this.address+1]=e>>8&255)}get lo(){return this.assertTaint(),this.memory[this.address]}get hi(){return this.assertTaint(),this.memory[this.address+1]}set lo(e){this.setTaint(),this.memory[this.address]=e&255}set hi(e){this.setTaint(),this.memory[this.address+1]=e&255}get N(){return this.assertTaint(),(this.lo&128)>0}get V(){return this.assertTaint(),(this.lo&64)>0}get Z(){return this.assertTaint(),this.lo==0}get addressLo(){return this.address&255}get addressHi(){return this.address>>8&255}inc(e=1,r=!1){if(this.setTaint(),this.bytes==2||r){let a=this.memory[this.address]+this.memory[this.address+1]*256;a+=e,this.memory[this.address]=a&255,this.memory[this.address+1]=a>>8&255}else this.memory[this.address]=this.memory[this.address]+e&255}inc16(e=1){this.setTaint(),this.inc(e,!0)}dec(e=1,r=!1){if(this.setTaint(),this.bytes==2||r){let a=this.memory[this.address]+this.memory[this.address+1]*256;a-=e,this.memory[this.address]=a&255,this.memory[this.address+1]=a>>8&255}else this.memory[this.address]=this.memory[this.address]-e&255}dec16(e=1){this.setTaint(),this.dec(e,!0)}bitTest(e){return this.assertTaint(),(this.memory[this.address]&e)==e}setOfsValue(e,r){this.setTaint(),this.memory[this.address+e]=r}getOfsValue(e){return this.assertTaint(),this.memory[this.address+e]}getOfsWord(e){return this.assertTaint(),this.memory[this.address+e]+this.memory[this.address+e+1]*256}setOfsWord(e,r){this.setTaint(),this.memory[this.address+e]=r&255,this.memory[this.address+e+1]=r>>8&255}asByte(){return this.lo}asWord(){return this.hi*256+this.lo}get asChar(){return Ft(this.lo)[0]}describe(){console.log(`${this.namespace}.${this.name} - ${this.address.toHex4()} (${this.bytes.asByte()} byte(s))`)}init(){}static createFromPointer(e,r){const a=Object.create(this.prototype);return a.address=r,a.memory=e,a}get dataArray(){const e=this.address,r=this.memory[e];return this.memory.slice(e+1,e+1+r)}getDataArrayNoIndex(e){const r=this.address;return this.memory.slice(r,r+e)}}var Gt=(t=>(t[t._NULL=0]="_NULL",t[t._CONST=128]="_CONST",t[t._VAR=64]="_VAR",t[t._EXPR=192]="_EXPR",t[t._ARR=32]="_ARR",t[t.BASE_TYPE=63]="BASE_TYPE",t))(Gt||{}),qe=(t=>(t[t.ARR=32]="ARR",t[t.NUM=16]="NUM",t[t.FRAC=8]="FRAC",t[t.SIGNED=4]="SIGNED",t[t.LEN=3]="LEN",t[t.LEN1=0]="LEN1",t[t.LEN2=1]="LEN2",t[t.LEN3=2]="LEN3",t[t.LEN5=3]="LEN5",t[t.LENV=2]="LENV",t[t.LENF=3]="LENF",t[t.STR=0]="STR",t[t.NULL=0]="NULL",t[t.NUM_SFRAC=28]="NUM_SFRAC",t[t.NUM_FRAC=24]="NUM_FRAC",t[t.NUM_SINT=20]="NUM_SINT",t[t.NUM_INT=16]="NUM_INT",t[t.NO_SUPPORT=0]="NO_SUPPORT",t))(qe||{}),T=(t=>(t[t._NONE=0]="_NONE",t[t._CHAR=0]="_CHAR",t[t._DCHAR=1]="_DCHAR",t[t._VARSTR=2]="_VARSTR",t[t._FIXSTR=3]="_FIXSTR",t[t._UBYTE=16]="_UBYTE",t[t._UWORD=17]="_UWORD",t[t._SBYTE=20]="_SBYTE",t[t._SWORD=21]="_SWORD",t[t._UF08=24]="_UF08",t[t._UF88=25]="_UF88",t[t._U2416=27]="_U2416",t[t._SF08=28]="_SF08",t[t._SF88=29]="_SF88",t[t._S2416=31]="_S2416",t[t._FLOAT=3]="_FLOAT",t[t.CONST_STR=131]="CONST_STR",t[t.RET_STR=0]="RET_STR",t[t.RET_INT=16]="RET_INT",t[t.RET_MASK=16]="RET_MASK",t))(T||{});class c extends Ze{constructor(e,r,a){super(),this.createVar(e,r,a,1)}}class w extends Ze{constructor(e,r,a){super(),this.createVar(e,r,a,2),this.bytes=2}}class he extends Ze{constructor(e,r,a){super(),this.createVar(e,r,a,2),this.bytes=2}setOfsValue(e,r){this.memory[this.value+e]=r}setOfsWord(e,r){this.memory[this.value+e]=r&255,this.memory[this.value+e+1]=r>>8&255}getOfsValue(e){return this.memory[this.value+e]}getOfsWord(e){return this.memory[this.value+e]+this.memory[this.value+e+1]*256}}class Ue extends Ze{strLen;constructor(e,r,a,s=2){super(),this.createVar(e||"__undefined",r,a,s+1),this.strLen=s}init(){this.memory[this.address]=this.strLen;for(let e=0;e<this.strLen;e++){const r=this.rawValue[e];typeof r=="string"?this.memory[this.address+e+1]=fr(r):this.memory[this.address+e+1]=r}}get length(){return this.memory[this.address]}getElement(e){return this.memory[this.address+1+e.asByte()]}}class Ui extends Ze{constructor(e,r,a,s=2){super(),this.createVar(e,r,a,s)}get length(){return this.memory[this.address]}getElement(e){return 0}}class Wi extends he{constructor(e,r,a){super(e,r,a)}}class L extends Ze{len;constructor(e,r,a){super(),this.len=a,this.createVar(e,r,[],a),this.bytes=a}getElement(e){return this.memory[this.address+1+e.asByte()]}}var Ki=Object.defineProperty,Zi=Object.getOwnPropertyDescriptor,qt=(t,e,r,a)=>{for(var s=Zi(e,r),i=t.length-1,n;i>=0;i--)(n=t[i])&&(s=n(e,r,s)||s);return s&&Ki(e,r,s),s},F=(t=>(t[t.VALUE=0]="VALUE",t[t.REF=16]="REF",t[t.COMMAND=128]="COMMAND",t[t.COLON=129]="COLON",t[t.FUNCTION=32]="FUNCTION",t[t.OPERATOR=33]="OPERATOR",t[t.OPEN_BRACKET=34]="OPEN_BRACKET",t[t.CLOSE_BRACKET=35]="CLOSE_BRACKET",t[t.FINISHED=255]="FINISHED",t))(F||{}),We=(t=>(t[t.svar=0]="svar",t[t.svarList=64]="svarList",t[t.cvarRead=128]="cvarRead",t[t.cvarWrite=192]="cvarWrite",t[t.simpleScan=255]="simpleScan",t))(We||{});class mt extends k{variableMode;tokenType;currBasPtr;lastReadValue;lastReadProps;initVars(){const e={variableMode:[c,"vars"],tokenType:[w,"zp"],currBasPtr:[he,"zp"],lastReadValue:[c,"zp"],lastReadProps:[c,"zp"]};gb._gvar.createVars("tokens",e,this)}init(){}readByte(){return this.currBasPtr.inc(),this.lastReadValue.value=gb._bus.read(this.currBasPtr.value),gb.A=this.lastReadValue.value,gb.A}readWord(){gb.A=this.readByte();const e=gb.A.value;return gb.A=this.readByte(),e+gb.A.value*256}assertComma(){gb.A=gb.token.readByte(),gb.A.value!=f(",")&&gb.error.syntaxError("Expected comma")}incPtr(){this.currBasPtr.inc()}decPtr(){this.currBasPtr.dec()}preReadByte(){return gb.A=gb._bus.read(this.currBasPtr.value+1),this.lastReadValue.value=gb.A.value,gb.A}getType(){return gb.X=this.lastReadValue.value,gb.X.N?(gb.A=et[gb.X.value-128],gb.A):(gb.A=0,gb.A)}readNext(){function e(r){return gb.token.tokenType.value=r,gb.A=r,gb.A}if(gb.A=gb.eval.isFinishedPreCheck(),!gb.A.Z)return gb.A=e(255),gb.A;if(this.lastReadProps.value=0,gb.A=gb.token.readByte(),this.lastReadValue.N){switch(gb.X=this.lastReadValue,gb.A=et[gb.X.value-128],this.lastReadProps.value=gb.A.value,gb.A.value&se.MASK_LONG){case se.TYPE:if(gb.operation.var1Type.value=gb.A.value,(gb.A.value&Qt.STR)==Yt.STR){const r=gb.token.readByte();return gb.operation.var1Value.lo=this.currBasPtr.lo,gb.operation.var1Value.hi=this.currBasPtr.hi,this.currBasPtr.inc(r.value),gb.A=e(0),gb.A}else return(gb.A.value&qe.LEN)==qe.LEN1?(gb.A=gb.token.readByte(),gb.operation.var1Value.lo=gb.A.value,gb.operation.var1Value.hi=0,e(0)):(gb.A=gb.token.readByte(),gb.operation.var1Value.lo=gb.A.value,gb.A=gb.token.readByte(),gb.operation.var1Value.hi=gb.A.value,e(0));case se.OPERATOR:return e(33);case se.FUNC:case se.FUNC|32:return gb.A=gb.token.lastReadValue.value,gb.A.value==_.to||gb.A.value==_.step?e(129):e(32)}gb.error.notImplementedError("Other fn")}if(gb.A=this.lastReadValue,gb.A.value>=f("0")&&gb.A.value<=f("9"))return gb.operation.var1Value.lo=gb.A.value-f("0"),gb.operation.var1Value.hi=0,gb.operation.var1Type.value=T._UBYTE,gb.A=e(0),gb.A;if((gb.A.value^64)<96){if(gb.A=gb.vars.convertScreenToVarOffset(gb.A),gb.A.value<255){if(gb.token.variableMode.value==64)return gb.X=gb.A,gb.vars.setVar1FromVarIdx(gb.X),gb.A=e(16),gb.A;if(gb.token.variableMode.value==0)return gb.X=gb.A,gb.vars.setVar1FromVarIdx(gb.X),gb.A=e(0),gb.A;if(gb.token.variableMode.value==128)return gb.X=gb.A,gb.vars.setVar1FromVarIdx(gb.X),gb.cvar.readValue(),gb.A=e(0),gb.A;if(gb.token.variableMode.value==192)return gb.cvar.readReference(),gb.A=e(16),gb.A;if(gb.token.variableMode.value==255)return gb.A=e(0),gb.A;gb.A=this.lastReadValue,gb.error.notImplementedError("Variable mode not implemented")}gb.A=this.lastReadValue}switch(gb.A.value){case f("("):return gb.A=e(34),gb.A;case f(")"):return gb.A=e(35),gb.A;case f("$"):return gb.A=e(33),gb.A;case f(","):case f(";"):case _.to:case _.step:return gb.A=e(129),gb.A;case f("@"):return[gb.A,gb.X,gb.Y]=gb.sysv.read(),gb.A=e(0),gb.A;case f("-"):if(gb.token.variableMode.value==64||gb.token.variableMode.value==255)return this.decPtr(),gb.X=gb.eval.getNextSVarIdx(),gb.vars.setVar1FromVarIdx(gb.X),gb.A=e(16),gb.A;gb.error.notImplementedError("- not implemented here")}return gb.error.notImplementedError(`Code: ${this.lastReadValue.asByte()} char: ${this.lastReadValue.asChar}`),gb.A}}qt([b({output:"A"})],mt.prototype,"readByte");qt([b({output:"A"})],mt.prototype,"preReadByte");qt([b({output:"A",save:"X"})],mt.prototype,"getType");qt([b({save:"X",output:"A"})],mt.prototype,"readNext");var Hi=Object.defineProperty,Xi=Object.getOwnPropertyDescriptor,Ss=(t,e,r,a)=>{for(var s=Xi(e,r),i=t.length-1,n;i>=0;i--)(n=t[i])&&(s=n(e,r,s)||s);return s&&Hi(e,r,s),s};class Ar{run(){if(gb.eval.initSVarList(),gb.A=gb.token.readNext(),gb.A.value==F.FINISHED)return this.clearAllVariables(),10;if(gb.A.value==F.VALUE){const e=gb.operation.var1Value.value;gb._bus.write(e,0)}else do gb.X=gb.vars.lastVarIdx,this.resetVariableByOffset(gb.X),gb.A=gb.eval.getNextSVarIdx();while(gb.A.value<253);return 10}clearAllVariables(){gb.X=0;do this.resetVariableByOffset(gb.X),gb.X.inc(3);while(gb.X.value<231)}resetVariableByOffset(e){gb.A=gb.vars.gbasVarTypeBase.getOfsValue(gb.X.value),(gb.A.value=gb.vars.isArray(gb.A).value)&&(gb._logger.err(`Variable with idx ${e} is an array!`),gb.error.notImplementedError()),gb.vars.gbasVarLoBase.setOfsValue(gb.X.value,0),gb.vars.gbasVarHiBase.setOfsValue(gb.X.value,0)}}Ss([b({save:"X"})],Ar.prototype,"clearAllVariables");Ss([b({save:"A",safeInput:"X"})],Ar.prototype,"resetVariableByOffset");class $i{run(){switch(gb.A=gb.eval.cmdArgCount.value,gb.A.value){case 0:gb.gscr.resetColors();break;case 1:gb.gscr.textColor.value=gb.expr.valueArrayLo.value;break;case 2:if(gb.expr.valueArrayType.value==T._NONE){gb.A=gb.expr.valueArrayLo.getOfsValue(3),gb._bus.write(53281,gb.A.value);break}gb.X=gb.expr.valueArrayLo.getOfsValue(3)&15,gb.A=gb.expr.valueArrayLo.value,gb._bus.write(53280+gb.X.value,gb.A.value);break;default:gb.error.invalidParameters()}return 20}}class ji{isTargetRam;run(){if(this.isTargetRam=0,gb.mem.destPtr.value=gb.operation.var1Value.value,gb.A=gb.token.tokenType,gb.A.value==F.FINISHED)return gb.mem.destPtr.setOfsValue(0,0),gb.mem.destPtr.setOfsValue(1,0),10;for(gb.eval.evalAll(),gb.X=0,gb.expr.valueArrayType.value==T._NONE&&((gb.mem.destPtr.hi&240)==208&&(this.isTargetRam=255),gb.X.inc(3),gb.error.notImplementedError());gb.X.value<gb.expr.valueIndex.value;){switch(gb.A=gb.expr.valueArrayType.getOfsValue(gb.X.value),gb.A.value){case T._NONE:gb.mem.destPtr.inc(),gb.mem.destPtr.inc();break;case T._UBYTE:case T._SBYTE:case T._SWORD:case T._UWORD:gb.A=gb.expr.valueArrayLo.getOfsValue(gb.X.value),gb.mem.destPtr.setOfsValue(0,gb.A.value),gb.mem.destPtr.inc(),gb.A=gb.expr.valueArrayHi.getOfsValue(gb.X.value),gb.mem.destPtr.setOfsValue(0,gb.A.value),gb.mem.destPtr.inc();break;default:gb.error.invalidType()}gb.X.inc(3)}return 10}}var zi=Object.defineProperty,Ji=Object.getOwnPropertyDescriptor,Ut=(t,e,r,a)=>{for(var s=Ji(e,r),i=t.length-1,n;i>=0;i--)(n=t[i])&&(s=n(e,r,s)||s);return s&&zi(e,r,s),s},X=(t=>(t[t.for=1]="for",t[t.repeat=2]="repeat",t[t.if=3]="if",t[t.elif=4]="elif",t[t.do=5]="do",t[t.call=6]="call",t))(X||{});const en={1:"for",2:"repeat",3:"if",4:"elif",5:"do",6:"call"};class _t extends k{execStackIndex;execStackWriteIndex;execStackIndexArray;execStackDataArray;assertedToken;initVars(){const e={execStackIndex:[c,"vars"],execStackWriteIndex:[c,"vars"],assertedToken:[c,"temp"],execStackIndexArray:[L,"vars",64],execStackDataArray:[L,"vars",256]};gb._gvar.createVars("exstack",e,this)}init(){this.execStackIndex.value=0,this.execStackIndexArray.setOfsValue(0,0),this.execStackIndexArray.setOfsValue(1,0),this.execStackWriteIndex.value=0}storeAddressWithToken(e){this.pushVal(gb.A),gb.A=gb.token.readByte(),this.pushVal(gb.A),gb.A=gb.token.readByte(),this.pushVal(gb.A)}pushVal(e){gb.X=this.execStackWriteIndex.value,this.execStackDataArray.setOfsValue(gb.X.value,gb.A.value),this.execStackWriteIndex.inc()}pushWord(e,r){this.pushVal(gb.A),gb.A=gb.Y.value,this.pushVal(gb.A)}close(){this.execStackWriteIndex.value>232&&gb.error.systemError("Execution stack overflow!"),this.execStackIndex.inc(),gb.X=this.execStackIndex.value,gb.A=this.execStackWriteIndex.value,this.execStackIndexArray.setOfsValue(gb.X.value,gb.A.value)}removeLast(){this.execStackIndex.dec(),gb.X=this.execStackIndex.value,gb.A=this.execStackIndexArray.getOfsValue(gb.X.value),this.execStackWriteIndex.value=gb.A.value}getPointerWithAssert(e){return this.assertedToken.value=gb.A.value,gb.X=gb.exstack.execStackIndex,gb.A=gb.exstack.execStackIndexArray.getOfsValue(gb.X.value-1),gb.X=gb.A,gb.A=gb.exstack.execStackDataArray.getOfsValue(gb.X.value),gb.A.value!=this.assertedToken.value&&gb.error.systemError(`Expected token ${this.assertedToken.value} not found in execution stack!`),gb.X}fillNextTokens(){}readNextAddress(){}expectLastAs(){gb.A=gb.token.readByte(),gb.vars.readRef(gb.A)}printStack(){let e=`Count: ${this.execStackIndex.value}
Indexes: ${this.execStackIndexArray.getDataArrayNoIndex(16)}
`;for(let r=0;r<=this.execStackIndex.value;r++){const a=this.execStackIndexArray.getOfsValue(r),s=this.execStackIndexArray.getOfsValue(r+1)||this.execStackWriteIndex.value;let i=en[this.execStackDataArray.getOfsValue(a)];typeof i>"u"&&(i="***");let n="";for(let o=a+1;o<s;o++){const u=gb.hex(this.execStackDataArray.getOfsValue(o),2,"$");n+=`${u} `}e+=`Stack idx #${r} @(${a}): ${i} ${n}
`}return e}}Ut([b({input:"A"})],_t.prototype,"storeAddressWithToken");Ut([b({input:"A"})],_t.prototype,"pushVal");Ut([b({input:"AY"})],_t.prototype,"pushWord");Ut([b({input:"A",output:"X"})],_t.prototype,"getPointerWithAssert");var tn=Object.defineProperty,rn=Object.getOwnPropertyDescriptor,sn=(t,e,r,a)=>{for(var s=rn(e,r),i=t.length-1,n;i>=0;i--)(n=t[i])&&(s=n(e,r,s)||s);return s&&tn(e,r,s),s};class ht extends k{initVars(){}init(){}runIf(){return gb.exstack.pushVal({A:X.if}),gb.AY=gb.token.readWord(),gb.exstack.pushWord(gb.A,gb.Y),gb.AY=gb.token.readWord(),gb.exstack.pushWord(gb.A,gb.Y),gb.exstack.close(),this.evalIf(),10}runEndIf(){gb.X=gb.exstack.getPointerWithAssert({A:X.if}),gb.exstack.removeLast()}updateElseBranch(){gb.exstack.execStackWriteIndex.dec(2),gb.AY=gb.token.readWord(),gb.exstack.pushWord(gb.A,gb.Y)}jumpElse(){switch(gb.X=gb.exstack.getPointerWithAssert({A:X.if}),gb.token.currBasPtr.value=gb.exstack.execStackDataArray.getOfsWord(gb.X.value+3),gb.token.decPtr(),gb.A=gb.token.readByte(),gb.A.value){case _.elif:this.updateElseBranch(),this.evalIf();break;case _.else:gb.AY=gb.token.readWord();break;case _.endif:gb.exstack.removeLast();break;default:gb.error.systemError("Invalid branching")}return 10}jumpBlockEnd(){return gb.X=gb.exstack.getPointerWithAssert({A:X.if}),gb.token.currBasPtr.value=gb.exstack.execStackDataArray.getOfsWord(gb.X.value+1),gb.exstack.removeLast(),10}evalIf(){gb.eval.evalSingle(),gb.operation.var1Value.value==0&&this.jumpElse()}}sn([b({tempProtect:!0})],ht.prototype,"runIf");var an=Object.defineProperty,nn=Object.getOwnPropertyDescriptor,on=(t,e,r,a)=>{for(var s=nn(e,r),i=t.length-1,n;i>=0;i--)(n=t[i])&&(s=n(e,r,s)||s);return s&&an(e,r,s),s};class Ts extends k{run(){do{if(gb.A=gb.eval.isFinishedPreCheck(),!gb.A.Z)break;gb.vars.initRef(),gb.cvar.readReference(),gb.vars.varTargetRef.value=gb.vars.lastRef.value,gb.A=gb.token.readByte(),gb.A.value!=_.assignValue&&gb.error.syntaxError(`Code: ${gb.A.value}, char: ${Fi[gb.A.value]}`),gb.eval.evalSingle(),gb.vars.setVarTargetRefValueFromVar1()}while(!0);return 20}}on([b({save:"A"})],Ts.prototype,"run");class ln{run(){switch(gb.A=gb.eval.cmdArgCount.value,gb.A.value){case 0:gb.scrCmd.HOME();break;case 1:gb.gscr.screenX.value=gb.expr.valueArrayLo.getOfsValue(0),gb.gscr.setPos();break;case 2:gb.expr.valueArrayType.value!=T._NONE&&(gb.gscr.screenX.value=gb.expr.valueArrayLo.getOfsValue(0)),gb.gscr.screenY.value=gb.expr.valueArrayLo.getOfsValue(3),gb.gscr.setPos();break;default:gb.error.invalidParameters("Locate")}return 20}}class un{isTargetRam;run(){if(this.isTargetRam=0,gb.mem.destPtr.value=gb.operation.var1Value.value,gb.A=gb.token.tokenType,gb.A.value==F.FINISHED)return gb.mem.destPtr.setOfsValue(0,0),10;for(gb.eval.evalAll(),gb.X=0,gb.expr.valueArrayType.value==T._NONE&&((gb.mem.destPtr.hi&240)==208&&(this.isTargetRam=255),gb.X.inc(3),gb.error.notImplementedError());gb.X.value<gb.expr.valueIndex.value;){switch(gb.A=gb.expr.valueArrayType.getOfsValue(gb.X.value),gb.A.value){case T._NONE:gb.mem.destPtr.inc();break;case T._VARSTR:case T._FIXSTR:const e=gb.expr.valueArrayLo.getOfsValue(gb.X.value)+gb.expr.valueArrayHi.getOfsValue(gb.X.value)*256,r=gb._bus.read(e);gb.mem.copy(e+1,gb.mem.destPtr.asWord(),r),gb.mem.destPtr.inc(r);break;case T._UBYTE:case T._SBYTE:case T._UWORD:case T._SWORD:gb.A=gb.expr.valueArrayLo.getOfsValue(gb.X.value),gb._bus.write(gb.mem.destPtr.asWord(),gb.A.value),gb.mem.destPtr.inc()}gb.X.inc(3)}return 10}}class cn{run(){for(;gb.A=gb.eval.isFinishedPreCheck(),!gb.A.N;)if(gb.eval.evalSingle(),gb.A=gb.operation.var1Type.asByte(),gb.A.value&ee.NUM_INT)this.printNumeric();else if((gb.A.value&Gt.BASE_TYPE)==$._CHAR)gb.gscr.printScrA(gb.operation.var1Value.lo);else{const e=Ue.createFromPointer(gb._ram,gb.operation.var1Value.value);gb.gscr.printDefault(e)}return 10}convertVar1ToLong1(){}convertWordToString(){gb.num.reset_int24(),gb.num.int24_1.value=gb.operation.var1Value.lo,gb.num.int24_2.value=gb.operation.var1Value.hi,gb.num.numFormat.value&4?gb.num.formatAsHex():((gb.operation.getVar1Type().value&Qt.SINT)==Yt.SINT&&(gb.num.num_sgn.value=gb.operation.abs().value,gb.num.int24_1.value=gb.operation.var1Value.lo,gb.num.int24_2.value=gb.operation.var1Value.hi),gb.num.formatAsInt())}printWord(){const e=Ue.createFromPointer(gb._ram,256);gb.gscr.printDefault(e)}printF08(){}printNumeric(){switch(gb.operation.var1Type.value&(ee.FRAC|ee.LEN)){case ee.LEN1:case ee.LEN2:this.convertWordToString(),this.printWord();break;case ee.FRAC|ee.LEN1:this.printF08();break;default:const r=Ue.createFromPointer(gb._ram,gb.operation.var1Value.value);gb.gscr.printTextA(r)}}}var gn=Object.defineProperty,pn=Object.getOwnPropertyDescriptor,dn=(t,e,r,a)=>{for(var s=pn(e,r),i=t.length-1,n;i>=0;i--)(n=t[i])&&(s=n(e,r,s)||s);return s&&gn(e,r,s),s};class ks extends k{run(){for(gb.vars.initRef();gb.A=gb.eval.isFinishedPreCheck(),!gb.A.N;)gb.svar.readReference(),gb.vars.varTargetRef.value=gb.vars.lastRef.value,gb.A=gb.token.readNext(),gb.A.value!=F.VALUE&&gb.error.invalidType(`Invalid data $${gb.token.lastReadValue.value.toHex2()} at ${gb.token.currBasPtr.value.toHex4()}`),gb.vars.setVarTargetRefValueFromVar1();return 20}}dn([b({save:"A"})],ks.prototype,"run");class hn{run(){if(gb.eval.cmdArgCount.Z)return gb.keyb.wait(),10;if(gb.A=gb.expr.valueArrayLo,gb.X=gb.expr.valueArrayHi,gb.eval.cmdArgCount.value==1)return gb.time.waitMs(gb.A,gb.X),10;if(gb.mem.srcPtr.lo=gb.A.value,gb.mem.srcPtr.hi=gb.X.value,gb.X=0,gb.expr.valueArrayType.getOfsValue(3)==T._NONE){const a=gb.expr.valueArrayLo.getOfsValue(6);for(;gb.doEvents(),gb.mem.srcPtr.getOfsValue(0)!=a;);return 10}let e=gb.expr.valueArrayLo.getOfsValue(3);e==0&&(e=255);let r=0;for(gb.eval.cmdArgCount.value>2&&(r=gb.expr.valueArrayLo.getOfsValue(6));gb.doEvents(),!(((gb.mem.srcPtr.getOfsValue(0)^r)&e)>0););return 10}}class bn{run(){return gb.func.evalAll(),gb.X=gb.func.getParam({X:0}),gb.operation.var1Value.lo=gb.expr.valueArrayLo.getOfsValue(gb.X.value),gb.operation.var1Value.hi=0,gb.operation.var1Type.value=$._CHAR,0}}class fn{run(){return gb.func.evalAll(),gb.X=gb.func.getParam({X:0}),gb.mem.srcPtr.lo=gb.expr.valueArrayLo.getOfsValue(gb.X.value),gb.mem.srcPtr.hi=gb.expr.valueArrayHi.getOfsValue(gb.X.value),gb.operation.var1Value.lo=gb.mem.srcPtr.getOfsValue(0),gb.operation.var1Value.hi=0,gb.operation.var1Type.value=$._UBYTE,0}}const An={fnPoke(t){return new un().run()},fnOpxor(t){return 0},fnThen(t){return 0},fnDim(t){return gb.cmdDim.run()},fnOpen(t){return 0},fnFont(t){return gb.cmdFont.run()},fnRead(t){return 0},fnIf(t){return new ht().runIf()},fnRight(t){return 0},fnWord(t){return 0},fnOpmulti(t){return 0},fnFind(t){return 0},fnDef(t){return gb.cmdDefCall.runDef()},fnDec(t){return gb.cmdDecInc.run()},fnAbs(t){return 0},fnF88(t){return 0},fnClose(t){return 0},fnMid(t){return 0},fnReturn(t){return 0},fnSpc(t){return 0},fnTo(t){return 0},fnSys(t){return 0},fnLet(t){return new Ts().run()},fnSet(t){return new ks().run()},fnOrd(t){return 0},fnOpminus(t){return 0},fnByte(t){return 0},fnAtn(t){return 0},fnDend(t){return gb.cmdDefCall.runDend()},fn_label(t){return 0},fn_sh_lf(t){return 0},fnVoice(t){return 0},fnOpcomparegreateroreq(t){return 0},fnInkey(t){return gb.cmdInkey.run()},fnBreak(t){return 0},fnTan(t){return 0},fn_lf(t){return 5e4},fnRnd(t){return 0},fnClr(t){return new Ar().run()},fnSub(t){return 0},fnBitmap(t){return 0},fnEndif(t){return new ht().jumpBlockEnd()},fnMemset(t){return gb.cmdMem.runMemset()},fnUntil(t){return gb.cmdDoLoop.runUntil()},fnEnd(t){return gb.exec.onFinished(),9e4},fnDpeek(t){return 0},fnPrint(t){return new cn().run()},fnWhen(t){return 0},fnSprite(t){return gb.sprite.run()},fnTime(t){return 0},fnNext(t){return gb.cmdForRepeat.next()},fnOpcomparelessoreq(t){return 0},fnGoto(t){return 0},fnTimer(t){return gb.gtimer.run()},fnOpcompareeq(t){return 0},fnFcall(t){return 0},fnSin(t){return 0},fnVal(t){return 0},fnOn(t){return 0},fnHas(t){return 0},fnDchar(t){return 0},fnFn(t){return 0},fnSettings(t){return 0},fnF2416(t){return 0},fnDo(t){return gb.cmdDoLoop.runDo()},fnOpand(t){return 0},fnFast(t){return gb.cmdDefCall.runDef()},fnInput(t){return 0},fnMemcopy(t){return gb.cmdMem.runMemcopy()},fnSgn(t){return 0},fnFloat(t){return 0},fnOpandbitwise(t){return 0},fnPeek(t){return new fn().run()},fnStep(t){return 0},fnContinue(t){return 0},fnF08(t){return 0},fnOpcomparenoteq(t){return 0},fnOpmod(t){return 0},fnLeft(t){return 0},fnFrac(t){return 0},fnGet(t){return 0},fnElse(t){return new ht().jumpBlockEnd()},fnData(t){return 0},fnLoop(t){return gb.cmdDoLoop.runLoop()},fnLimit(t){return 0},fnCall(t){return gb.cmdDefCall.runCall()},fnColor(t){return new $i().run()},fnLocal(t){return 0},fnOpadd(t){return 0},fnChr(t){return new bn().run()},fnVarstr(t){return 0},fnAddr(t){return 0},fnCos(t){return 0},fnTab(t){return 0},fnOpdiv(t){return 0},fnFend(t){return 0},fnOporbitwise(t){return 0},fnInt(t){return 0},fnLocate(t){return new ln().run()},fnRem(t){return 0},fnFor(t){return gb.cmdForRepeat.runFor()},fnRepeat(t){return gb.cmdForRepeat.runRepeat()},fnOpcomparegreater(t){return 0},fnGosub(t){return 0},fnLen(t){return 0},fnFixstr(t){return 0},fnChar(t){return 0},fnOpor(t){return 0},fnInc(t){return gb.cmdDecInc.run()},fnOpcompareless(t){return 0},fnWait(t){return new hn().run()},fnElif(t){return new ht().jumpBlockEnd()},fnWhile(t){return gb.cmdDoLoop.runWhile()},fnDpoke(t){return new ji().run()},fnExec(t){return 0},fnBetween(t){return 0}};function or(t){return 0}const Wt=[];for(let t=0;t<256;t++){const e=["none",or,or,10,0,""];t<128&&(e[1]=()=>mn(t)),Wt.push(e)}const mn=t=>(gb.error.syntaxError(`Invalid function: ${t.toHex2()} at ${gb.token.currBasPtr.value.toHex4()}`),10);Object.entries(Vi).forEach(([t,[e,r]])=>{const a=`fn${t[0].toUpperCase()}${t.slice(1).toLowerCase()}`;Wt[e]=[t,An[a],or,10,r,""]});const Is={1:"not implemented",2:"invalid type",3:"invalid parameters",4:"syntax error",5:"system error",6:"too complex",7:"invalid next"};class _n extends k{errCode;initVars(){const e={errCode:[c,"vars"]};gb._gvar.createVars("error",e,this)}init(){const e={errCode:0};this.initVals(e)}notImplementedError(e=""){gb.error.error(1,e)}invalidType(e=""){gb.error.error(2,e)}invalidParameters(e=""){gb.error.error(3,e)}systemError(e=""){gb.error.error(5,e)}syntaxError(e=""){gb.error.error(4,e)}tooComplexError(e=""){gb.error.error(6,e)}invalidNext(e=""){gb.error.error(7,e)}error(e,r=""){gb.error.errCode.value=e;const a=`Error ${e}: ${Is[e]} - ${r}`;throw Error(a)}}var vn=Object.defineProperty,xn=Object.getOwnPropertyDescriptor,rt=(t,e,r,a)=>{for(var s=xn(e,r),i=t.length-1,n;i>=0;i--)(n=t[i])&&(s=n(e,r,s)||s);return s&&vn(e,r,s),s};const yn=[0,2,4,5,7,8,10,11,13,14,16,18,19,21,22,24,25,27,28,30,32,33,35,36,38,40,41,42,44,46,47,49,50,52,54,55,57,58,60,61,63,64,66,68,69,71,72,74,76,77,78,80,82,83,85,86,88,90,91,92,94,96,97,99,100,102,104,105,107,108,110,111,113,114,116,118,119,121,122,124,125,127,128,130,132,133,135,136,138,140,141,142,144,146,147,149,150,152,154,155,157,158,160,161,163,164,166,168,169,171,172,174,176,177,178,180,182,183,185,186,188,190,191,192,194,196,197,198];var ws=(t=>(t[t.UNSIGNED=0]="UNSIGNED",t[t.SIGNED_POS_PLUS=128]="SIGNED_POS_PLUS",t[t.SIGNED_POS_SPC=192]="SIGNED_POS_SPC",t[t.SIGNED_POS_NONE=64]="SIGNED_POS_NONE",t[t.MASK_SIGNED=192]="MASK_SIGNED",t[t.LEADING=32]="LEADING",t[t.TRAILING=16]="TRAILING",t[t.MASK_WIDTH=15]="MASK_WIDTH",t[t.FRAC_CUT=0]="FRAC_CUT",t[t.FRAC_ROUND=1]="FRAC_ROUND",t[t.FRAC_HALF=2]="FRAC_HALF",t[t.FRAC_WHOLE=3]="FRAC_WHOLE",t))(ws||{});class He extends k{numFormat;numFormatInt;numFormatHex;numFormatFrac;num_sgn;int24_1;int24_2;int24_3;frac_hi;frac_lo;pushCharIndex;tempNumArray;tempNumBase;tempNum1;tempNum2;tempNum3;tempNum4;tempNum5;tempNum6;tempNum7;tempNum8;constructor(){super()}NO_COMPILE=["initVars"];initVars(){const e={numFormat:[c,"vars"],numFormatInt:[c,"vars"],numFormatHex:[c,"vars"],numFormatFrac:[c,"vars"],num_sgn:[c,"vars"],int24_1:[c,"vars"],int24_2:[c,"vars"],int24_3:[c,"vars"],frac_hi:[c,"vars"],frac_lo:[c,"vars"],pushCharIndex:[c,256],"!tempNumArray":[c,256],tempNum1:[c,257],"!tempNumBase":[c,257],tempNum2:[c,258],tempNum3:[c,259],tempNum4:[c,260],tempNum5:[c,261],tempNum6:[c,262],tempNum7:[c,263],tempNum8:[c,264]};gb._gvar.createVars("num",e,this)}reset_int24(){this.int24_1.value=0,this.int24_2.value=0,this.int24_3.value=0,this.num_sgn.value=0}printUByteAtXY(e,r,a){}pushChar(e){gb.A=e,gb.save("X"),gb.X=this.pushCharIndex.value,this.tempNumBase.setOfsValue(gb.X.value,gb.A.value),this.pushCharIndex.inc(),gb.restore("X")}loadInt24FromTemp(){gb.num.int24_3.value=gb.ustr.tempPtr.getOfsValue(2),gb.num.int24_2.value=gb.ustr.tempPtr.getOfsValue(1),gb.num.int24_1.value=gb.ustr.tempPtr.getOfsValue(0)}int24DecToString(e=!0){e&&(this.pushCharIndex.value=0),(this.numFormatInt.value&192)!=0&&(this.num_sgn.value?(gb.A=f("-"),this.pushChar(gb.A)):this.numFormatInt.N&&(gb.A=f(" "),this.numFormatInt.V&&(gb.A=f("+")),this.pushChar(gb.A))),(this.int24_1.value+this.int24_2.value*256+this.int24_3.value*65536).toString(10).split("").forEach((s,i)=>{gb.A=s.charCodeAt(0),this.pushChar(gb.A)})}int24ToHexString(e=!0){e&&(this.pushCharIndex.value=0),(this.int24_1.value+this.int24_2.value*256+this.int24_3.value*65536).toString(16).split("").forEach((s,i)=>{gb.A=f(s[0]),this.pushChar(gb.A)})}fracToString(e=!0){e&&(this.pushCharIndex.value=0);const r=this.frac_hi.value,a=yn[r>>1];let s=a>>1;a&1&&s++,s.toString(10).padStart(2,"0").split("").forEach((n,o)=>{gb.A=n.charCodeAt(0),this.pushChar(gb.A)})}addLeadingSpaces(){this.pushCharIndex.value=0,gb.X=this.numFormat.value>>6,gb.X.Z||this.addXSpaces(gb.X)}addTrailingSpaces(){gb.X=this.numFormat.value&3,gb.X.Z||this.addXSpaces(gb.X)}addXSpaces(e){gb.X.repeat(()=>{gb.A=32,this.pushChar(gb.A)})}formatAsInt(){this.addLeadingSpaces(),this.int24DecToString(!1),this.addTrailingSpaces()}formatAsHex(){this.addLeadingSpaces(),this.int24ToHexString(!1),this.addTrailingSpaces()}formatAsFrac(){this.addLeadingSpaces(),this.int24DecToString(!1),this.fracToString(!1),this.addTrailingSpaces()}}rt([b({input:"AXY"})],He.prototype,"printUByteAtXY");rt([b({input:"A"})],He.prototype,"pushChar");rt([b({save:"A"})],He.prototype,"int24ToHexString");rt([b({save:"X"})],He.prototype,"addLeadingSpaces");rt([b({save:"X"})],He.prototype,"addTrailingSpaces");rt([b({save:"A",input:"X"})],He.prototype,"addXSpaces");var mr=(t=>(t[t.none=0]="none",t[t.running=128]="running",t[t.paused=64]="paused",t[t.finished=32]="finished",t))(mr||{});class Cn extends k{execState;execStarted;execTimeSec;execTimeJiff;freeBeforeGBC;freeAfterGBC;tokenizedCmd;tempA;tempX;tempY;initVars(){const e={execState:[c,"vars"],execStarted:[w,"vars"],execTimeSec:[w,"temp"],execTimeJiff:[w,"temp"],tokenizedCmd:[Ui,"temp"],freeBeforeGBC:[w,"temp"],freeAfterGBC:[w,"temp"],tempA:[c,"temp"],tempX:[c,"temp"],tempY:[c,"temp"]};gb._gvar.createVars("exec",e,this)}init(){this.resetCurrBasPtr(),this.execState.value=0}resetCurrBasPtr(){gb.token.currBasPtr.value=gb.mem.basStart.value-1}isFinished(){return gb.token.currBasPtr.value>=gb.mem.basEnd.value}start(){gb.exinit.performInit(),gb.exec.execState.value=128,gb.time.storeJiffWord(),gb.exec.execStarted.value=gb.time.jiffStore.value;const e=gb._data.createText("execStartText","{UP_GFX_CHARSET REVERSE_OFF WHITE BACKGROUND BLACK BORDER GREEN CLEAR}","Screen initialization for basic program execution - clears screen, sets colors.");gb.gscr.printTextA(e),gb._bus.vic.render(),gb.exstack.fillNextTokens()}waitKey(){}showError(){const e=gb._data.addTemplateStr(`
            {HOME RETURN RETURN REVERSE_OFF WHITE}
            {RED}! error {LIGHT_RED}\${%hb} {WHITE} at {LIGHT_GREEN}\${%hw}.{RETURN}
            `,[gb.error.errCode,gb.token.currBasPtr]);gb.gscr.printTextA(e)}showFinished(){const e=gb._data.addTemplateStr(`
            {HOME RETURN RETURN RETURN RETURN RETURN REVERSE_OFF WHITE}
            prg ended at {LIGHT_GREEN}\${%hw}{WHITE}, last cmd: {LIGHT_RED}{%s}{WHITE}{RETURN}
            exec time: {LIGHT_GREEN}{%w}s {WHITE}/{LIGHT_GREEN} {%w}j{WHITE}.{RETURN}
            free: {LIGHT_GREEN}{%w}b{WHITE}.{RETURN}
            press any key to continue.
            `,[gb.token.currBasPtr,gb.exec.tokenizedCmd,gb.exec.execTimeSec,gb.exec.execTimeJiff,gb.exec.freeAfterGBC]);gb.gscr.printTextA(e)}onFinished(){console.log("Execution finished!"),gb.sprite.resetSprites(),this.execState.value=32,gb.num.numFormatInt.value=ws.UNSIGNED,gb.time.storeJiffWord(),gb.exec.execTimeJiff.value=gb.time.jiffStore.value-gb.exec.execStarted.value,gb.exec.execTimeSec.value=gb.exec.execTimeJiff.value/50,gb.mem.calcFreeMem(!0),gb.exec.freeAfterGBC.value=gb.mem.freeMem.value,gb.error.errCode.Z?gb.exec.showFinished():gb.exec.showError(),gb._emu.renderVIC(),gb._emu.pause(),this.init()}}class Sn{pc;sp;a;x;y;flags;bus;adr=0;instructions;clockCount=0;irqNeeded=!1;irqFinished=!1;isKilled=!1;error="";memory;irqFn;constructor(e){this.a=0,this.x=0,this.y=0,this.pc=2049,this.sp=254,this.flags=0,this.instructions=Wt,this.memory=[],this.bus=e,this.irqFinished=!0}useMemory(e){this.memory=e}disableDebug(){}dummyIRQ(){gb._bus.bus.cpu.irq(),gb._fr+=1}startIRQ(){this.stopIRQ(),this.irqFn=setInterval(this.dummyIRQ,20)}stopIRQ(){this.irqFn&&clearInterval(this.irqFn)}before(){gb.eval.before()}halt(){}clock(){if(gb._emu?.state==pr.STOPPED)return 1;gb.exec.execState.value==mr.none&&(gb._logger.debug("Executing exec init..."),gb.exec.start());const e=performance.now(),r=this.readPC();if(r===void 0)return this.halt(),0;const[a,s,i,n,o,u]=this.instructions[r];this.clockCount++,gb.token.lastReadValue.value=r,gb.token.currBasPtr.value=this.pc-1,this.before(),gb._logger.debug(`Executing ${a} @${(this.pc-1).toHex4()}`);let d=0;try{const h=i(this),m=s(this);d+=n+h+m,isNaN(d)&&(d=0,this.isKilled=!0)}catch(h){if(gb._isVitest)throw h;return gb._logger.err(`Failed with error ${gb.error.errCode.asByte()}, ${Is[gb.error.errCode.value]}`),gb.exec.onFinished(),100}this.after(),this.isKilled&&this.reportTermination();const p=performance.now()-e;gb._totalTime+=p;const g=p/1e3*50;return d=Math.ceil(19656*g*4),Math.min(3e3,Math.max(d,20))}after(){this.pc=gb.token.currBasPtr.value+1}sysCall(e){}read(e){return this.bus.read(e)}reportTermination(){}readPC(){const e=this.bus.read(this.pc);if(this.pc=this.pc+1&65535,Number.isNaN(e))throw Error("Invalid number!");return e}setPc(e){this.pc=e}write(e,r){this.bus.write(e,r)}irq(){this.irqFinished||gb.error.systemError("IRQ not finished!"),this.irqFinished=!1,gb.time.incJiffyClock(),gb.sprite.sprIrq(),gb.gtimer.doTick(),this.irqFinished=!0}nmi(){}reset(){this.pc=2049,this.a=0,this.x=0,this.y=0,gb._totalTime=0}}var lr=(t=>(t[t.DEFAULT=0]="DEFAULT",t[t.TIMER=1]="TIMER",t))(lr||{});class Tn{taintValue;enabled;constructor(){this.taintValue=0,this.enabled=!0}getTaint(){return this.taintValue}setTaintValue(e){this.taintValue=e}getTaintValue(){return this.taintValue}disable(){this.enabled=!1}enable(){this.enabled=!0}isEnabled(){return this.enabled}}class kn{call(e){const r=["token.currBasPtr","eval.lastCommand","ustr.index","gscr.screenPtr","gscr.colorPtr","operation.var1Lo","operation.var1Hi","operation.var1Type"],a={};r.forEach(i=>{const[n,o,...u]=i.split(".");a[i]=gb[n][o].value}),gb.token.currBasPtr.value=e,gb._bus.bus.cpu.pc=e+1,gb._taint.setTaintValue(lr.TIMER);const s=gb._bus.bus.cpu.irqState;for(;gb.A=gb.token.preReadByte(),!(gb.A.value==_.return||gb.A.value==_.fend);)gb._bus.bus.cpu.clock();gb._taint.setTaintValue(lr.DEFAULT),r.forEach(i=>{const[n,o,...u]=i.split(".");gb[n][o].value=a[i]}),gb._bus.bus.cpu.pc=gb.token.currBasPtr.value+1,gb._bus.bus.cpu.irqState=s}}class In extends k{initVars(){const e={};gb._gvar.createVars("editor",e,this)}init(){gb._bus.setVicMemory(6144,1024),this.showTitle(),gb.gscr.resetColors()}showTitle(){const e=gb._data.createText("copyrightText",`{SET_BG_BD $35 CLEAR LO_UP_CHARSET
             SETPOS(2,1) RED}-{GREEN}={YELLOW}= golf basic  {WHITE}(c)2019-22 szokez {YELLOW}={GREEN}={RED}-{RETURN}`,"Welcome screen");gb.gscr.printTextA(e),gb._bus.vic.render()}}var wn=Object.defineProperty,On=Object.getOwnPropertyDescriptor,be=(t,e,r,a)=>{for(var s=On(e,r),i=t.length-1,n;i>=0;i--)(n=t[i])&&(s=n(e,r,s)||s);return s&&wn(e,r,s),s};const Bn=" KIT G M  NQDZSPAERWHJLYUO FCXVB";var ur=(t=>(t[t.ALL=0]="ALL",t[t.LO=1]="LO",t[t.HI=128]="HI",t[t.LO_LNIB=2]="LO_LNIB",t[t.LO_HNIB=3]="LO_HNIB",t[t.HI_LNIB=4]="HI_LNIB",t[t.HI_HNIB=5]="HI_HNIB",t))(ur||{}),cr=(t=>(t[t.NULL=0]="NULL",t[t.LOWER=1]="LOWER",t[t.UPPER=64]="UPPER",t[t.EXED=128]="EXED",t))(cr||{});class le extends k{varbase=52992;gbasVarTypeBase;gbasVarLoBase;gbasVarHiBase;lastVarIdx;lastRef;lastType;varTargetRef;varTargetMaskType;initVars(){const e={gbasVarTypeBase:[L,this.varbase,256],"!gbasVarLoBase":[c,this.varbase+1],"!gbasVarHiBase":[c,this.varbase+2],lastVarIdx:[c,"zp"],lastRef:[he,"zp"],lastType:[c,"vars"],varTargetRef:[he,"zp"],varTargetMaskType:[c,"vars"]};gb._gvar.createVars("vars",e,this)}init(){this.initVals({})}initRef(){this.varTargetMaskType.value=0}convertScreenToVarIndex(e){return(gb.A.value^64)>=96&&(gb.A.value=255),gb.A}convertScreenToVarOffset(e){const r=gb.A.value^64;return r>=96?gb.A.value=255:gb.A.value=Mi[r],gb.A}setVar1FromScrCode(e){gb.X=gb.vars.convertScreenToVarOffset(gb.A),this.setVar1FromVarIdx(gb.X)}setVar1FromVarIdx(e){if(gb.X.value==255){gb.operation.var1Type.value=0;return}this.lastVarIdx.value=gb.X.value,gb.operation.var1Value.lo=gb.vars.gbasVarLoBase.getOfsValue(gb.X.value),gb.operation.var1Value.hi=gb.vars.gbasVarHiBase.getOfsValue(gb.X.value),gb.operation.var1Type.value=gb.vars.gbasVarTypeBase.getOfsValue(gb.X.value),this.setLastFromIdx(gb.X)}setVarTargetRefValueFromVar1(){if(this.varTargetMaskType.value==0){this.varTargetRef.setOfsValue(0,gb.operation.var1Lo.value),this.varTargetRef.setOfsValue(1,gb.operation.var1Hi.value);return}if(this.varTargetMaskType.value==128){this.varTargetRef.setOfsValue(1,gb.operation.var1Lo.value);return}if(this.varTargetMaskType.value==1){this.varTargetRef.setOfsValue(0,gb.operation.var1Lo.value);return}gb.error.notImplementedError("Variable masking not implemented!")}setLastFromIdx(e){const r=gb.vars.gbasVarTypeBase.address+gb.X.value;this.lastRef.value=r,this.lastType.value=this.lastRef.getOfsValue(0),this.lastRef.inc()}setVarConst(e,r){gb.A.value=Ge[e];const a=gb.vars.convertScreenToVarOffset(gb.A);gb.vars.gbasVarLoBase.setOfsValue(a.value,r&255),gb.vars.gbasVarHiBase.setOfsValue(a.value,r>>8)}isArray(e){return gb.A=(gb.A.value&Qt.ARR)==Yt.ARR?1:0,gb.A}readRefWithIdx(e){this.readRef(gb.A)}readRef(e){gb.X=gb.vars.convertScreenToVarOffset(gb.A),this.setLastFromIdx(gb.X)}setVarTypes(){for(let e=0;e<255;e+=3)gb._bus.write(this.varbase+e,$._SWORD)}setVar(e,r,a){gb.A=Ge[e];const s=gb.vars.convertScreenToVarOffset(gb.A);gb.vars.gbasVarTypeBase.setOfsValue(s.value,r),gb.vars.gbasVarLoBase.setOfsValue(s.value,a.lo()),gb.vars.gbasVarHiBase.setOfsValue(s.value,a.hi())}getVar(e){e.endsWith("x")?gb.A=Ge[e.slice(0,1).toUpperCase()+"×"]:gb.A=Ge[e];const r=gb.vars.convertScreenToVarOffset(gb.A),a=gb.vars.gbasVarLoBase.getOfsValue(r.value),s=gb.vars.gbasVarHiBase.getOfsValue(r.value);return{type:gb.vars.gbasVarTypeBase.getOfsValue(r.value),value:a+s*256}}normalizeName(e){return gb.A.value<32?(gb.Y=1,gb.AY):gb.A.value>=64&&gb.A.value<=95?(gb.A.dec(64),gb.Y=64,gb.AY):gb.A.value>=96&&gb.A.value<=127?(gb.A.value=Ge[Bn[gb.A.value-96]]-64,gb.Y=128,gb.AY):(gb.Y=0,gb.AY)}}be([b({input:"A",output:"A"})],le.prototype,"convertScreenToVarIndex");be([b({input:"A",output:"A"})],le.prototype,"convertScreenToVarOffset");be([b({input:"A",save:"X"})],le.prototype,"setVar1FromScrCode");be([b({safeInput:"X"})],le.prototype,"setVar1FromVarIdx");be([b({save:"AX"})],le.prototype,"setVarTargetRefValueFromVar1");be([b({input:"X"})],le.prototype,"setLastFromIdx");be([b({input:"A"})],le.prototype,"isArray");be([b({input:"A"})],le.prototype,"readRefWithIdx");be([b({input:"A"})],le.prototype,"readRef");be([b({input:"A",output:"AY"})],le.prototype,"normalizeName");var Dn=Object.defineProperty,En=Object.getOwnPropertyDescriptor,Os=(t,e,r,a)=>{for(var s=En(e,r),i=t.length-1,n;i>=0;i--)(n=t[i])&&(s=n(e,r,s)||s);return s&&Dn(e,r,s),s};class _r extends k{initVars(){const e={};gb._gvar.createVars("postops",e,this)}useOnVar1(e){switch(gb.A.value){case me.type:gb.operation.var1Value.hi=0,gb.operation.var1Value.lo=gb.operation.var1Type.value,gb.operation.var1Type.value=$._UBYTE;break;case me.size:gb.operation.var1Value.hi=0,gb.A.value=gb.operation.var1Type.value&ee.LEN,gb.operation.var1Type.value=$._UBYTE;break;case me.addr:const r=gb.vars.gbasVarLoBase.address+gb.vars.lastVarIdx.value;gb.operation.var1Value.value=r,gb.operation.var1Type.value=$._UWORD;break;case me.word:gb.operation.var1Type.value=$._UWORD;break;case me.byte:gb.operation.var1Value.hi=0,gb.operation.var1Type.value=$._UBYTE;break;case me.lo:gb.operation.var1Value.hi=0,gb.operation.var1Type.value=$._UBYTE;break;case me.hi:gb.operation.var1Value.lo=gb.operation.var1Value.hi,gb.operation.var1Value.hi=0,gb.operation.var1Type.value=$._UBYTE;break;default:return gb.A.value=128,gb.A}return gb.A=0,gb.A}useOnDstRef(e){switch(gb.A.value){case me.lo:gb.vars.varTargetMaskType.value=ur.LO;break;case me.hi:gb.vars.varTargetMaskType.value=ur.HI;break}}}Os([b({input:"A",output:"A"})],_r.prototype,"useOnVar1");Os([b({input:"A"})],_r.prototype,"useOnDstRef");class Rn extends k{initVars(){const e={};gb._gvar.createVars("sysv",e,this)}read(){switch(gb.A=gb.token.readByte(),gb.X=0,gb.Y=0,gb.A.asByte()){case ie.pcnt:break;case ie.param:break;case ie.rega:break;case ie.regx:break;case ie.regy:break;case ie.regp:break;case ie.time:gb.A=gb.time.jiffLo.asByte(),gb.X=gb.time.jiffMid.asByte();break;case ie.timehi:gb.A=gb.time.jiffHi.asByte();break;case ie.scrx:gb.A=gb.gscr.screenX.asByte();break;case ie.scry:gb.A=gb.gscr.screenY.asByte();break;case ie.raster:gb.A=0,gb.X=0;break}return gb.expr.pushValue(gb.A,gb.X,gb.Y),[gb.A,gb.X,gb.Y]}}var Nn=Object.defineProperty,Vn=Object.getOwnPropertyDescriptor,Pn=(t,e,r,a)=>{for(var s=Vn(e,r),i=t.length-1,n;i>=0;i--)(n=t[i])&&(s=n(e,r,s)||s);return s&&Nn(e,r,s),s};class Bs extends k{postfixCount;initVars(){const e={postfixCount:[c,"vars"]};gb._gvar.createVars("cvar",e,this)}readValue(){for(this.postfixCount.value=0;;){if(this.postfixCount.inc(),this.postfixCount.value>5&&gb.error.tooComplexError("More than 5 postfixes!"),gb.A=gb.token.readByte(),gb.A=gb.token.lastReadValue.value,gb.A.N){gb.token.decPtr();return}if(gb.A.value>=48&&gb.A.value<=57&&(gb.A.dec(48),gb.error.notImplementedError("Indexing not implemented")),gb.A=gb.postops.useOnVar1(gb.A),gb.A.N){gb.token.decPtr();return}}}readReference(){for(gb.A=gb.token.readByte(),gb.vars.readRef(gb.A),this.postfixCount.value=0;;){if(this.postfixCount.inc(),this.postfixCount.value>5&&gb.error.tooComplexError("More than 5 postfixes!"),gb.A=gb.token.readByte(),gb.A.N){gb.token.decPtr();return}if(gb.A.value>=48&&gb.A.value<=57){gb.A.dec(48),this.applyByteIndex(gb.A);continue}gb.postops.useOnDstRef(gb.A)}}applyByteIndex(e){gb.vars.lastType.bitTest(ee.STR),gb.vars.lastType.bitTest(ee.ARR),gb.error.invalidType("Index can be applied on an array or a string!")}}Pn([b({input:"A"})],Bs.prototype,"applyByteIndex");var Fn=Object.defineProperty,Mn=Object.getOwnPropertyDescriptor,vt=(t,e,r,a)=>{for(var s=Mn(e,r),i=t.length-1,n;i>=0;i--)(n=t[i])&&(s=n(e,r,s)||s);return s&&Fn(e,r,s),s};class st extends k{attribs;lastCommand;subCommand;cmdArgCount;funcArgCount;readFromPLABank;isCommandFinished;isCurrentArgumentFinished;lastSeparator;svarTargetIdx;svarCurrentIdx;constructor(){super()}NO_COMPILE=["initVars"];initVars(){const e={attribs:[c,"vars"],subCommand:[c,"vars"],lastCommand:[c,"vars"],lastReadType:[c,"vars"],lastSeparator:[c,"vars"],isCommandFinished:[c,"vars"],cmdArgCount:[c,"vars"],funcArgCount:[c,"vars"],isCurrentArgumentFinished:[c,"vars"],svarTargetIdx:[c,"vars"],svarCurrentIdx:[c,"vars"],readFromPLABank:[c,"vars"]};gb._gvar.createVars("eval",e,this)}before(){gb.eval.lastCommand.value=gb.token.lastReadValue.value,gb.eval.attribs.value=gb.token.getType().value,gb.func.reset(),gb.eval.commandPreEval()}commandPreEval(){this.isCommandFinished.value=0,gb.token.variableMode.value=We.cvarRead;const e=this.attribs.value;e&se.SUB_COMMAND&&this.readSubCommand(),e&se.EVAL_SINGLE&&this.evalSingle(),e&se.EVAL_ALL&&this.evalAll()}readSubCommand(){gb.A=gb.token.readByte(),this.subCommand.value=gb.A.value}setSemicolonFlag(){}getNextSVarIdx(){if(gb.eval.svarCurrentIdx.value<gb.eval.svarTargetIdx.value)return e();if(gb.A=gb.eval.isFinishedPreCheck(),gb.A.value)return gb.A.value=255,gb.vars.lastVarIdx.value=gb.A.value,gb.A;function e(){return gb.A=gb.eval.svarCurrentIdx.value,gb.A.inc(3),gb.eval.svarCurrentIdx.value=gb.A.value,gb.vars.lastVarIdx.value=gb.A.value,gb.A}return gb.A=gb.token.readByte(),gb.A.value==f("-")?(gb.A=gb.token.readByte(),gb.A=gb.vars.convertScreenToVarOffset(gb.A),gb.eval.svarTargetIdx.value=gb.A.value,e()):(gb.A=gb.vars.convertScreenToVarOffset(gb.A),gb.eval.svarTargetIdx.value=gb.A.value,gb.eval.svarCurrentIdx.value=gb.A.value,gb.vars.lastVarIdx.value=gb.A.value,gb.A)}getNextSVarRef(){gb.A=this.getNextSVarIdx()}initSVarList(){gb.eval.svarCurrentIdx.value=253,gb.eval.svarTargetIdx.value=253,gb.token.variableMode.value=We.svarList}evalSingle(){gb.expr.resetIndexes(),gb.expr.readOne(),gb.expr.copyLastValueToVar1()}evalAll(){gb.expr.resetIndexes(),gb.token.lastReadValue.value=0;do gb.expr.readOne();while(gb.token.tokenType.value!=255);gb._logger.debug(`Parameters: ${JSON.stringify(gb.expr.getArrayValues().values)}`)}isNumeric(){return gb.X=gb.token.lastReadValue,gb.X.value>=f("0")&&gb.X.value<=f("9")?!0:(gb.A.value=et[gb.X.value-128],(gb.operation.var1Type.type&qe.NUM)>0)}isCommand(e){return(et[e-128]&se.COMMAND)>0}checkFinishToken(e){return gb.X.value==f(":")||gb.X.N&&(et[gb.X.value-128]&se.COMMAND)>0?255:0}isFinishedPreCheck(){return gb.mem.basEnd.value>gb.token.currBasPtr.value+1?(gb.A=gb.token.preReadByte(),gb.X=gb.A,gb.A=this.checkFinishToken(gb.X),gb.eval.isCommandFinished.value=gb.A.value,gb.A):(gb.A=255,gb.A)}isFinishedPostCheck(){return gb.mem.basEnd.value<=gb.token.currBasPtr.value?255:(gb.X=gb.token.lastReadValue.value,gb.A=this.checkFinishToken(gb.X),gb.eval.isCommandFinished.value=gb.A.value,gb.A.value)}isArgumentFinishedPreCheck(){return gb.mem.basEnd.value<=gb.token.currBasPtr.value+1?255:(gb.A=gb.token.preReadByte(),gb.A.value==f(",")||gb.A.value==f(";")?(gb.A=255,gb.A.value):(gb.X=gb.A,gb.A=this.checkFinishToken(gb.X),gb.eval.isCurrentArgumentFinished.value=gb.A.value,gb.A.value))}thisCommand(){return!1}}vt([b({output:"A"})],st.prototype,"getNextSVarIdx");vt([b({input:"X"})],st.prototype,"checkFinishToken");vt([b({output:"A",save:"X"})],st.prototype,"isFinishedPreCheck");vt([b({output:"A",save:"X"})],st.prototype,"isFinishedPostCheck");vt([b({output:"A",save:"X"})],st.prototype,"isArgumentFinishedPreCheck");var Ln=Object.defineProperty,Qn=Object.getOwnPropertyDescriptor,ue=(t,e,r,a)=>{for(var s=Qn(e,r),i=t.length-1,n;i>=0;i--)(n=t[i])&&(s=n(e,r,s)||s);return s&&Ln(e,r,s),s};class ae extends k{operatorArray;valueArray;valueArrayType;valueArrayLo;valueArrayHi;operatorIndex;valueIndex;currentPrec;lastType;valueAdded;lastTokenType;initVars(){const e={operatorArray:[L,52736,32],valueArray:[L,52768,96],"!valueArrayType":[c,52768],"!valueArrayLo":[c,52769],"!valueArrayHi":[c,52770],operatorIndex:[c,"vars"],valueIndex:[c,"vars"],valueAdded:[c,"vars"],currentPrec:[c,"vars"],"!lastType":[c,"=currentPrec"],lastTokenType:[c,"vars"]};gb._gvar.createVars("expr",e,this)}pushValueEval(e){switch(gb.Y=e,gb.X.value=0,e.value&qe.LEN){case qe.LEN1:gb.A=gb.token.readByte();break;case qe.LEN2:gb.A=gb.token.readByte(),gb.save("A"),gb.A=gb.token.readByte(),gb.X=gb.A,gb.restore("A");break;default:gb.token.readByte(),gb.A=gb.token.currBasPtr.lo,gb.X=gb.token.currBasPtr.hi;break}this.pushValue(gb.A,gb.X,gb.Y)}readOneOld(){for(gb.token.lastReadValue.value=0,this.resetVar1();;){if(gb.A=gb.eval.isArgumentFinishedPreCheck(),gb.A.N){if(gb.token.lastReadValue.value==f(",")&&gb.operation.var1Type.value==T._NONE&&(gb.operation.var1Type.value=T._UBYTE),this.storeVar1InValueArray(),this.lastType.value=gb.operation.var1Type.value,this.resetVar1(),gb.A=gb.token.readNext(),gb.A.value==F.COLON){gb.token.lastReadValue.value==f(";")&&this.lastType.value!=T._NONE&&this.storeVar1InValueArray(),gb.eval.isFinishedPreCheck()&&(gb.operation.var1Type.value=T._UBYTE,this.storeVar1InValueArray());return}return}gb.token.readNext()}}errIfValue(){this.lastTokenType.value==F.VALUE&&gb.error.syntaxError(`Value after value: '${gb.token.lastReadValue.value.toHex2()}'`)}expectValue(){this.lastTokenType.value!=F.VALUE&&gb.error.syntaxError("Expected value!")}readOne(){for(gb.eval.isCurrentArgumentFinished.value=0,this.lastType.value=0,this.resetVar1(),this.valueAdded.value=0,this.lastTokenType.value=F.OPERATOR;gb.eval.isCurrentArgumentFinished.Z;)switch(gb.A=gb.token.readNext(),gb.A.value){case F.VALUE:this.errIfValue(),gb.expr.storeVar1InValueArray(),this.valueAdded.value=255,this.lastTokenType.value=F.VALUE;break;case F.FUNCTION:this.errIfValue(),gb.A=gb.token.lastReadValue.value,gb.func.execute(gb.A),this.lastTokenType.value=F.VALUE;break;case F.OPERATOR:this.expectValue();const e=gb.token.lastReadProps.value;if(gb.X=gb.expr.operatorIndex.value,gb.X.value>0)for(;gb.Y=gb.expr.operatorIndex.value,!(gb.Y.Z||(gb.X=gb.expr.operatorArray.getOfsValue(gb.Y.value-1),!gb.X.N&&gb.X.value==f("("))||(gb.A=et[gb.X.value-128],(gb.A.value&se.MASK_LONG)!=se.OPERATOR));)if(gb.A.value>=e)this.applyOperation();else break;gb.A=gb.token.lastReadValue.value,gb.expr.storeAccInOpArray(gb.A),this.lastTokenType.value=F.OPERATOR;break;case F.OPEN_BRACKET:gb.A=gb.token.lastReadValue.value,gb.expr.storeAccInOpArray(gb.A),this.lastTokenType.value=F.OPERATOR;break;case F.CLOSE_BRACKET:for(this.expectValue();gb.Y=gb.expr.operatorIndex.value,!gb.Y.Z;){if(gb.A=gb.expr.operatorArray.getOfsValue(gb.Y.value-1),gb.A.value==f("(")){gb.A=this.popOperator();break}this.applyOperation()}this.lastTokenType.value=F.VALUE;break;case F.FINISHED:for(;gb.expr.operatorIndex.value>0;)this.applyOperation();if(gb.token.lastReadValue.value==f(";"))return;gb.token.lastReadValue.value==f(",")&&(gb.operation.var1Type.value=T._UBYTE,this.storeVar1InValueArray()),gb.eval.isCurrentArgumentFinished.value=255;break;case F.COLON:if(gb.expr.operatorIndex.value>0)for(;gb.expr.operatorIndex.value>0;)this.applyOperation();gb.token.lastReadValue.value==f(";")?this.handleSemiColon():gb.token.lastReadValue.value==f(",")&&this.valueAdded.Z&&(gb.operation.var1Type.value=T._UBYTE,this.storeVar1InValueArray()),gb.eval.isCurrentArgumentFinished.value=255;break;default:gb.error.notImplementedError("readone")}gb.expr.valueIndex.value&&gb.eval.cmdArgCount.inc()}handleSemiColon(){this.valueAdded.Z||gb.eval.cmdArgCount.inc(),this.resetVar1(),this.storeVar1InValueArray()}applyOperation(){this.popValueToVar2(),this.popValueToVar1(),gb.A=this.popOperator();const e=Cs[gb.A.value];let r=`${gb.operation.var1Value.value} ${e} ${gb.operation.var2Value.value}`;gb.operation.apply(gb.A),this.storeVar1InValueArray(),r+=`= ${gb.operation.var1Value.value}`,gb._logger.debug(r)}storeAccInOpArray(e){gb.X=gb.expr.operatorIndex.value,gb.expr.operatorArray.setOfsValue(gb.X.value,gb.A.value),gb.expr.operatorIndex.inc()}resetVar1(){gb.operation.var1Value.value=0,gb.operation.var1Type.value=T._NONE}reduceValueIndex(){gb.Y=gb.expr.valueIndex.value-3,gb.expr.valueIndex.value=gb.Y.value}popValueToVar1(){gb.Y=gb.expr.valueIndex.value-3,gb.expr.valueIndex.value=gb.Y.value,gb.operation.var1Value.lo=gb.expr.valueArrayLo.getOfsValue(gb.Y.value),gb.operation.var1Value.hi=gb.expr.valueArrayHi.getOfsValue(gb.Y.value),gb.operation.var1Type.value=gb.expr.valueArrayType.getOfsValue(gb.Y.value)}popValueToVar2(){gb.Y=gb.expr.valueIndex.value-3,gb.expr.valueIndex.value=gb.Y.value,gb.operation.var2Value.lo=gb.expr.valueArrayLo.getOfsValue(gb.Y.value),gb.operation.var2Value.hi=gb.expr.valueArrayHi.getOfsValue(gb.Y.value),gb.operation.var2Type.value=gb.expr.valueArrayType.getOfsValue(gb.Y.value)}storeVar1InValueArray(){gb.X=gb.expr.valueIndex.value,gb.expr.valueArrayType.setOfsValue(gb.X.value,gb.operation.var1Type.value),gb.expr.valueArrayLo.setOfsValue(gb.X.value,gb.operation.var1Lo.value),gb.expr.valueArrayHi.setOfsValue(gb.X.value,gb.operation.var1Hi.value),gb.X.inc(3),gb.expr.valueIndex.value=gb.X.value,this.lastType.value=gb.operation.var1Type.value}initStack(){}pushValue(e,r,a){gb.exec.tempY.value=gb.Y.value,gb.Y=gb.expr.valueIndex,gb.expr.valueArrayLo.setOfsValue(gb.Y.value,gb.A.value),gb.expr.valueArrayHi.setOfsValue(gb.Y.value,gb.X.value),gb.A=gb.exec.tempY.value,gb.expr.valueArrayType.setOfsValue(gb.Y.value,gb.A.value),gb.expr.valueIndex.inc(3)}copyLastValueToVar1(){gb.save("AY"),gb.Y=gb.expr.valueIndex.value,gb.operation.var1Value.lo=gb.expr.valueArrayLo.getOfsValue(gb.Y.value-3),gb.operation.var1Value.hi=gb.expr.valueArrayHi.getOfsValue(gb.Y.value-3),gb.operation.var1Type.value=gb.expr.valueArrayType.getOfsValue(gb.Y.value-3),gb.restore("AY")}pushOperator(e){gb.X=gb.expr.operatorIndex,gb.expr.operatorArray.setOfsValue(gb.X.value,e.value),gb.expr.operatorIndex.inc()}popOperator(){return gb.expr.operatorIndex.dec(),gb.X=gb.expr.operatorIndex,gb.A=gb.expr.operatorArray.getOfsValue(gb.X.value),gb.A}resetIndexes(){gb.expr.valueIndex.value=0,gb.expr.operatorIndex.value=0,gb.eval.cmdArgCount.value=0}getArrayValues(){const e=[],r=[];for(let a=0;a<gb.expr.valueIndex.value;a+=3){const s=gb.expr.valueArrayLo.getOfsValue(a)+gb.expr.valueArrayHi.getOfsValue(a)*256,i=gb.expr.valueArrayType.getOfsValue(a);e.push({value:s,type:i})}for(let a=0;a<gb.expr.operatorIndex.value;a++){const s=gb.expr.operatorArray.getOfsValue(a);r.push(s)}return{values:e,operators:r}}getArrayValuesAsString(){const{values:e,operators:r}=this.getArrayValues();let a=`Expression array values

Values:    `;return e.forEach(({value:s,type:i})=>{a+=`<${i}>${gb.hex(s,4,"$")}, `}),a+=`
Operators: `,r.forEach(s=>{a+=`<${s}>, `}),a}}ue([b({save:"XY"})],ae.prototype,"pushValueEval");ue([b({save:"AX"})],ae.prototype,"readOneOld");ue([b({save:"AX"})],ae.prototype,"readOne");ue([b({input:"A",save:"X"})],ae.prototype,"storeAccInOpArray");ue([b({})],ae.prototype,"resetVar1");ue([b({save:"AY"})],ae.prototype,"reduceValueIndex");ue([b({save:"AXY"})],ae.prototype,"popValueToVar1");ue([b({save:"AXY"})],ae.prototype,"popValueToVar2");ue([b({save:"AXY"})],ae.prototype,"storeVar1InValueArray");ue([b({tempProtect:!0,safeInput:"AXY"})],ae.prototype,"pushValue");ue([b({save:"X",output:"A"})],ae.prototype,"popOperator");var Yn=Object.defineProperty,Gn=Object.getOwnPropertyDescriptor,Ds=(t,e,r,a)=>{for(var s=Gn(e,r),i=t.length-1,n;i>=0;i--)(n=t[i])&&(s=n(e,r,s)||s);return s&&Yn(e,r,s),s};class vr extends k{activeFunctionIndex;functionIndexes;initVars(){const e={activeFunctionIndex:[c,"vars"],functionIndexes:[L,"vars",8]};gb._gvar.createVars("func",e,this)}execute(e){const[r,a,s,i,n,o]=Wt[gb.A.value];a(),gb.expr.reduceValueIndex(),gb.expr.storeVar1InValueArray()}evalAll(){gb.X=this.activeFunctionIndex.value,gb.A=gb.expr.valueIndex.value,this.functionIndexes.setOfsValue(gb.X.value,gb.A.value);do gb.expr.readOne();while(gb.token.tokenType.value!=255);this.activeFunctionIndex.inc(),this.activeFunctionIndex.value>7&&gb.error.tooComplexError("More than 8 nested functions")}getParam(...e){return gb.Y=this.activeFunctionIndex.value-1,gb.A=this.functionIndexes.getOfsValue(gb.Y.value),gb.X.mul(3),gb.X=gb.A.value+gb.X.value,gb.X.value}reset(){this.activeFunctionIndex.value=0}}Ds([b({input:"A"})],vr.prototype,"execute");Ds([b({input:"X",save:"AY",output:"X"})],vr.prototype,"getParam");var qn=Object.defineProperty,Un=Object.getOwnPropertyDescriptor,fe=(t,e,r,a)=>{for(var s=Un(e,r),i=t.length-1,n;i>=0;i--)(n=t[i])&&(s=n(e,r,s)||s);return s&&qn(e,r,s),s};class ce extends k{var1Type;var1Value;var1Lo;var1Hi;var2Type;var2Value;var2Lo;var2Hi;initVars(){const e={var1Type:[c,"zp"],var1Value:[w,"zp"],"!var1Lo":[c,"=var1Value"],"!var1Hi":[c,"+var1Value"],var2Type:[c,"zp"],var2Value:[w,"zp"],"!var2Lo":[c,"=var2Value"],"!var2Hi":[c,"+var2Value"]};gb._gvar.createVars("expr",e,this)}absByte(){return gb.A=0,this.var1Lo.N&&(this.var1Lo.value=this.var1Lo.value^255,this.var1Lo.inc()),gb.A}absWord(){return gb.A=0,this.var1Hi.N&&(this.var1Lo.value=this.var1Lo.value^255,this.var1Hi.value=this.var1Hi.value^255,this.var1Value.inc(),gb.A=128),gb.A}abs(){return gb.A=this.getVar1Type(),gb.A.value==T._SBYTE?this.absByte():gb.A.value==T._SWORD?this.absWord():(gb.error.invalidType(),gb.A)}getVar1Type(){return gb.A=this.var1Type.value&Gt.BASE_TYPE,gb.A}negate(){this.var1Value.value=(gb.operation.var1Value.value^65535)+1&65535}opAdd(){this.var1Value.value=this.var1Value.value+this.var2Value.value&65535}opSub(){this.var1Value.value=this.var1Value.value-this.var2Value.value&65535}opMul(){this.var1Value.value=this.var1Value.value*this.var2Value.value&65535}opDiv(){this.var1Value.value=this.var1Value.value/this.var2Value.value&65535}opAnd(){this.var1Value.value=this.var1Value.value&this.var2Value.value&65535}opGr(){this.var1Value.value=this.var1Value.value>this.var2Value.value?65535:0}opLe(){this.var1Value.value=this.var1Value.value<this.var2Value.value?65535:0}opNEq(){this.var1Value.value=this.var1Value.value!=this.var2Value.value?65535:0}opEq(){this.var1Value.value=this.var1Value.value==this.var2Value.value?65535:0}opFullXor(){this.var1Value.value=(this.var1Value.value^65535)&65535}apply(e){switch(gb.A.value){case _["+"]:return this.opAdd();case _["-"]:return this.opSub();case _["*"]:return this.opMul();case _["/"]:return this.opDiv();case _["&"]:return this.opAnd();case _[">"]:return this.opGr();case _["<"]:return this.opLe();case _["!="]:return this.opNEq();case _["="]:return this.opEq();default:gb.error.notImplementedError(`operation '${gb.A.asChar}' not implemented`)}}}fe([b({output:"A"})],ce.prototype,"absByte");fe([b({output:"A"})],ce.prototype,"absWord");fe([b({output:"A"})],ce.prototype,"abs");fe([b({output:"A"})],ce.prototype,"getVar1Type");fe([b({})],ce.prototype,"negate");fe([b({})],ce.prototype,"opAdd");fe([b({})],ce.prototype,"opSub");fe([b({})],ce.prototype,"opMul");fe([b({})],ce.prototype,"opDiv");fe([b({input:"A"})],ce.prototype,"apply");class Wn extends k{readValue(){gb.A=gb.token.readByte(),gb.vars.setVar1FromScrCode(gb.A)}readReference(){gb.A=gb.token.readByte(),gb.vars.readRef(gb.A)}}var Kn=Object.defineProperty,Zn=Object.getOwnPropertyDescriptor,Es=(t,e,r,a)=>{for(var s=Zn(e,r),i=t.length-1,n;i>=0;i--)(n=t[i])&&(s=n(e,r,s)||s);return s&&Kn(e,r,s),s};class xr extends k{argumentsLeft;argumentOffset;initVars(){const e={argumentsLeft:[c,"temp"],argumentOffset:[c,"temp"]};gb._gvar.createVars("cmdDefCall",e,this)}init(){this.initVals({})}runDef(){return gb.AY=gb.token.readWord(),gb.token.currBasPtr.value=gb.AY,10}runCall(){gb.exstack.pushVal({A:X.call}),gb.A=gb.token.readByte(),gb.A=gb.vars.convertScreenToVarIndex(gb.A),gb.X=gb.A.value*2;const e=gb.gcall.defArray.getOfsWord(gb.X.value)+3;return gb.eval.cmdArgCount.value=0,this.argumentOffset.value=0,gb.A=gb.token.preReadByte(),gb.A.value==f(",")&&(gb.A=gb.token.readByte(),gb.eval.evalAll()),gb.AY=gb.token.currBasPtr.value,gb.exstack.pushWord(gb.A,gb.Y),gb.token.currBasPtr.value=e,gb.A.value=gb.eval.cmdArgCount.value,this.argumentsLeft.value=gb.A.value,gb.cmdDefCall.setArguments(gb.A),gb.exstack.close(),10}setArguments(e){for(;;){if(gb.A=gb.token.preReadByte(),gb.A.value==f(",")){gb.A=gb.token.readByte();continue}if(gb.A.N)break;if(this.argumentsLeft.value==0){gb.A=gb.token.readByte();continue}gb.svar.readReference(),gb.vars.varTargetRef.value=gb.vars.lastRef.value,gb.Y=this.argumentOffset.value,gb.operation.var1Type.value=gb.expr.valueArrayType.getOfsValue(gb.Y.value),gb.operation.var1Type.value!=$._NONE&&(gb.vars.varTargetRef.setOfsValue(0,gb.expr.valueArrayLo.getOfsValue(gb.Y.value)),gb.vars.varTargetRef.setOfsValue(1,gb.expr.valueArrayHi.getOfsValue(gb.Y.value))),this.argumentOffset.inc(3),this.argumentsLeft.dec()}this.argumentsLeft.value>0&&gb.error.invalidParameters(`Too many arguments: ${this.argumentsLeft.value} values more!`)}runDend(){return gb.X=gb.exstack.getPointerWithAssert({A:X.call}),gb.token.currBasPtr.value=gb.exstack.execStackDataArray.getOfsWord(gb.X.value+1),gb.exstack.removeLast(),10}}Es([b({tempProtect:!0})],xr.prototype,"runDef");Es([b({input:"A"})],xr.prototype,"setArguments");var Hn=Object.defineProperty,Xn=Object.getOwnPropertyDescriptor,$n=(t,e,r,a)=>{for(var s=Xn(e,r),i=t.length-1,n;i>=0;i--)(n=t[i])&&(s=n(e,r,s)||s);return s&&Hn(e,r,s),s};class Rs extends k{dstType;initVars(){const e={dstType:[c,"temp"]};gb._gvar.createVars("cmdDecInc",e,this)}init(){this.initVals({})}run(){this.dstType.value=T._SWORD,gb.A=gb.token.preReadByte(),gb.A.value==f(",")||gb.A.value==f(";")?(gb.A.value==f(",")&&(this.dstType.value=T._SBYTE),gb.eval.evalAll(),gb.mem.destPtr.lo=gb.expr.valueArrayLo.getOfsValue(3),gb.mem.destPtr.hi=gb.expr.valueArrayHi.getOfsValue(3),gb.eval.cmdArgCount.value==3?gb.expr.copyLastValueToVar1():(gb.operation.var1Lo.value=1,gb.operation.var1Hi.value=0)):(gb.vars.readRefWithIdx(gb.A),gb.token.incPtr(),gb.mem.destPtr.value=gb.vars.lastRef.value,(gb.vars.lastType.value&ee.LEN)==ee.LEN1&&(this.dstType.value=T._SBYTE),gb.A=gb.token.preReadByte(),gb.A.value==f(",")?(gb.token.incPtr(),gb.eval.evalSingle(),gb.expr.copyLastValueToVar1()):(gb.operation.var1Lo.value=1,gb.operation.var1Hi.value=0)),gb.eval.lastCommand.value==_.dec&&gb.operation.negate();const r=gb.mem.destPtr.getOfsValue(0)+gb.mem.destPtr.getOfsValue(1)*256+gb.operation.var1Value.value;return gb.mem.destPtr.setOfsValue(0,r&255),this.dstType.value==T._SWORD&&gb.mem.destPtr.setOfsValue(1,r>>8&255),20}}$n([b({tempProtect:!0})],Rs.prototype,"run");var jn=Object.defineProperty,zn=Object.getOwnPropertyDescriptor,xt=(t,e,r,a)=>{for(var s=zn(e,r),i=t.length-1,n;i>=0;i--)(n=t[i])&&(s=n(e,r,s)||s);return s&&jn(e,r,s),s};class at extends k{arrayLength;stringLength;isLiteral;targetTypeCode;initVars(){const e={arrayLength:[w,"temp"],stringLength:[c,"temp"],isLiteral:[c,"temp"],targetTypeCode:[c,"temp"]};gb._gvar.createVars("cmdDim",e,this)}init(){this.initVals({})}run(){return gb.AY=gb.token.readWord(),gb.token.currBasPtr.value=gb.AY,20}performMemorySetup(){}convertShortCodeToType(e){switch(gb.A.value){case f(ut.UBYTE):gb.A.value=ct.UBYTE;break;case f(ut.SBYTE):gb.A.value=ct.SBYTE;break;case f(ut.SWORD):gb.A.value=ct.SWORD;break;case f(ut.UWORD):gb.A.value=ct.SWORD;break;case f(ut.FIXSTR):gb.A.value=ct.FIXSTR;break;default:gb.error.notImplementedError(`Type not implemented: ${gb.A.value.toHex2()}`)}return gb.A}readType(){gb.A=gb.token.readByte(),gb.A=this.convertShortCodeToType(gb.A),this.targetTypeCode.value=gb.A.value,gb.A.value==F.VALUE&&(gb.error.notImplementedError("Arrays or string lengths not implemented yet"),gb.A=gb.token.readNext()),this.arrayLength.value=0,this.stringLength.value=0,this.isLiteral.value=255}setDimByOffset(e){this.isLiteral.Z&&gb.error.notImplementedError("Arrays or string lengths not implemented yet"),gb.A=this.targetTypeCode.value,gb.vars.gbasVarTypeBase.setOfsValue(gb.X.value,gb.A.value)}initDims(){for(this.performMemorySetup(),gb.pushVariables([gb.token.variableMode]),gb.token.variableMode.value=We.svarList,this.readType(),gb.eval.initSVarList();;){gb.A=gb.token.readNext();do gb.X=gb.vars.lastVarIdx,gb._logger.debug(`Variable with idx ${gb.X.value} - type set to $${this.targetTypeCode.value.toHex2()}.`),this.setDimByOffset(gb.X),gb.A=gb.eval.getNextSVarIdx();while(gb.A.value<253);if(gb.A=gb.token.readNext(),gb.A.value==F.FINISHED)break;gb.A.value==F.COLON?this.readType():gb.error.syntaxError(`Syntax error in dim: $${gb.token.lastReadValue.value.toHex2()} `)}gb.popVariables([gb.token.variableMode])}}xt([b({tempProtect:!0})],at.prototype,"run");xt([b({input:"A",output:"A"})],at.prototype,"convertShortCodeToType");xt([b({save:"A"})],at.prototype,"readType");xt([b({save:"A",safeInput:"X"})],at.prototype,"setDimByOffset");xt([b({tempProtect:!0})],at.prototype,"initDims");var Jn=Object.defineProperty,eo=Object.getOwnPropertyDescriptor,to=(t,e,r,a)=>{for(var s=eo(e,r),i=t.length-1,n;i>=0;i--)(n=t[i])&&(s=n(e,r,s)||s);return s&&Jn(e,r,s),s};class Ns extends k{isUntil;initVars(){const e={isUntil:[c,"temp"]};gb._gvar.createVars("cmdDoLoop",e,this)}init(){this.initVals({})}runDo(){return gb.exstack.pushVal({A:X.do}),gb.AY=gb.token.currBasPtr.value+2,gb.exstack.pushWord(gb.A,gb.Y),gb.AY=gb.token.readWord(),gb.exstack.pushWord(gb.A,gb.Y),this.doEval(),10}doEval(){switch(this.isUntil.value=0,gb.A=gb.token.preReadByte(),gb.A.value){case _.while:break;case _.until:this.isUntil.dec();break;default:return 10}gb.A=gb.token.readByte(),gb.eval.evalSingle(),this.isUntil.Z||gb.operation.opFullXor(),gb.operation.var1Value.value==0&&this.jumpBlockEnd()}runWhile(){return gb.operation.var1Value.value!=0&&this.jumpBlockStart(),10}runUntil(){return gb.operation.var1Value.value==0&&this.jumpBlockStart(),10}runLoop(){return this.jumpBlockStart(),this.doEval(),10}jumpBlockEnd(){return gb.X=gb.exstack.getPointerWithAssert({A:X.do}),gb.token.currBasPtr.value=gb.exstack.execStackDataArray.getOfsWord(gb.X.value+3),gb.exstack.removeLast(),10}jumpBlockStart(){return gb.X=gb.exstack.getPointerWithAssert({A:X.do}),gb.token.currBasPtr.value=gb.exstack.execStackDataArray.getOfsWord(gb.X.value+1),10}}to([b({tempProtect:!0})],Ns.prototype,"runDo");var ro=Object.defineProperty,so=Object.getOwnPropertyDescriptor,ao=(t,e,r,a)=>{for(var s=so(e,r),i=t.length-1,n;i>=0;i--)(n=t[i])&&(s=n(e,r,s)||s);return s&&ro(e,r,s),s};class Vs extends k{defStringLen;defStringIdx;actualCode;srcBaseHi;dstBaseHi;copyLeft;copyIdx;initVars(){const e={defStringLen:[c,"temp"],defStringIdx:[c,"temp"],actualCode:[c,"temp"],srcBaseHi:[c,"vars"],dstBaseHi:[c,"vars"],copyLeft:[c,"vars"],copyIdx:[c,"vars"]};gb._gvar.createVars("cmdFont",e,this)}init(){const e={dstBaseHi:208,srcBaseHi:208};this.initVals(e)}run(){return gb.A=gb.eval.subCommand,gb.A.value==_.DQUOTE||gb.A.value==_.SQUOTE?(this.defineFontFromString(),10):(gb.error.notImplementedError("Font subcommand not implemented yet"),0)}defineFontFromString(){for(this.defStringLen.value=gb.token.readByte().value-1,this.defStringIdx.value=0;this.defStringIdx.value<this.defStringLen.value;)switch(gb.A=gb.token.readByte(),this.defStringIdx.inc(),this.actualCode.value=gb.A.value,gb.mem.srcPtr.value=gb.token.currBasPtr.value,this.actualCode.value){case y.font_set_source0_target0:this.setSourceAndTarget(208,208);break;case y.font_set_source0_target1:this.setSourceAndTarget(208,216);break;case y.font_set_source1_target0:this.setSourceAndTarget(216,208);break;case y.font_set_source1_target1:this.setSourceAndTarget(208,208);break;case y.font_set_source_rom_target0:this.setSourceAndTarget(0,208);break;case y.font_set_source_rom_target1:this.setSourceAndTarget(0,216);break;case y.font_def_uncompressed_multi:gb.A=gb.token.readByte(),this.defineMulti(gb.A.value);break;case y.font_def_uncompressed_1:case y.font_def_uncompressed_2:case y.font_def_uncompressed_3:case y.font_def_uncompressed_4:case y.font_def_uncompressed_5:case y.font_def_uncompressed_6:case y.font_def_uncompressed_7:gb.A.value=this.actualCode.value-y.font_def_uncompressed_1+1,this.defineMulti(gb.A.value);break;case y.font_copy_full:case y.font_copy_lo:case y.font_copy_hi:case y.font_copy_range_same_index:case y.font_copy_range:case y.font_create_2x1:case y.font_create_2x2:case y.font_map_4x4_from:case y.font_map_4x4_full:case y.font_map_4x8_default:case y.font_map_4x8_full:case y.font_map_8x4_default:case y.font_map_8x4_full:case y.font_set_8x8_fill:case y.font_use_1x1:case y.font_use_2x1:case y.font_use_2x2:case y.font_use_4x4:case y.font_use_4x8:case y.font_use_8x4:case y.font_use_8x8:case y.font_invert_all:case y.font_invert_range:case y.font_create_from_spr_3x3:case y.font_create_from_spr_3x2:case y.font_create_from_spr_2x3:case y.font_create_from_spr_2x2:gb.error.notImplementedError("Font control code not implemented yet")}}setSourceAndTarget(e,r){this.srcBaseHi.value=e,this.dstBaseHi.value=r}defineMulti(e){for(this.copyLeft.value=e*8,this.copyIdx.value=0,gb.mem.destPtr.value=this.dstBaseHi.value*256,gb.A=gb.token.readByte(),gb.mem.destPtr.inc16(gb.A.value*8);this.copyLeft.value>0;)this.copyLeft.dec(),gb.A=gb.token.readByte(),gb.X.value=this.copyIdx.value,gb.mem.destPtr.setOfsValue(gb.X.value,gb.A.value),this.defStringIdx.inc(),this.copyIdx.inc()}}ao([b({tempProtect:!0})],Vs.prototype,"run");var io=Object.defineProperty,no=Object.getOwnPropertyDescriptor,Ps=(t,e,r,a)=>{for(var s=no(e,r),i=t.length-1,n;i>=0;i--)(n=t[i])&&(s=n(e,r,s)||s);return s&&io(e,r,s),s};class yr extends k{forSettings;nextAddress;storeAddress;repeatCount;repeatVarPointerArrLo=[181,184,103,106];initVars(){const e={forSettings:[c,"vars"],nextAddress:[w,"temp"],storeAddress:[w,"temp"],repeatCount:[c,"vars"]};gb._gvar.createVars("cmdFor",e,this)}init(){const e={forSettings:49,repeatCount:0};this.initVals(e)}runFor(){return gb.exstack.pushVal({A:X.for}),this.storeInExecStack({A:128}),10}runRepeat(){return gb.exstack.pushVal({A:X.repeat}),this.storeInExecStack({A:0}),10}addRefCounter(){if(gb.eval.lastCommand.value==_.for)gb.vars.initRef(),gb.cvar.readReference(),gb.AY=gb.vars.lastRef.value;else{const e=(this.forSettings.value&12)>>2;gb.A=this.repeatVarPointerArrLo[e+this.repeatCount.value&3],this.repeatCount.inc(),this.repeatCount.value>4&&gb.error.tooComplexError("Too many nested REPEATs"),gb.Y=gb.vars.gbasVarLoBase.addressHi}this.storeAddress.value=gb.AY,gb.exstack.pushWord(gb.A,gb.Y)}setCounterValue(){this.forSettings.N?(gb.A=gb.token.readByte(),gb.A.value==_.assignValue?(gb.eval.evalSingle(),gb.AY=gb.operation.var1Value.value):(this.forSettings.value&16)!=0&&(gb.expr.resetVar1(),(this.forSettings.value&64)!=0&&(gb.operation.var1Lo.value=1)),gb.token.decPtr()):(gb.expr.resetVar1(),(this.forSettings.value&1)!=0&&(gb.operation.var1Lo.value=1)),gb.mem.destPtr.value=this.storeAddress.value,gb.mem.destPtr.setOfsValue(0,gb.operation.var1Value.lo),gb.mem.destPtr.setOfsValue(1,gb.operation.var1Value.hi)}addValueTo(){this.forSettings.N&&(gb.token.lastReadValue.value!=_.to&&gb.error.syntaxError("TO token expected"),gb.A=gb.token.readByte()),gb.eval.evalSingle(),(this.forSettings.bitTest(160)||this.forSettings.bitTest(2))&&gb.operation.var1Value.dec(),gb.AY=gb.operation.var1Value.value,gb.exstack.pushWord(gb.A,gb.Y)}addValueStep(){this.forSettings.N&&gb.token.lastReadValue.value==_.step?gb.eval.evalSingle():gb.operation.var1Value.value=1,gb.AY=gb.operation.var1Value.value,gb.exstack.pushWord(gb.A,gb.Y)}storeInExecStack(e){gb.A.N?this.forSettings.value|=128:this.forSettings.value&=127,this.nextAddress.value=gb.token.readWord(),this.addRefCounter(),this.setCounterValue(),this.addValueTo(),gb.mem.srcPtr.value=this.storeAddress.value,gb.operation.var2Value.value=gb.mem.srcPtr.getOfsValue(0)+gb.mem.srcPtr.getOfsValue(1)*256,gb.operation.var2Value.value>gb.operation.var1Value.value&&gb.error.notImplementedError("Jumpover not implemented for FOR/REPEAT!"),this.addValueStep(),gb.AY=gb.token.currBasPtr.value,gb.exstack.pushWord(gb.A,gb.Y),gb.exstack.close()}next(){if(gb.X=gb.exstack.execStackIndex,gb.X.Z)return gb.error.invalidNext("Next without FOR or REPEAT"),10;if(gb.X.value>=1?(gb.A=gb.exstack.execStackIndexArray.getOfsValue(gb.X.value-1),gb.X=gb.A):gb.X.value=0,gb.A=gb.exstack.execStackDataArray.getOfsValue(gb.X.value),gb.A.value==X.for)this.forSettings.value|=128;else if(gb.A.value==X.repeat)this.forSettings.value&=127;else return gb.error.invalidNext("Next without FOR or REPEAT"),10;return gb.mem.destPtr.value=gb.exstack.execStackDataArray.getOfsWord(gb.X.value+1),gb.operation.var1Value.value=gb.mem.destPtr.getOfsWord(0),gb.operation.var2Value.value=gb.exstack.execStackDataArray.getOfsWord(gb.X.value+5),gb.operation.opAdd(),gb.mem.destPtr.setOfsValue(0,gb.operation.var1Value.lo),gb.mem.destPtr.setOfsValue(1,gb.operation.var1Value.hi),gb.operation.var2Value.value=gb.exstack.execStackDataArray.getOfsWord(gb.X.value+3),gb.operation.var1Value.value>gb.operation.var2Value.value?(gb.A=gb.exstack.execStackDataArray.getOfsValue(gb.X.value),gb.A.value==X.repeat&&this.repeatCount.value--,gb.exstack.removeLast(),10):(gb.token.currBasPtr.value=gb.exstack.execStackDataArray.getOfsWord(gb.X.value+7),10)}}Ps([b({tempProtect:!0})],yr.prototype,"runFor");Ps([b({input:"A"})],yr.prototype,"storeInExecStack");var oo=Object.defineProperty,lo=Object.getOwnPropertyDescriptor,uo=(t,e,r,a)=>{for(var s=lo(e,r),i=t.length-1,n;i>=0;i--)(n=t[i])&&(s=n(e,r,s)||s);return s&&oo(e,r,s),s};class Fs extends k{method;initVars(){const e={method:[c,"vars"]};gb._gvar.createVars("cmdInkey",e,this)}init(){const e={method:8};this.initVals(e)}run(){if(this.method.lo&128&&gb.keyb.resetBuffer(),this.method.lo&4&&gb.keyb.wait(),(this.method.lo&3)==0){if(gb.A=gb.keyb.readFromBuffer(),this.method.lo&8)return gb.vars.setVarConst("K×",gb.A.value),10;gb.error.notImplementedError("Inkey: screencode, without set sysvars")}return gb.error.notImplementedError("Inkey"),10}}uo([b({tempProtect:!0})],Fs.prototype,"run");class co extends k{memByteCount;initVars(){const e={memByteCount:[w,"temp"]};gb._gvar.createVars("cmdMem",e,this)}init(){}runMemcopy(){for(gb.eval.cmdArgCount.value>3&&gb.error.notImplementedError("Banks not implemented for MEMCOPY!"),gb.mem.srcPtr.value=gb.expr.valueArrayLo.getOfsValue(0)+gb.expr.valueArrayLo.getOfsValue(1)*256,gb.mem.destPtr.value=gb.expr.valueArrayLo.getOfsValue(3)+gb.expr.valueArrayLo.getOfsValue(4)*256,this.memByteCount.value=gb.expr.valueArrayLo.getOfsValue(6)+gb.expr.valueArrayLo.getOfsValue(7)*256,gb.Y=0;this.memByteCount.value>0;)gb.A=gb.mem.srcPtr.getOfsValue(gb.Y.value),gb.mem.destPtr.setOfsValue(gb.Y.value,gb.A.value),gb.Y.inc(),gb.Y.Z&&(gb.mem.srcPtr.inc(256),gb.mem.destPtr.inc(256)),this.memByteCount.dec16();return 10}runMemset(){switch(gb.mem.destPtr.value=gb.expr.valueArrayLo.getOfsValue(0)+gb.expr.valueArrayLo.getOfsValue(1)*256,this.memByteCount.value=gb.expr.valueArrayLo.getOfsValue(6)+gb.expr.valueArrayLo.getOfsValue(7)*256,gb.A=gb.expr.valueArrayType.getOfsValue(3),gb.A.value){case T._UBYTE:case T._SBYTE:for(gb.A=gb.expr.valueArrayLo.getOfsValue(3),gb.Y=0;this.memByteCount.value>0;)gb.mem.destPtr.setOfsValue(gb.Y.value,gb.A.value),gb.Y.inc(),gb.Y.Z&&(gb.mem.srcPtr.inc(256),gb.mem.destPtr.inc(256)),this.memByteCount.dec16();break;case T._VARSTR:case T._FIXSTR:case T._UWORD:case T._SWORD:gb.error.notImplementedError("Type not implemented for MEMSET!")}return 10}}var go=Object.defineProperty,po=Object.getOwnPropertyDescriptor,Cr=(t,e,r,a)=>{for(var s=po(e,r),i=t.length-1,n;i>=0;i--)(n=t[i])&&(s=n(e,r,s)||s);return s&&go(e,r,s),s};class Kt extends k{baseSprAddr=49152;defStringLen;defStringIdx;actualModifierTS;actualCode;actionCode;actionModifier;selectionIsMulti;selectionPattern;selectionSingleValue;autoIncreaseMode;regT;ofsT;regS;ofsS;targetMaxOfs;settings;shadowX;shadowY;speedX;speedY;destX;destY;shadowShape;shadowColor;shadowEnabled;bitIteratorData16;maskAnd;maskOrXor;run(){switch(gb.A=gb.eval.subCommand.value,gb.AY=gb.vars.normalizeName(gb.A),this.actionCode.value=gb.A.value,this.actionModifier.value=gb.Y.value,gb.Y.value==cr.LOWER?(gb.eval.evalSingle(),this.selectionIsMulti.value=0,this.selectionSingleValue.value=gb.expr.valueArrayLo.value):gb.Y.value==cr.UPPER&&(gb.eval.evalSingle(),this.selectionIsMulti.value=255,this.selectionPattern.lo=gb.expr.valueArrayLo.value,this.selectionPattern.hi=gb.expr.valueArrayHi.value),this.actionCode.value){case f("m"):this.setSpriteMove();break;case f("s"):this.setSpriteShape();break;case f("c"):this.setSpriteColor();break;case f("e"):this.setSpriteEnable();break;case _.SQUOTE:case _.DQUOTE:case _.QQUOTE:this.defineSpriteFromString();break;default:gb.error.notImplementedError(`Sprite subcommand ${gb.eval.subCommand.asChar} not implemented!`);break}return 10}initVars(){const e={settings:[c,"vars"],regS:[c,"vars"],regT:[c,"vars"],autoIncreaseMode:[c,"vars"],ofsS:[c,"temp"],ofsT:[c,"temp"],actualCode:[c,"temp"],defStringLen:[c,"temp"],defStringIdx:[c,"temp"],actualModifierTS:[c,"temp"],targetMaxOfs:[c,"temp"],actionCode:[c,"temp"],actionModifier:[c,"temp"],bitIteratorData16:[w,"temp"],maskAnd:[w,"temp"],maskOrXor:[w,"temp"],selectionIsMulti:[c,"vars"],selectionPattern:[w,"vars"],selectionSingleValue:[c,"vars"],shadowX:[L,"spr_shadow",32],shadowY:[L,"spr_shadow",32],speedX:[L,"spr_shadow",32],speedY:[L,"spr_shadow",32],destX:[L,"spr_shadow",32],destY:[L,"spr_shadow",32],shadowShape:[L,"spr_shadow",16],shadowColor:[L,"spr_shadow",16],shadowEnabled:[w,"spr_shadow"]};gb._gvar.createVars("sprite",e,this)}init(){const e={settings:128,regS:20,regT:20,autoIncreaseMode:128,selectionIsMulti:0,selectionPattern:0,selectionSingleValue:0,shadowEnabled:0};this.initVals(e)}resetSprites(){this.hideAll()}hideAll(){gb._bus.write(53269,0)}sprIrq(){this.sprIrq8()}sprIrq8(){for(let e=0;e<8;e++){const r=this.shadowShape.getOfsValue(e);this.vicSetShape(e,r);const a=this.shadowColor.getOfsValue(e);this.vicSetColor(e,a),gb.X=e<<1;const s=this.speedX.getOfsWord(gb.X.value);let i=this.shadowX.getOfsWord(gb.X.value)+s&65535;const n=this.destX.getOfsWord(gb.X.value);(s>=32768&&i<n||s<32768&&i>n)&&(i=n,this.speedX.setOfsWord(gb.X.value,0)),this.shadowX.setOfsWord(gb.X.value,i);const o=this.speedY.getOfsWord(gb.X.value);let u=this.shadowY.getOfsWord(gb.X.value)+o&65535;const d=this.destY.getOfsWord(gb.X.value);(o>=32768&&u<d||o<32768&&u>d)&&(u=d,this.speedY.setOfsWord(gb.X.value,0)),this.shadowY.setOfsWord(gb.X.value,u);const p=i>>7,g=u>>7;this.vicSetSpriteCoord(e,p,g)}this.vicSetEnable(this.shadowEnabled.lo)}debugCoords(){}vicSetSpriteCoord(e,r,a){gb._bus.write(53248+e*2,r&255),gb._bus.write(53249+e*2,a&255);const s=gb._bus.read(53264),i=2**e,n=s&(255^i)|((r&256)!=0?i:0);gb._bus.write(53264,n)}vicSetShape(e,r){gb._bus.write(50168+e,r&255)}vicSetColor(e,r){gb._bus.write(53287+e,r&255)}vicSetEnable(e){gb._bus.write(53269,e&255)}setSpriteDestFromArgs(e){const r=gb.A.value;if(gb.expr.valueArrayType.getOfsValue(0)!=T._NONE){const d=gb.expr.valueArray.getOfsWord(1)*128;this.destX.setOfsWord(r<<1,d)}if(gb.expr.valueArrayType.getOfsValue(3)!=T._NONE){const d=gb.expr.valueArray.getOfsWord(4)*128;this.destY.setOfsWord(r<<1,d)}if(gb.eval.cmdArgCount.value<3){const d=gb.expr.valueArray.getOfsWord(1)*128;this.shadowX.setOfsWord(r<<1,d);const p=gb.expr.valueArray.getOfsWord(4)*128;this.shadowY.setOfsWord(r<<1,p);return}const a=gb.expr.valueArray.getOfsWord(7),s=gb.expr.valueArray.getOfsWord(1)*128-this.shadowX.getOfsWord(r<<1),i=gb.expr.valueArray.getOfsWord(4)*128-this.shadowY.getOfsWord(r<<1),n=Math.abs(s)+Math.abs(i),o=s/n*a,u=i/n*a;this.speedX.setOfsWord(r<<1,o),this.speedY.setOfsWord(r<<1,u)}bitIterator16(e,r){this.bitIteratorData16.value=e,gb.Y=0,gb.X.repeat(()=>{this.bitIteratorData16.lo&1&&(gb.A=gb.Y.value,r(gb.A)),this.bitIteratorData16.value=this.bitIteratorData16.value>>1})}setSpriteMove(){this.evalAndIterate(this.setSpriteDestFromArgs)}evalAndIterate(e){if(gb.eval.evalAll(),!this.selectionIsMulti.Z){this.bitIterator16(this.selectionPattern.value,e.bind(this));return}gb.A=this.selectionSingleValue.value,e.bind(this)(gb.A)}setSpriteShape(){this.evalAndIterate(this.setSpriteShapeFromArgs)}setSpriteColor(){this.evalAndIterate(this.setSpriteColorFromArgs)}setSpriteEnable(){if(gb.eval.evalAll(),gb.eval.cmdArgCount.value>0&&(this.maskAnd.value=gb.expr.valueArray.getOfsWord(0),this.shadowEnabled.value&=this.maskAnd.value),!this.selectionIsMulti.Z){this.shadowEnabled.value|=this.selectionPattern.value;return}this.selectionSingleValue.value>=8?this.shadowEnabled.hi|=gb.bits[this.selectionSingleValue.value&7]:this.shadowEnabled.lo|=gb.bits[this.selectionSingleValue.value&7]}setSpriteShapeFromArgs(e){const r=gb.expr.valueArray.getOfsValue(1);this.shadowShape.setOfsValue(gb.A.value,r)}setSpriteColorFromArgs(e){const r=gb.expr.valueArray.getOfsValue(1);this.shadowColor.setOfsValue(gb.A.value,r)}defineSpriteFromString(){for(this.defStringLen.value=gb.token.readByte().value,this.defStringIdx.value=0;this.defStringIdx.value<this.defStringLen.value;){switch(gb.A=gb.token.readByte(),this.defStringIdx.inc(),this.actualModifierTS.value=gb.A.value&192,this.actualCode.value=gb.token.lastReadValue.value&63,gb.mem.srcPtr.value=gb.token.currBasPtr.value,this.actualCode.value!=-1&&(this.actualModifierTS.bitTest(128)&&(gb.A=gb.A=gb.mem.srcPtr.getOfsValue(this.defStringIdx.value),this.regT.value=gb.A.value,this.defStringIdx.inc()),this.actualModifierTS.bitTest(64)&&(gb.A=gb.A=gb.mem.srcPtr.getOfsValue(this.defStringIdx.value),this.regS.value=gb.A.value,this.defStringIdx.inc())),this.actualCode.value){case C.spr_autoinc_0:this.autoIncreaseMode.value=this.actualModifierTS.value;continue;case C.spr_copy_idx:gb.A.value=this.regS.value,gb.X.value=this.regT.value,this.actualModifierTS.bitTest(128)&&(this.regT.value=gb.A.value),this.actualModifierTS.bitTest(64)&&(this.regS.value=gb.X.value);continue;case C.spr_rot_fill:gb.error.notImplementedError(`Sprite command $${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_mirr_fill_multi:gb.error.notImplementedError(`Sprite command $${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_mirr_fill_sing:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_spec:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_mirr_h_mult:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_mirr_h_sing:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_mirr_v:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_rot90:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_rot180_sing:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_rot180_mult:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_rot270:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_rot90_mirr_h_sing:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_rot90_mirr_v_sing:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_sh_left_mult:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_sh_right_mult:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_sh_left_sing:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_sh_right_sing:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_sh_up:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_sh_down:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_def_raw:this.sprDefRaw();break;case C.spr_copy:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_def_cmp0:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_def_cmp_base:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_use_predef0:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_use_predef1:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_use_predef2:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_use_predef3:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_use_predef4:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_use_predef5:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_use_predef6:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_use_predef7:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_set_predef0:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_set_predef1:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_set_predef2:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_set_predef3:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_set_predef4:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_set_predef5:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_set_predef6:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;case C.spr_set_predef7:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break;default:gb.error.notImplementedError(`Sprite command ${this.actualCode.value.toHex2()} not implemented!`);break}this.autoIncreaseMode.Z||(this.autoIncreaseMode.bitTest(128)&&this.incT(),this.autoIncreaseMode.bitTest(64)&&this.incS())}}incT(){this.regT.inc(),gb.mem.destPtr.inc(64),this.ofsT.value=0}incS(){this.regS.inc(),gb.mem.srcPtr.inc(64),this.ofsS.value=0}setDestPrtFromT(){gb.mem.destPtr.value=this.regT.value*64+this.baseSprAddr,this.ofsT.value=0}setSrcPtrFromS(){gb.mem.srcPtr.value=this.regS.value*64+this.baseSprAddr,this.ofsS.value=0}clearBase(){gb.mem.set(gb.mem.destPtr.value,0,64)}sprDefRaw(){for(this.setDestPrtFromT(),this.clearBase(),gb.mem.srcPtr.value=gb.token.currBasPtr.value,this.targetMaxOfs.value=62,this.settings.value&128&&this.targetMaxOfs.inc();this.defStringIdx.value<this.defStringLen.value;)gb.A=gb.mem.srcPtr.getOfsValue(this.defStringIdx.value),gb.mem.destPtr.setOfsValue(this.ofsT.value,gb.A.value),this.ofsT.value>=this.targetMaxOfs.value?this.incT():this.ofsT.inc(),this.defStringIdx.inc();gb.token.currBasPtr.inc(this.defStringIdx.value-1)}}Cr([b({input:"A"})],Kt.prototype,"setSpriteDestFromArgs");Cr([b({input:"A"})],Kt.prototype,"setSpriteShapeFromArgs");Cr([b({input:"A"})],Kt.prototype,"setSpriteColorFromArgs");var ho=Object.defineProperty,bo=Object.getOwnPropertyDescriptor,fo=(t,e,r,a)=>{for(var s=bo(e,r),i=t.length-1,n;i>=0;i--)(n=t[i])&&(s=n(e,r,s)||s);return s&&ho(e,r,s),s};class Ms extends k{fastIndexArray;waitMsTillStart;intervalMs;rasterPos;repeatsLeft;timerIndexUsed;initVars(){const e={fastIndexArray:[L,"vars",32],waitMsTillStart:[L,"vars",64],intervalMs:[L,"vars",64],"!rasterPos":[L,"=intervalMs",64],repeatsLeft:[L,"vars",64],timerIndexUsed:[c,"vars"]};gb._gvar.createVars("timer",e,this)}init(){this.initVals({})}run(){switch(gb.eval.readSubCommand(),gb.expr.resetIndexes(),gb.expr.readOne(),gb.expr.valueArrayType.getOfsValue(0)==$._NONE?this.timerIndexUsed.value=255:this.timerIndexUsed.value=gb.expr.valueArrayLo.getOfsValue(0),gb.A=gb.eval.subCommand.value,gb.A.value){case f("i"):this.interval();break;case f("t"):this.timeout(),this.repeatsLeft.setOfsWord(this.timerIndexUsed.value*2,0);break;case f("d"):if(this.timerIndexUsed.value==255){this.initTimers();break}this.fastIndexArray.setOfsValue(this.timerIndexUsed.value,255);break;case f("r"):case f("e"):case f("D"):case f("E"):case f("D×"):case f("E×"):default:gb.error.notImplementedError(`Subcommand ${gb.A.asChar} not implemented`)}return 10}initTimers(){for(let e=0;e<32;e++)this.fastIndexArray.setOfsValue(e,255)}interval(){gb.expr.resetIndexes(),gb.expr.readOne();let e=gb.expr.valueArray.getOfsWord(1);e<20&&(e=20),this.intervalMs.setOfsWord(this.timerIndexUsed.value*2,e),this.timeout();let r=gb.expr.valueArray.getOfsWord(4);r==0&&(r=65535),this.repeatsLeft.setOfsWord(this.timerIndexUsed.value*2,r)}timeout(){gb.gcall.readCallIndex({A:128});let e=0;gb.A=gb.token.preReadByte(),gb.A.value==f(",")&&(gb.token.assertComma(),gb.eval.evalAll(),e=gb.expr.valueArray.getOfsWord(1)),gb.A=gb.gcall.lastIndex.value,this.fastIndexArray.setOfsValue(this.timerIndexUsed.value,gb.A.value),gb.X=this.timerIndexUsed.value*2,this.waitMsTillStart.setOfsWord(gb.X.value,e)}displayTimers(){let e="";for(let r=0;r<32;r++){const a=this.fastIndexArray.getOfsValue(r);if(a==255)continue;const s=gb.gcall.fastArray.getOfsWord(a*2),i=this.waitMsTillStart.getOfsWord(a*2),n=this.repeatsLeft.getOfsWord(a*2);if(a>=128){const o=this.rasterPos.getOfsWord(a*2);e+=`RST#${r}: Fast ${o.toString(16)} A: (${s.toString(16)})  Wait: ${i.toString(16)}  Reps:  ${n.toString(16)} `;continue}e+=`#${r}: Fast ${a.toString(16)} A: (${s.toString(16)})  Wait: ${i.toString(16)}  Reps:  ${n.toString(16)} `}return console.log(e),e}orderTimers(){}setNextRaster(){}doTick(){if(gb.exec.execState.value==mr.running)for(let e=0;e<32;e++){if(this.fastIndexArray.getOfsValue(e)>=128)continue;const a=e*2,s=gb.gcall.fastArray.getOfsWord(a);let i=this.waitMsTillStart.getOfsWord(a);if(i=i-20&65535,this.waitMsTillStart.setOfsWord(a,i),console.log(`Timer ${e}: ${i} ms left`),i!=0&&i<65280)continue;gb._asm.call(s+3);const n=this.intervalMs.getOfsWord(a);let o=this.repeatsLeft.getOfsWord(a);if(n==0||o<=1){this.fastIndexArray.setOfsValue(e,255);return}o!=65535&&(o--,this.repeatsLeft.setOfsWord(a,o)),i+=n,this.waitMsTillStart.setOfsWord(a,i&65535)}}}fo([b({tempProtect:!0})],Ms.prototype,"run");class Ao extends k{performInit(){gb.vars.setVarTypes(),gb.exinline.fillStructures(),gb.gtimer.initTimers()}}class mo extends k{addSimpleNext(){}lastCommandToken;lastCommandStartAddr;structIndex;structTokenArray;structAdressArray;initVars(){const e={lastCommandToken:[c,"temp"],structIndex:[c,"temp"],lastCommandStartAddr:[w,"temp"],structTokenArray:[L,"temp",84],structAdressArray:[L,"temp",168]};gb._gvar.createVars("exec",e,this)}init(){}readNextCommand(){if(gb.A=gb.token.readByte(),this.lastCommandStartAddr.value=gb.token.currBasPtr.value,this.lastCommandToken.value=gb.A.value,gb.token.currBasPtr.value>=gb.mem.basEnd.value)return 0;for(;gb.A=gb.token.readNext(),gb.A.value!=F.FINISHED;);return this.lastCommandToken.value}openStructItemWithPtr(){gb.X=this.structIndex.value,this.structTokenArray.setOfsValue(gb.X.value,this.lastCommandToken.value),gb.X.mul(2),this.structAdressArray.setOfsWord(gb.X.value,this.lastCommandStartAddr.asWord()),this.structIndex.inc()}closeStructItem(){gb.exinline.lastCommandToken.value==0&&gb.error.syntaxError(`Close token ${this.lastCommandToken.value} without an open token.`),gb.exinline.structIndex.dec(),gb.X=gb.exinline.structIndex.value,gb.A=gb.exinline.structTokenArray.getOfsValue(gb.X.value),gb.X.mul(2),gb.mem.destPtr.value=gb.exinline.structAdressArray.getOfsWord(gb.X.value),gb.mem.destPtr.setOfsWord(1,gb.exinline.lastCommandStartAddr.value)}showItems(){let e="";for(let r=0;r<gb.exinline.structIndex.value;r++){const a=Cs[gb.exinline.structTokenArray.getOfsValue(r).asByte()],s=gb.exinline.structAdressArray.getOfsWord(r*2).toHex4();e+=`${a} ${s}`}return console.log(e),e}addDefAddress(){gb.mem.srcPtr.value=this.lastCommandStartAddr.value,gb.A=gb.mem.srcPtr.getOfsValue(3),gb.A=gb.vars.convertScreenToVarIndex(gb.A),gb.gcall.lastVariable.value=gb.A.value,gb.X=gb.A.value*2,gb.AY=this.lastCommandStartAddr.value,this.lastCommandToken.value==_.fast?gb.gcall.fastArray.setOfsWord(gb.X.value,gb.AY):gb.gcall.defArray.setOfsWord(gb.X.value,gb.AY)}fillStructures(){for(gb.token.variableMode.value=We.svarList,gb.exinline.structIndex.value=0,gb.exec.resetCurrBasPtr(),gb.token.variableMode.value=We.simpleScan;gb.A.value=this.readNextCommand(),!gb.A.Z;)switch(gb.A.value){case _.def:case _.fast:this.openStructItemWithPtr(),this.addDefAddress();break;case _.for:case _.repeat:this.openStructItemWithPtr();break;case _.if:this.openStructItemWithPtr(),this.lastCommandStartAddr.value=this.lastCommandStartAddr.value+2,this.openStructItemWithPtr();break;case _.elif:case _.else:this.closeStructItem(),this.openStructItemWithPtr();break;case _.dim:this.openStructItemWithPtr(),gb.pushVariables([gb.exinline.lastCommandStartAddr]),gb.exinline.lastCommandStartAddr.value=gb.token.currBasPtr.value,this.closeStructItem(),gb.popVariables([gb.token.currBasPtr]),gb.token.currBasPtr.inc16(2),gb.cmdDim.initDims();break;case _.do:gb.A=gb.token.lastReadValue.value,(gb.A.value==_.while||gb.A.value==_.until)&&this.openStructItemWithPtr();break;case _.dend:case _.fend:case _.next:case _.loop:this.closeStructItem();break;case _.endif:this.closeStructItem(),this.closeStructItem();break}gb.token.variableMode.value=We.cvarRead,gb.exec.resetCurrBasPtr()}}var _o=Object.defineProperty,vo=Object.getOwnPropertyDescriptor,xo=(t,e,r,a)=>{for(var s=vo(e,r),i=t.length-1,n;i>=0;i--)(n=t[i])&&(s=n(e,r,s)||s);return s&&_o(e,r,s),s};class Ls extends k{defArray;fastArray;isLastFast;lastAddress;lastVariable;lastIndex;initVars(){const e={defArray:[L,"vars",156],fastArray:[L,"vars",156],isLastFast:[c,"vars"],lastAddress:[w,"vars"],lastVariable:[c,"vars"],lastIndex:[c,"vars"]};gb._gvar.createVars("exec",e,this)}init(){for(let e=0;e<156;e++)this.defArray.setOfsValue(e,0),this.fastArray.setOfsValue(e,0)}readCallIndex(e){this.isLastFast.value=gb.A.value,gb.A=gb.token.readByte(),this.lastVariable.value=gb.A.value,gb.A=gb.vars.convertScreenToVarIndex(gb.A),this.lastIndex.value=gb.A.value,gb.A.mul(2),gb.X=gb.A,this.isLastFast.N?this.lastAddress.value=this.fastArray.getOfsWord(gb.X.value):this.lastAddress.value=this.defArray.getOfsWord(gb.X.value)}}xo([b({input:"A"})],Ls.prototype,"readCallIndex");class yo extends k{freeMem;freeFast;basStart;basEnd;extraStart;extraEnd;freeStart;freeEnd;arrayBottom;arrayTop;lastRAM;forbidStart;forbidEnd;srcPtr;destPtr;initVars(){const e={freeMem:[w,"vars"],freeFast:[w,"vars"],basStart:[w,43],basEnd:[w,45],"!extraStart":[w,45],extraEnd:[w,47],"!STR_Start":[w,47],STR_End:[w,49],"!freeStart":[w,49],freeEnd:[w,51],"!arrayBottom":[w,51],arrayTop:[w,53],lastRAM:[w,55],forbidStart:[c,57],forbidEnd:[c,58],srcPtr:[he,"zp"],destPtr:[he,"zp"]};gb._gvar.createVars("mem",e,this)}init(){const e={lastRAM:32767,basEnd:2049,basStart:2049};this.initVals(e)}runGBC(){this.freeMem.value=31e3}calcFreeMem(e){e&&this.runGBC(),this.freeFast.value=this.lastRAM.value-this.freeStart.value,this.freeMem.value=this.freeFast.value}copy(e,r,a){for(let s=0;s<a;s++){const i=gb._bus.read(e+s);gb._bus.write(r+s,i)}}set(e,r,a){for(let s=0;s<a;s++)gb._bus.write(e+s,r)}}var Co=Object.defineProperty,So=Object.getOwnPropertyDescriptor,Qs=(t,e,r,a)=>{for(var s=So(e,r),i=t.length-1,n;i>=0;i--)(n=t[i])&&(s=n(e,r,s)||s);return s&&Co(e,r,s),s};class Sr extends k{jiffLo;jiffMid;jiffHi;jiffStore;initVars(){const e={jiffLo:[c,162],jiffMid:[c,161],jiffHi:[c,160],jiffStore:[w,"vars"]};gb._gvar.createVars("time",e,this)}init(){}storeJiffWord(){this.jiffStore.lo=this.jiffLo.value,this.jiffStore.hi=this.jiffMid.value}incJiffyClock(){this.jiffLo.inc(),this.jiffLo.Z&&(this.jiffMid.inc(),this.jiffMid.Z&&this.jiffHi.inc())}waitMs(e,r){const a=Math.floor((gb.A.value+gb.X.value*256)*60/1e3);gb.A=a&255,gb.X=a>>8&255,this.waitJiffies(gb.A,gb.X)}waitJiffies(e,r){const a=gb.A.value+gb.X.value*256,s=this.jiffLo.value+this.jiffMid.value*256+this.jiffHi.value*65536+a;for(;this.jiffLo.value+this.jiffMid.value*256+this.jiffHi.value*65536<s;)gb.doEvents()}}Qs([b({input:"AX"})],Sr.prototype,"waitMs");Qs([b({input:"AX"})],Sr.prototype,"waitJiffies");class To extends k{index;ptr;bufferLen;buffer;skipBufferCount;tempPtr;funcPtr;constructor(){super()}NO_COMPILE=["initVars"];initVars(){const e={index:[c,"vars"],bufferLen:[c,"vars"],buffer:[L,"vars",15],skipBufferCount:[c,"vars"],tempPtr:[he,"zp"],funcPtr:[he,"zp"]};gb._gvar.createVars("usestring",e,this)}use(e,r){for(gb.pushVariables([e,this.index]),this.index.value=0,this.ptr=e;this.index.value<e.length;){const a=e.getElement(this.index.asByte());this.index.inc(),r(a)}gb.popVariables([e,this.index])}pushState(){gb.pushVariables([this.index,this.ptr,this.funcPtr]),this.index.value=0}popState(){gb.popVariables([this.index,this.ptr,this.funcPtr])}getNextNoBuff(){const e=this.ptr.getElement(this.index.asByte());return this.index.inc(),e}getNext(){return this.skipBufferCount.asByte()==0&&this.bufferLen.value>0?(this.bufferLen.dec(),this.buffer.getElement(this.bufferLen.value)):(this.skipBufferCount.value>0&&this.skipBufferCount.dec(),this.getNextNoBuff())}loadTempPtr(){this.tempPtr.lo=gb.ustr.getNext(),this.tempPtr.hi=gb.ustr.getNext()}printData(){let e=`Index: ${this.index.value}
Data:
`;for(let r=0;r<=this.ptr.strLen;r++)r%16==0&&(e+=`$${r.toHex2()}:  `),e+=this.ptr.getOfsValue(r).toHex2(),r==this.index.value?e+="* ":e+="  ",r%16==15&&(e+=`
`);return e}getNextTwo(){const e=this.getNext(),r=this.getNext();return[e,r]}}const ko=[148,141,157,200,197,198,199,145,51,23,1,52,26,19,5,255,53,18,4,54,3,6,20,24,55,25,7,56,2,8,21,22,57,9,10,48,13,11,15,14,43,16,12,45,46,58,0,44,28,42,59,147,255,61,30,47,49,31,255,50,32,255,17,131,212,205,221,204,201,198,199,209,35,87,65,36,90,83,69,255,37,82,68,38,67,70,84,88,39,89,71,40,66,72,85,86,41,73,74,48,77,75,79,78,91,80,76,93,62,27,122,60,105,64,29,211,255,61,94,63,33,31,255,34,255,255,81,195,255,255,255,255,255,255,255,255,255,115,112,255,109,110,113,255,255,114,108,255,124,123,99,125,255,119,101,255,127,116,120,126,255,98,117,255,103,97,121,106,255,111,118,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,107,255];class Io extends k{keyBufferCount;keyBuffer;initVars(){const e={keyBufferCount:[c,198],keyBuffer:[L,631,10]};gb._gvar.createVars("keyb",e,this)}init(){this.initVals({keyBufferCount:0})}wait(){for(this.keyBufferCount.value=0;!this.keyBufferCount.value;)gb.doEvents()}resetBuffer(){this.keyBufferCount.value=0}readCurrent(){}readFromBuffer(){if(this.keyBufferCount.value){this.keyBufferCount.value--;const e=gb.keyb.keyBuffer.value;for(let r=0;r<gb.keyb.keyBufferCount.value;r++)gb.keyb.keyBuffer.setOfsValue(r,gb.keyb.keyBuffer.getOfsValue(r+1));return e}else return 255}irq(){const e=gb._emu.bus.keyboard.matrix;console.log(e);let r=0;e[7]&32&&(r=128),(e[1]&128||e[6]&16)&&(r=64);for(let a=0;a<8;a++){const s=e[a];if(s){for(let i=0;i<8;i++)if(s&1<<i){const n=ko[(a<<3)+i+r];console.log(`pressedValue: ${n} row: ${a} col: ${i}`),this.keyBufferCount.value<10&&(gb.keyb.keyBuffer.setOfsValue(gb.keyb.keyBufferCount.value,n),gb.keyb.keyBufferCount.inc())}}}}}var wo=Object.defineProperty,Oo=Object.getOwnPropertyDescriptor,Ys=(t,e,r,a)=>{for(var s=Oo(e,r),i=t.length-1,n;i>=0;i--)(n=t[i])&&(s=n(e,r,s)||s);return s&&wo(e,r,s),s},Gs=(t=>(t[t.XOR=128]="XOR",t[t.OR=64]="OR",t))(Gs||{});const Bo=[32,100,32,106,32,101,32,99,32,112,67,110,93,32,93,109,67,125,85,67,73,93,32,93,74,67,75,79,119,80,101,32,103,76,111,122,108,98,123,225,32,97,124,226,126,236,226,251,97,32,225,252,98,254,160,249,160,160,32,160,160,248,160,207,249,208,231,32,245,204,248,250],Do=[3,1,5,2,0,4,10,8,12],Eo=[4,1,3,0,5,2,4,4,7,4,6,4,8];class Tr extends k{textColor;screenX;screenY;colorTarget;screenPtr;colorPtr;textVisibleSettings;transparentChar;reverseState;windowX0;windowX1;windowY0;windowY1;printerFuncPtr;boxType;boxSides;tempX0;stampWidth;scrollSpeed;typeSpeed;varSourceOpt;constructor(){super()}NO_COMPILE=["initVars"];initVars(){const e={textColor:[c,646],screenX:[c,211],screenY:[c,214],screenPtr:[he,"zp"],colorPtr:[he,"zp"],colorTarget:[c,"vars"],textVisibleSettings:[c,"vars"],transparentChar:[c,"vars"],reverseState:[c,"vars"],printerFuncPtr:[Wi,"vars"],windowX0:[c,"vars"],windowX1:[c,"vars"],windowY0:[c,"vars"],windowY1:[c,"vars"],boxType:[c,"vars"],boxSides:[c,"vars"],stampWidth:[c,"vars"],scrollSpeed:[c,"vars"],typeSpeed:[c,"vars"],varSourceOpt:[c,"vars"],tempX0:[c,"temp"]};gb._gvar.createVars("screen",e,this)}init(){const e={screenX:0,screenY:0,textColor:1,textVisibleSettings:192,transparentChar:32,typeSpeed:0,scrollSpeed:0,stampWidth:0,reverseState:0,screenPtr:49152,colorPtr:55296,varSourceOpt:0,boxType:0,boxSides:15};this.initVals(e)}resetColors(){gb._bus.write(53280,0),gb._bus.write(53281,0),this.textColor.value=1}clear(){this.fill(32),gb.scrCmd.HOME.bind(this)()}fill(e){const r=gb._bus.vic.getTextBase(),a=gb._bus.vic.getColorBase(),s=e.asByte(),i=this.textColor.asByte();for(let n=0;n<1e3;n++)gb._ram[r+n]=s;if(i<16)for(let n=0;n<1e3;n++)gb._bus.writeColorRam(a+n,i)}printScrCode(e){let r=e.asByte();const a=this.textColor.asByte(),s=this.textVisibleSettings.asByte(),i=this.reverseState.asByte();if(!(s&1)){if(s&128){if(s&32&&r==this.transparentChar.asByte())return;i&&(i&64&&(r|=128),i&128&&(r^=128));const n=this.screenPtr.asWord();gb._bus.write(n,r)}s&64&&a<16&&gb._bus.writeColorRam(this.colorPtr.asWord(),a)}}incScreenPos(){this.screenPtr.inc(),this.colorPtr.inc(),this.screenX.inc(),this.screenY.asByte()>=this.windowY1.asByte()}useScrCode(e){e.asByte()==255&&gb.error.notImplementedError("0xff codes are not implemented!");const r=ys[e.asByte()-128].toUpperCase();gb.save("AXY"),gb.scrCmd[r].bind(gb.scrCmd)(),gb.restore("AXY")}printScrA(e){e.asByte()>=128?this.useScrCode(e):this.printScrC(e)}printScrB(e){}printScrC(e){this.printScrCode(e),this.incScreenPos()}printDefault(e){const r=this.printScrA;gb.ustr.use(e,r.bind(this))}printTextA(e){gb.ustr.use(e,this.printScrA.bind(this))}printTextB(e){gb.ustr.use(e,this.printScrB.bind(this))}printTextC(e){gb.ustr.use(e,this.printScrC.bind(this))}setAddr(e,r){const a=gb._bus.vic.getTextBase(),s=gb._bus.vic.getColorBase();this.screenPtr.value=gb.AY+a,this.colorPtr.value=gb.AY+s,this.calcPosFromAddr()}calcPosFromAddr(){this.screenX.value=(this.screenPtr.value&1023)%40,this.screenY.value=Math.floor((this.screenPtr.value&1023)/40)}writeStrSafe(){gb.ustr.pushState();const e=Ue.createFromPointer(gb._ram,256);gb.gscr.printTextC(e),gb.ustr.popState()}setPos(){this.screenPtr.value=this.screenY.value*40+this.screenX.value+gb._bus.vic.getTextBase(),this.colorPtr.value=(this.screenPtr.value&1023)+gb._bus.vic.getColorBase()}setBG(e){gb._bus.vic.setBackground(e)}setBD(e){gb._bus.vic.setBorder(e)}setColor(e){switch(this.colorTarget.value){case 0:this.textColor.value=e;break;case 1:gb._bus.vic.setBackground(e),this.colorTarget.value=0;break;case 2:gb._bus.vic.setBorder(e),this.colorTarget.value=0;break}}putChar(e,r,a){let s=0;const i=Eo[Do[e.asByte()]&gb.gscr.boxSides.value];(a.asByte()||i!==4)&&(s=Bo[this.boxType.value*9+i]);for(let n=0;n<r.asByte();n++)s==0?gb.scrCmd.CURSOR_RIGHT():gb.gscr.printScrC(s)}putbox(...e){const r=gb.A.value,a=gb.X.value;let s=gb.Y.value;this.boxType.value>7&&gb.error.invalidParameters(`Invalid BoxType code: ${this.boxType.value} `),this.tempX0.value=this.screenX.value;let i=-1,n;for(;i<8;){if(i+=1,n=1,(i==1||i==4||i==7)&&(n=a),i==3&&s.asByte()<=0){i=5;continue}(i==3||i==6)&&(gb.gscr.screenY.inc(),gb.gscr.screenX.value=this.tempX0.value,gb.gscr.setPos()),gb.gscr.putChar(i,n,r),i==5&&(s--,i=2)}}}Ys([b({input:"AY"})],Tr.prototype,"setAddr");Ys([b({input:"AXY"})],Tr.prototype,"putbox");var Ro=Object.defineProperty,No=Object.getOwnPropertyDescriptor,Vo=(t,e,r,a)=>{for(var s=No(e,r),i=t.length-1,n;i>=0;i--)(n=t[i])&&(s=n(e,r,s)||s);return s&&Ro(e,r,s),s};class qs extends k{BACKGROUND(){gb.gscr.colorTarget.value=1}BORDER(){gb.gscr.colorTarget.value=2}BLACK(){gb.gscr.setColor(0)}WHITE(){gb.gscr.setColor(1)}RED(){gb.gscr.setColor(2)}CYAN(){gb.gscr.setColor(3)}PURPLE(){gb.gscr.setColor(4)}GREEN(){gb.gscr.setColor(5)}BLUE(){gb.gscr.setColor(6)}YELLOW(){gb.gscr.setColor(7)}ORANGE(){gb.gscr.setColor(8)}BROWN(){gb.gscr.setColor(9)}PINK(){gb.gscr.setColor(10)}DARK_GRAY(){gb.gscr.setColor(11)}DARK_GREY(){gb.gscr.setColor(11)}GRAY(){gb.gscr.setColor(12)}GREY(){gb.gscr.setColor(12)}LIGHT_GREEN(){gb.gscr.setColor(13)}LIGHT_BLUE(){gb.gscr.setColor(14)}LIGHT_GRAY(){gb.gscr.setColor(15)}LIGHT_GREY(){gb.gscr.setColor(15)}SETX(){gb.gscr.screenX.value=gb.ustr.getNext(),gb.gscr.setPos()}SETY(){gb.gscr.screenY.value=gb.ustr.getNext(),gb.gscr.setPos()}SETXY(){gb.gscr.screenX.value=gb.ustr.getNext(),gb.gscr.screenY.value=gb.ustr.getNext(),gb.gscr.setPos()}setAddrWithNextByte(...e){gb.A=gb.ustr.getNext(),gb.gscr.setAddr(gb.A,gb.Y)}SET_ADDR0(){this.setAddrWithNextByte({Y:0})}SET_ADDR1(){this.setAddrWithNextByte({Y:1})}SET_ADDR2(){this.setAddrWithNextByte({Y:2})}SET_ADDR3(){gb.A=gb.ustr.getNext(),gb.A.value>=240?(gb.Y.value=gb.A.value&3,gb.A.value=gb.A.value&12,gb.A.Z?gb.A=Ge["'"]:gb.A=Ge['"'],gb.gscr.setAddr(gb.Y,gb.A)):this.setAddrWithNextByte({Y:3})}CURSOR_UP(){gb.gscr.screenY.dec(),gb.gscr.setPos()}CURSOR_LEFT(){gb.gscr.screenX.dec(),gb.gscr.setPos()}CURSOR_RIGHT(){gb.gscr.screenX.inc(),gb.gscr.setPos()}CURSOR_DOWN(){gb.gscr.screenY.inc(),gb.gscr.setPos()}HOME_CURRENT_LINE(){gb.gscr.screenX.value=gb.gscr.windowX0.value,gb.gscr.setPos()}END_CURRENT_LINE(){}RETURN(){gb.gscr.screenX.value=gb.gscr.windowX0.value,gb.gscr.screenY.inc(),gb.gscr.setPos()}HOME(){gb.gscr.screenX.value=gb.gscr.windowX0.value,gb.gscr.screenY.value=gb.gscr.windowY0.value,gb.gscr.setPos()}RUN(){}F1(){}F3(){}F5(){}F7(){}F2(){}F4(){}F6(){}F8(){}DEF_F1(){}DEF_F2(){}DEF_F3(){}DEF_F4(){}DEF_F5(){}DEF_F6(){}DEF_F7(){}DEF_F8(){}USE_FN(){}SHIFT_RETURN(){}LO_UP_CHARSET(){const e=gb._bus.read(53272);gb._bus.write(53272,e|2)}UP_GFX_CHARSET(){const e=gb._bus.read(53272);gb._bus.write(53272,e&253)}DISABLE_C_SHIFT(){}ENABLE_C_SHIFT(){}CLEAR(){gb.gscr.clear()}INSERT(){}STAMP_SET_MODE(){}STAMP_USE(){}STAMP_USE_LAST(){}WINDOW_START(){}WINDOW_STOP(){}BOX_SET_SINGLE(){}BOX_SET_STYLE(){gb.A=gb.ustr.getNext(),gb.A.value>7&&gb.error.invalidParameters(`Invalid BoxStyle code: ${gb.A.value}`),gb.gscr.boxType.value=gb.A.value}BOX_USER_DEF(){}BOX_DRAW_FILLED(){gb.gscr.putbox(!0,gb.ustr.getNext(),gb.ustr.getNext())}BOX_DRAW_EMPTY(){gb.gscr.putbox(!1,gb.ustr.getNext(),gb.ustr.getNext())}BOX_SET_SIDES(){gb.gscr.boxSides.value=gb.ustr.getNext()}BOX_BOX_FILLED_COMPR(){const e=gb.ustr.getNext();gb.gscr.putbox({A:255,X:e>>4,Y:e&15})}BOX_BOX_EMPTY_COMPR(){const e=gb.ustr.getNext();gb.gscr.putbox({A:0,X:e>>4,Y:e&15})}TYPEWRITER_MODE(){}DECOMPRESS(){}SET_MODE_A(){gb.gscr.printerFuncPtr.value=gb.gscr.printTextA}SET_MODE_B(){gb.gscr.printerFuncPtr.value=gb.gscr.printTextB}SET_MODE_C(){gb.gscr.printerFuncPtr.value=gb.gscr.printTextC}SCROLL_SET_AREA(){}SCROLL_WINDOW(){}SCROLL_SCREEN(){}SCROLL_CIRCULAR_OFF(){}PRINT_SRC_VAR(){gb.gscr.varSourceOpt.value=128}PRINT_SRC_ADDR(){gb.gscr.varSourceOpt.value=0}FORMAT_DEC(){}FORMAT_F(){}FORMAT_HEX(){}FORMAT_STR(){}PRINT_DB(){gb.ustr.loadTempPtr(),gb.num.loadInt24FromTemp(),gb.num.int24_3.value=0,gb.num.int24_2.value=0,gb.num.num_sgn.value=0,gb.num.int24DecToString(),gb.gscr.writeStrSafe()}PRINT_DW(){gb.ustr.loadTempPtr(),gb.num.loadInt24FromTemp(),gb.num.int24_3.value=0,gb.num.num_sgn.value=0,gb.num.int24DecToString(),gb.gscr.writeStrSafe()}PRINT_F(){}PRINT_HB(){gb.ustr.loadTempPtr(),gb.num.loadInt24FromTemp(),gb.num.int24_3.value=0,gb.num.int24_2.value=0,gb.num.int24ToHexString(),gb.gscr.writeStrSafe()}PRINT_HW(){gb.ustr.loadTempPtr(),gb.num.loadInt24FromTemp(),gb.num.int24_3.value=0,gb.num.int24ToHexString(),gb.gscr.writeStrSafe()}PRINT_S(){gb.ustr.loadTempPtr()}push_var(e){}PUSH_ONE(){const e=gb.ustr.getNextNoBuff();this.push_var(e)}PUSH_TWO(){this.PUSH_ONE(),this.PUSH_ONE()}PUSH_MULTI(){let e=gb.ustr.getNextNoBuff();for(;e!=0;)this.push_var(e),e=gb.ustr.getNextNoBuff()}BUFFER_COPY(){}BUFFER_DEF(){}BUFFER_OPT(){}BUFFER_PASTE(){}BUFFER_SUSP(){}CLEAR_LINE_CONTENT(){}DECODE(){}DELETE(){}INPUT_CURSOR(){}INPUT_RX(){}POS_LOAD(){}POS_SAVE(){}RECOLOR_ONLY(){}REMOVE_LINE(){}REP_BETWEEN(){gb.A=gb.ustr.getNext(),gb.Y=gb.A,gb.Y.repeat(()=>{gb.mem.srcPtr.value=gb.ustr.ptr.address,gb.mem.srcPtr.inc(gb.ustr.index.value),gb.X=0;do{if(gb.X.inc(),gb.A=gb.mem.srcPtr.getOfsValue(gb.X.value),gb.A.value==128+ys.indexOf("rep_between"))break;gb.gscr.printScrA(gb.A.value)}while(gb.X.value<128)}),gb.ustr.index.inc(gb.X.value)}REP_DOUBLE(){}REP_NEXT(){}REVERSE_OFF(){gb.gscr.reverseState.value=0}REVERSE_ON(){gb.gscr.reverseState.value=Gs.XOR}SCROLL_CIRCULAR_ON(){}SCROLL_COLUMN(){}SCROLL_DOWN(){}SCROLL_LEFT(){}SCROLL_LINE(){}SCROLL_RIGHT(){}SCROLL_UP(){}SET_COL_BCBD1(){}SET_COL_BCBD2(){}SET_COL_BCKG(){const e=gb.ustr.getNext();gb.gscr.setBG(e)}SET_COL_BORD(){const e=gb.ustr.getNext();gb.gscr.setBD(e)}SET_BG_BD(){const e=gb.ustr.getNext();gb.gscr.setBG(e>>4),gb.gscr.setBD(e&15)}STOP(){gb.exec.waitKey()}TAB(){}TRANSPARENT(){}UP(){}DOWN(){}LEFT(){}RIGHT(){}}Vo([b({input:"Y"})],qs.prototype,"setAddrWithNextByte");const Kr={SETPOS(t,e){const r=parseInt(t,10)+parseInt(e,10)*40;return[br.set_addr0+(r>>8),r&255]},COMPRESS(t){return[]},ENCODE(t,e,r){return[]},VB(t){return[]},VW(t){return[]},FORMAT(t){const e=JSON.parse(t),r={};return console.log(e),console.log(r),[]}};class Po{cache;constructor(){this.cache={}}createText(e,r,a=""){if(this.cache[r])return this.cache[r];const s=this.getBytesFromText(r),i=new Ue(e,"data",s,s.length);return i.memory=gb._ram,i.init(),i.comment=`${a||"No description"}
'${r}'`,this.cache[r]=i,i}addTemplateStr(e,r){const a="{PRINT_SRC_ADDR}",s={"{%b}":"PRINT_DB","{%hb}":"PRINT_HB","{%w}":"PRINT_DW","{%hw}":"PRINT_HW","{%s}":"PRINT_S"};let i=e.replace(/(^\s+)|(\s*\n+)/gm,"");const n=new RegExp(Object.keys(s).join("|"),"gmi");let o,u=0;for(;(o=n.exec(i))!==null;){const p=r[u],g=o[0],h=`{${s[g]} $${p.address.lo().toHex2()} $${p.address.hi().toHex2()}}`;i=i.replace(o[0],h),u++}const d=`${a}${i}`;return this.createText("cmdText",d)}getBytesFromText(e){const r={normalConverter:fr,tokens:br,funcs:Kr};return ft.convertStringToBytes(e,r).byteArray}evalBracket(e){let r=[],a,s;e=e.slice(1,-1);const i=/(([(][^)]*[)])|\S)+/g;for(;a=i.exec(e);){const n=a[0],o=n.match(/(\S+)[(]([^)]*)[)]/);if(o){const[u,d,p]=o,g=p.split(",");s=Kr[d](...g),r=r.concat(s)}else s=qi[n],r.push(s)}return r}}function Zr(t,e){throw new Error(`No memory for reserved variable for ${t} at $${e.toHex4()} `)}class Fo{varMap;freeMap;rangeZone;mapped;zoneSizes;forceList;activeNamespace;varAddr;constructor(){this.varMap={},this.varAddr={},this.activeNamespace="",this.freeMap={},this.forceList=[],this.rangeZone={},this.mapped=[],this.zoneSizes={},Object.entries({zp:[[2,255]],data:[[24576,28671]],keyboard:[[631,640]],temp:[[512,543],[679,767],[50176,50431]],temp_stack:[[256,288]],spr_shadow:[[52480,52735]],vars:[[544,600],[646,646],[828,1019],[51200,52479],[52736,53247]]}).forEach(([r,a])=>{this.freeMap[r]=[],this.zoneSizes[r]=0,a.forEach(s=>{const[i,n]=s;for(let o=i;o<=n;o++)this.freeMap[r].push(o),this.rangeZone[o]=r,this.zoneSizes[r]++})})}create(e,r,a,s=0){const i=new r(e,a,s);return i.namespace=this.activeNamespace,e&&(this.varMap[e]=i),i}listVars(){Object.keys(this.varMap).forEach(e=>{this.varMap[e].describe()})}listMemory(){Object.entries(this.mapped).forEach(([e,r])=>{r.forEach(a=>{const{name:s,ref:i}=a,{bytes:n,comment:o}=this.varMap[i]||{};console.log(`${Number(e).toHex4()} ${("("+n+"b)").padStart(6)}: ${s.padEnd(20)} - ${o}`)})})}showStats(){console.log(`
 SEGMENT     Used + Free | Total Free%`),console.log(" ========= ======   ====   =====  ==="),Object.keys(this.freeMap).forEach(e=>{const r=this.zoneSizes[e],a=this.freeMap[e].length,s=r-a;console.log(`${e.padEnd(12)} ${s.toHex4()} + ${a.toHex4()} | ${r.toHex4()}   ${Math.round(a/r*100)}%`)})}reserveByZone(e,r,a=1){let s=0,i=0;for(;s<this.freeMap[r].length-a&&(i=this.freeMap[r][a+s-1]-this.freeMap[r][s]+1,i!=a);)s++;if(i==a){const n=this.freeMap[r][s];return this.freeMap[r].splice(s,a),n}throw new Error(`Not enough free memory in range ${r} for ${e}`)}reserveByAddress(e,r,a){const s=this.forceList.includes(e);let i;for(let n=0;n<a;n++){const o=r+n,u=this.rangeZone[o];u||Zr(e,o);const d=this.freeMap[u];(i=d.indexOf(r+n))>=0?d.splice(i,1):s||Zr(e,o)}}createVars(e,r,a){this.activeNamespace=e,gb._logger.debugDetail(`Creating variables for namespace ${e}...`),Object.keys(r).forEach(s=>{const i="!".indexOf(s[0])>=0?s.slice(1):s;s[0]=="!"&&this.forceList.push(i);const[o,u,d]=r[s],p=this.create(i,o,u,d);p.memory=gb._ram,p.init(),a[i]=p})}}class Mo{protected;constructor(){this.protected=[]}protect(e){const r=e.constructor.name,a=Object.getOwnPropertyNames(e);if(this.protected.length>0&&!(this.protected[0]==r&&this.protected.length==1))throw Error(`Protection error - temp confusion for ${this.protected[0]}`);a.forEach(s=>{if(typeof e[s]>"u")throw Error(`Variable ${s} needs initialization!`)}),this.protected.push(r)}unprotect(e){const r=e.constructor.name;if(this.protected[0]!=r||this.protected.length!=1)throw Error(`Protection error - temp confusion for ${this.protected[0]}`);this.protected.pop()}}class Lo{_gvar;_data;_bus;_logger;_asm;_taint;keyb;_calls;_totalTime;_fr;_temp;_ram;_isTest;_isVitest;_emu;ustr;gscr;eval;num;gcall;gtimer;exec;exstack;exinit;exinline;time;mem;expr;sysv;editor;vars;error;token;operation;postops;scrCmd;cmdDecInc;cmdInkey;cmdForRepeat;cmdDoLoop;cmdDefCall;cmdMem;sprite;cmdFont;cmdDim;cvar;svar;func;_a;_x;_y;_owner;_stacks;classes;bits=[1,2,4,8,16,32,64,128];_getCallStack(e=!0){const r=new Error().stack.split(`
`);let a=/^\s+at (?<funcName>.+?) \(.+\/(?<fileName>.+?)\.(ts|js)/;if(typeof navigator<"u"&&(navigator.userAgent.includes("Chrome")||(a=/^(?<funcName>.+?)@.+\/(?<fileName>.+?)\.(ts|js)/)),!e)throw Error("Not implemented!");return r.map(n=>n.match(a)?.groups).filter(n=>{const o=n?.funcName,u=n?.fileName;return!o?.endsWith("(<anonymous>)")&&!o?.includes("descriptor.value")&&!o?.match(/^eval|runTest|runSuite|get |set /)&&o!="GolfRegister.repeat"&&!u?.startsWith("GolfBasic")&&o!=null})}_getLastCall(){if(this._isTest)return"any";const e=this._getCallStack();if(e.length==0)return"";try{let r=e[0].funcName;return r.includes(".")||(r=e[0].fileName+"."+r),r}catch(r){return console.debug(e),console.debug(r),""}}hex(e,r=2,a=""){return a+e.toString(16).padStart(r,"0")}printScreen(){let e="",r=0,a="";for(let s=0;s<1001;s++){s%40==0&&e&&(r++,a+=`${gb.hex(r)} |${e}|
`,e="");const i=gb._bus.vic.getTextBase(),n=gb._ram[i+s];e+=Ft(n)[0]}return console.debug(a),a}pushByte(e){const r=this._bus.bus.cpu;this._bus.write(256+r.sp,e),r.sp--}popByte(){const e=this._bus.bus.cpu;return e.sp++,this._bus.read(256+e.sp)}printStack(){const e=this._bus.bus.cpu;let r="";for(let a=e.sp;a<=255;a++){const s=this._bus.read(256+a);r+=`${s.toHex2()} `}return r}pushVariables(e){e.forEach(r=>{r instanceof Ue?(this.pushByte(r.addressLo),this.pushByte(r.addressHi)):r.bytes==2?(this.pushByte(r.lo),this.pushByte(r.hi)):this.pushByte(r.lo)})}popVariables(e){[...e].reverse().forEach(r=>{if(r instanceof Ue){const a=this.popByte(),s=this.popByte();r.address=a*256+s}else if(r.bytes==2){const a=this.popByte(),s=this.popByte();r.value=a*256+s}else r.value=this.popByte()})}getStats(){return{pc:gb.token.currBasPtr}}printPrg(){const e=gb.mem.basStart.value,r=gb.mem.basEnd.value,a=gb.token.currBasPtr.value,s=gb.token.lastReadValue.value,i=gb.hex,n="\x1B[31;48m",o="\x1B[32;48m",u="\x1B[0m";let d="";return d+=`Start: ${i(e,4,"$")}
`,d+=`End:   ${i(r,4,"$")}
`,d+=`LastPtr:   ${n}${i(a,4,"$")} `,d+=`${u}-> read -> ${o}${i(a+1,4,"$")} (get data)
`,d+=`LastRead: [${i(s,2,"")}]

`,this.printMem(e,r,a,a+1,d)}printMem(e,r=256,a=0,s=0,i=""){const n=gb.hex,o=gb._ram;let u="",d=!1;const p="\x1B[0;33m",g="\x1B[0;31m",h="\x1B[0;32m",m="\x1B[0;32m",x="\x1B[30;42m",W="\x1B[0;35m";for(let S=e;S<r+16;S+=16){u+=`${W} ${n(S,4,"$")} ${p}`;let P=` ${m}`;for(let E=0;E<16;E++){const q=o[S+E];q>=128&&!d&&(P+=x,d=!0),q<128&&d&&(P+=m,d=!1),P+=Ft(q)[0],S+E==a?u+=`${g}${n(q,2)}  ${p}`:S+E==s?u+=`${h}${n(q,2)}  ${p}`:u+=`${n(q,2)}  `}u+=P+`
`}return i+=u,console.log(i),i.replace(/\u001b\[.*?m/g,"")}_checkOwner(e){if(this._isTest)return;const r=this._getLastCall();if(this._owner[e]!=r&&!r.endsWith("."+this._owner[e]))throw new Error(`Invalid owner for reg ${e}: ${r} instead of ${this._owner[e]}`)}get A(){return this._checkOwner("_a"),this._a}get X(){return this._checkOwner("_x"),this._x}get Y(){return this._checkOwner("_y"),this._y}get AY(){return this._checkOwner("_a"),this._checkOwner("_y"),this._y.value*256+this._a.value}regSetter(e,r,a=""){if(this._owner[e]=a||this._getLastCall(),r instanceof dt){Object(this)[e].value=r.value;return}if(r instanceof Ze){Object(this)[e].value=r.value;return}if(typeof r=="number"){Object(this)[e].value=r;return}throw new Error("Invalid type!")}set A(e){this.regSetter("_a",e)}set X(e){this.regSetter("_x",e)}set Y(e){this.regSetter("_y",e)}set AY(e){this.regSetter("_a",e&255),this.regSetter("_y",e>>8&255)}save(e){e.split("").forEach(r=>{r=r.toLowerCase();const a="_"+r,s=Object(this)[a];this._stacks[r].push(s.value),this._stacks[r].push(this._owner[a]);const i=new Error().stack?.split(`
`)[4].split("(")[0].trim().slice(3);this._owner[a]=i||"undefined"})}restore(e){e.split("").forEach(r=>{r=r.toLowerCase();const a="_"+r;this._owner[a]=this._stacks[r].pop(),Object(this)[a].value=this._stacks[r].pop()})}addClass(e,r){const a=new r;Object(this)[e]=a,this.classes[e]=a,this._logger.debugDetail(`Class ${e} registered.`)}printPerformance(){let e=`Total runtime: ${Math.floor(this._totalTime)/1e3}
`;return Object.entries(this._calls).forEach(([r,a])=>{e+=`${r}: ${a.calls} calls, ${Math.floor(a.totalTime)/1e3}
`}),e}constructor(){this._isVitest=!1,this._logger=At.createFileLogger("logs/"),this._logger.setPriority(Pt.DEBUG),this._logger.debug("Logger created."),this._gvar=new Fo,this._data=new Po,this._temp=new Mo,this._asm=new kn,this._taint=new Tn,this._isTest=!0,this._calls={},this._totalTime=0,this._ram=null,this.classes={},Object.entries({mem:yo,ustr:To,gscr:Tr,time:Sr,expr:ae,vars:le,sysv:Rn,error:_n,token:mt,operation:ce,postops:_r,keyb:Io,scrCmd:qs,editor:In,gtimer:Ms,exec:Cn,exinit:Ao,exstack:_t,exinline:mo,eval:st,num:He,cmdDecInc:Rs,cmdInkey:Fs,cmdForRepeat:yr,cmdDoLoop:Ns,cmdDefCall:xr,cmdMem:co,cmdFont:Vs,cmdDim:at,sprite:Kt,cvar:Bs,svar:Wn,func:vr,gcall:Ls}).forEach(([r,a])=>{this.addClass(r,a)}),this._a=new dt("a"),this._x=new dt("x"),this._y=new dt("y"),this._owner={},this._stacks={a:[],x:[],y:[]}}attachRam(e){this._ram=e}addBus(e){this._bus=e}init(){Object.keys(this.classes).forEach(e=>{this._logger.debugDetail(`Inititalizing variables for ${e}...`),this.classes[e].initVars(),this._logger.debugDetail(`Running init for ${e}...`),this.classes[e].init()})}doEvents(){}}class Qo{constructor(e){this.bus=e,this.vic=new Yo(e)}vic;setVicMemory(e,r){this.bus.vic.setVicMemory(e,r)}writeColorRam(e,r){this.bus.memoryManager.colorRam.write(e,r)}write(e,r){this.bus.write(e,r)}read(e){return this.bus.memoryManager.read(e)}}class Yo{constructor(e){this.bus=e}getTextBase(){return this.bus.vic.textBase}getColorBase(){return this.bus.vic.colorBase}setBackground(e){this.bus.vic.setBackground(e)}setBorder(e){this.bus.vic.setBorder(e)}render(){this.bus.vic.render(5e3)}get memory(){return this.bus.vic.memory}}const kr=t=>atob(t).split("").map(e=>e.charCodeAt(0)),Go=kr("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"),qo=kr("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"),Uo=kr("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ZjwOAHxmZnx4bGYAPGZgPAZmPAB+GBgYGBgYAGZmZmZmZjwAZmZmZmY8GABjY2Nrf3djAGZmPBg8ZmYAZmZmPBgYGAB+BgwYMGB+ABgYGP//GBgYwMAwMMDAMDAYGBgYGBgYGDMzzMwzM8zMM5nMZjOZzGYAAAAAAAAAAPDw8PDw8PDwAAAAAP//////AAAAAAAAAAAAAAAAAAD/wMDAwMDAwMDMzDMzzMwzMwMDAwMDAwMDAAAAAMzMMzPMmTNmzJkzZgMDAwMDAwMDGBgYHx8YGBgAAAAADw8PDxgYGB8fAAAAAAAA+PgYGBgAAAAAAAD//wAAAB8fGBgYGBgY//8AAAAAAAD//xgYGBgYGPj4GBgYwMDAwMDAwMDg4ODg4ODg4AcHBwcHBwcH//8AAAAAAAD///8AAAAAAAAAAAAA////AQMGbHhwYAAAAAAA8PDw8A8PDw8AAAAAGBgY+PgAAADw8PDwAAAAAPDw8PAPDw8Pw5mRkZ+Zw////8P5wZnB//+fn4OZmYP////Dn5+fw///+fnBmZnB////w5mBn8P///Hnwefn5////8GZmcH5g/+fn4OZmZn//+f/x+fnw///+f/5+fn5w/+fn5OHk5n//8fn5+fnw////5mAgJSc////g5mZmZn////DmZmZw////4OZmYOfn///wZmZwfn5//+DmZ+fn////8Gfw/mD///ngefn5/H///+ZmZmZwf///5mZmcPn////nJSAwcn///+Zw+fDmf///5mZmcHzh///gfPnz4H/w8/Pz8/Pw//z7c+Dz50D/8Pz8/Pz88P//+fDgefn5+f/78+AgM/v////////////5+fn5///5/+ZmZn//////5mZAJkAmZn/58Gfw/mD5/+dmfPnz5m5/8OZw8eYmcD/+fPn///////z58/Pz+fz/8/n8/Pz58///5nDAMOZ////5+eB5+f/////////5+fP////gf///////////+fn///8+fPnz5//w5mRiZmZw//n58fn5+eB/8OZ+fPPn4H/w5n54/mZw//58eGZgPn5/4Gfg/n5mcP/w5mfg5mZw/+BmfPn5+fn/8OZmcOZmcP/w5mZwfmZw////+f//+f/////5///5+fP8efPn8/n8f///4H/gf///4/n8/nz54//w5n58+f/5/////8AAP///+fDmYGZmZn/g5mZg5mZg//DmZ+fn5nD/4eTmZmZk4f/gZ+fh5+fgf+Bn5+Hn5+f/8OZn5GZmcP/mZmZgZmZmf/D5+fn5+fD/+Hz8/Pzk8f/mZOHj4eTmf+fn5+fn5+B/5yIgJScnJz/mYmBgZGZmf/DmZmZmZnD/4OZmYOfn5//w5mZmZnD8f+DmZmDh5OZ/8OZn8P5mcP/gefn5+fn5/+ZmZmZmZnD/5mZmZmZw+f/nJyclICInP+ZmcPnw5mZ/5mZmcPn5+f/gfnz58+fgf/n5+cAAOfn5z8/z88/P8/P5+fn5+fn5+fMzDMzzMwzM8xmM5nMZjOZ//////////8PDw8PDw8PD/////8AAAAAAP//////////////////AD8/Pz8/Pz8/MzPMzDMzzMz8/Pz8/Pz8/P////8zM8zMM2bMmTNmzJn8/Pz8/Pz8/Ofn5+Dg5+fn//////Dw8PDn5+fg4P///////wcH5+fn////////AAD////g4Ofn5+fn5wAA////////AADn5+fn5+cHB+fn5z8/Pz8/Pz8/Hx8fHx8fHx/4+Pj4+Pj4+AAA////////AAAA/////////////wAAAP78+ZOHj5///////w8PDw/w8PDw/////+fn5wcH////Dw8PD/////8PDw8P8PDw8A==");console.log("First render");let M;function Us(t){const e=t.slice(2);M.bus.memoryManager.ram.load(e,t[0]+t[1]*256),[46,48,50].forEach(r=>{M.bus.cpu.write(r,(t.length>>8)+9)})}function Wo(){const t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("accept",".prg"),t.addEventListener("change",e=>{const r=new FileReader;r.addEventListener("load",a=>{const s=r.result;t instanceof HTMLInputElement&&t?.files?.length&&s instanceof ArrayBuffer&&Us([...new Uint8Array(s)])}),r.readAsArrayBuffer(t?.files[0])}),t.click(),t.remove()}function Ko(){M=new Lr,M.init();const t=document.getElementById("canvas");t.tabIndex=5e3,t.addEventListener("keydown",u=>M.onKeyDown(u)),t.addEventListener("keyup",u=>M.onKeyUp(u)),t.addEventListener("focus",M.clearKeys.bind(M));const e=Uo,r=qo,a=Go,s={romCharset:new Hr(e),kernal:new Xr(r),basicRom:new $r(a)};M.onKeyDown=u=>{Lr.prototype.onKeyDown.bind(M)(u),gb.keyb.irq()},M.setROMS(s),M.cpu.cacheInstructions=!0;const i=M.bus;global.gb=new Lo,gb.attachRam(i.memoryManager.ram.array),gb.addBus(new Qo(i)),gb.init(),gb._gvar.listVars(),gb._gvar.listMemory(),gb._gvar.showStats(),gb._checkOwner=(...u)=>{},M.bus.cpu=new Sn(i),M.bus.cpu.bus=i,setInterval(M.bus.cpu.dummyIRQ,20),M.bus.cpu.setPc(2049),M.pause(),gb._bus.setVicMemory(53248,49152);for(let u=0;u<4096;u++)gb._ram[53248+u]=gb._bus.vic.memory.romCharset.read(53248+u);gb._emu=M;const n=[1,8,...Ni()];Us(n);function o(){try{M.mainLoop()}catch(u){let d="?",p="?",g="?";if(u instanceof Error&&u.stack){const m=u.stack.match(/(?:file:\/\/\/)?(.+):(\d+):(\d+)/);m&&(d=m[1],p=m[2],g=m[3])}const h=`${d}
 L${p}: C${g} - ${u}`;M.cpu.error=`${h}`,console.log(h)}if(M.cpu.error){const u=document.getElementById("canvas").getContext("2d");u?.clearRect(0,0,u.canvas.width,u.canvas.height),M.cpu.error.split(`
`).forEach((p,g)=>{u?.fillText(p,20,20+g*40,u.canvas.width)});return}setTimeout(o,10)}return setTimeout(o,0),M}const Ke=Ko(),Ws=()=>{const t=document.getElementById("canvas").getContext("2d");gb._fr|=0;try{if(Ke.cpu.error)return;const e=Ke.bus.vic.imageData;t?.putImageData(e,0,0)}catch(e){console.log(e)}setTimeout(Ws,40)},Ir=document.createElement("button");Ir.addEventListener("click",Wo);Ir.innerText="load";document.body.appendChild(Ir);const wr=document.createElement("button");wr.addEventListener("click",Ke.step.bind(Ke));wr.innerText="step";document.body.appendChild(wr);const Or=document.createElement("button");Or.addEventListener("click",()=>{gb._fr=0,M.bus.cpu.setPc(2049),gb.exec.start(),Ke.state=pr.RUNNING});Or.innerText="run";document.body.appendChild(Or);const Br=document.createElement("button");Br.addEventListener("click",()=>{Ke.renderFullFrame.bind(Ke)(1)});Br.innerText="repaint";document.body.appendChild(Br);requestAnimationFrame(Ws);
